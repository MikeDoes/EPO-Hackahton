<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE ep-patent-document PUBLIC "-//EPO//EP PATENT DOCUMENT 1.5.1//EN" "ep-patent-document-v1-5-1.dtd">
<!-- This XML data has been generated under the supervision of the European Patent Office -->
<ep-patent-document id="EP21161689A1" file="EP21161689NWA1.xml" lang="en" country="EP" doc-number="3890307" kind="A1" date-publ="20211006" status="n" dtd-version="ep-patent-document-v1-5-1">
<SDOBI lang="en"><B000><eptags><B001EP>ATBECHDEDKESFRGBGRITLILUNLSEMCPTIESILTLVFIROMKCYALTRBGCZEEHUPLSKBAHRIS..MTNORSMESMMAKHTNMD..........</B001EP><B005EP>J</B005EP><B007EP>BDM Ver 2.0.12 (4th of August) -  1100000/0</B007EP></eptags></B000><B100><B110>3890307</B110><B120><B121>EUROPEAN PATENT APPLICATION</B121></B120><B130>A1</B130><B140><date>20211006</date></B140><B190>EP</B190></B100><B200><B210>21161689.1</B210><B220><date>20210310</date></B220><B250>en</B250><B251EP>en</B251EP><B260>en</B260></B200><B300><B310>2020061112</B310><B320><date>20200330</date></B320><B330><ctry>JP</ctry></B330></B300><B400><B405><date>20211006</date><bnum>202140</bnum></B405><B430><date>20211006</date><bnum>202140</bnum></B430></B400><B500><B510EP><classification-ipcr sequence="1"><text>H04N   5/232       20060101AFI20210806BHEP        </text></classification-ipcr></B510EP><B520EP><classifications-cpc><classification-cpc sequence="1"><text>H04N   5/23225     20130101 LI20210804BHEP        </text></classification-cpc><classification-cpc sequence="2"><text>H04N   5/23209     20130101 FI20210804BHEP        </text></classification-cpc></classifications-cpc></B520EP><B540><B541>de</B541><B542>BILDERFASSUNGSEINRICHTUNG, VORRICHTUNG, STEUERUNGSVERFAHREN UND PROGRAMM</B542><B541>en</B541><B542>IMAGE CAPTURING APPARATUS, DEVICE, CONTROL METHOD, AND PROGRAM</B542><B541>fr</B541><B542>APPAREIL DE CAPTURE D'IMAGES, DISPOSITIF, PROCÉDÉ DE COMMANDE ET PROGRAMME</B542></B540><B590><B598>19</B598></B590></B500><B700><B710><B711><snm>CANON KABUSHIKI KAISHA</snm><iid>100094800</iid><irf>EP102651</irf><adr><str>30-2, Shimomaruko 3-chome</str><city>Ohta-ku
Tokyo 146-8501</city><ctry>JP</ctry></adr></B711></B710><B720><B721><snm>MAEDA, Ryo</snm><adr><str>c/o CANON KABUSHIKI KAISHA
30-2, Shimomaruko 3-chome</str><city>Ohta-ku, Tokyo 146-8501</city><ctry>JP</ctry></adr></B721></B720><B740><B741><snm>TBK</snm><iid>100061560</iid><adr><str>Bavariaring 4-6</str><city>80336 München</city><ctry>DE</ctry></adr></B741></B740></B700><B800><B840><ctry>AL</ctry><ctry>AT</ctry><ctry>BE</ctry><ctry>BG</ctry><ctry>CH</ctry><ctry>CY</ctry><ctry>CZ</ctry><ctry>DE</ctry><ctry>DK</ctry><ctry>EE</ctry><ctry>ES</ctry><ctry>FI</ctry><ctry>FR</ctry><ctry>GB</ctry><ctry>GR</ctry><ctry>HR</ctry><ctry>HU</ctry><ctry>IE</ctry><ctry>IS</ctry><ctry>IT</ctry><ctry>LI</ctry><ctry>LT</ctry><ctry>LU</ctry><ctry>LV</ctry><ctry>MC</ctry><ctry>MK</ctry><ctry>MT</ctry><ctry>NL</ctry><ctry>NO</ctry><ctry>PL</ctry><ctry>PT</ctry><ctry>RO</ctry><ctry>RS</ctry><ctry>SE</ctry><ctry>SI</ctry><ctry>SK</ctry><ctry>SM</ctry><ctry>TR</ctry></B840><B844EP><B845EP><ctry>BA</ctry></B845EP><B845EP><ctry>ME</ctry></B845EP></B844EP><B848EP><B849EP><ctry>KH</ctry></B849EP><B849EP><ctry>MA</ctry></B849EP><B849EP><ctry>MD</ctry></B849EP><B849EP><ctry>TN</ctry></B849EP></B848EP></B800></SDOBI>
<abstract id="abst" lang="en">
<p id="pa01" num="0001">An image capturing apparatus (110) that includes a mounting part (205) capable of attaching/detaching a device (100) capable of holding at least an image captured by the image capturing apparatus and capable of communicating with the mounted device in accordance with a predetermined standard is provided. The apparatus outputs to a device, if the device having a function of executing image analysis processing for image data captured by the apparatus is mounted in the mounting part, a command complying with the predetermined standard and causing the device to execute the image analysis processing. The apparatus outputs at least two commands associated with each other and causing the device to execute the image analysis processing, wherein each of the at least two commands includes data representing that the at least two commands are associated with each other.
<img id="iaf01" file="imgaf001.tif" wi="78" he="102" img-content="drawing" img-format="tif"/></p>
</abstract>
<description id="desc" lang="en"><!-- EPO <DP n="1"> -->
<heading id="h0001">BACKGROUND OF THE INVENTION</heading>
<heading id="h0002">Field of the Invention</heading>
<p id="p0001" num="0001">The present invention relates to a technique of using the functions of a detachable device.</p>
<heading id="h0003">Description of the Related Art</heading>
<p id="p0002" num="0002">In recent years, image processing such as image analysis of performing object detection and tracking or performing attribute estimation, and estimation of the number of objects based on the result of such image analysis is performed in various scenes using images captured by a monitoring camera. Conventionally, such image processing has been performed by transferring videos from the monitoring camera to a high performance arithmetic apparatus such as a PC or a server that executes actual image processing. However, the recent improvement of the processing capability of mobile arithmetic apparatuses allows the monitoring camera side to perform image processing. Processing on the camera side can be executed by, for example, an arithmetic apparatus arranged in a camera main body. When the arithmetic apparatus is arranged in a detachable device such as a USB, the detachable device can execute at least a part of processing.</p>
<heading id="h0004">SUMMARY OF THE INVENTION</heading>
<p id="p0003" num="0003">The present invention provides a technique of improving convenience in a system that causes a detachable device to execute at least a part of processing.</p>
<p id="p0004" num="0004">The present invention in its first aspect provides an image capturing<!-- EPO <DP n="2"> --> apparatus as specified in claims 1 to 5.</p>
<p id="p0005" num="0005">The present invention in its second aspect provides a device as specified in claims 6 to 10.</p>
<p id="p0006" num="0006">The present invention in its third aspect provides a control method as specified in claims 11 and 12.</p>
<p id="p0007" num="0007">The present invention in its third aspect provides a program as specified in claims 13 and 14.</p>
<p id="p0008" num="0008">Further features of the present invention will become apparent from the following description of exemplary embodiments (with reference to the attached drawings).</p>
<heading id="h0005">BRIEF DESCRIPTION OF THE DRAWINGS</heading>
<p id="p0009" num="0009">
<ul id="ul0001" list-style="none" compact="compact">
<li><figref idref="f0001">Fig. 1</figref> is a block diagram showing an example of a system arrangement;</li>
<li><figref idref="f0001">Fig. 2</figref> is a block diagram showing an example of the hardware arrangement of an image capturing apparatus;</li>
<li><figref idref="f0002">Fig. 3</figref> is a block diagram showing an example of the functional arrangement of the image capturing apparatus;</li>
<li><figref idref="f0003">Fig. 4</figref> is a block diagram showing an example of the hardware arrangement of a detachable device;</li>
<li><figref idref="f0003">Fig. 5</figref> is a block diagram showing an example of the functional arrangement of the detachable device;</li>
<li><figref idref="f0004">Fig. 6</figref> is a block diagram showing an example of the hardware arrangement of an input/output apparatus;</li>
<li><figref idref="f0004">Fig. 7</figref> is a block diagram showing an example of the functional arrangement of the input/output apparatus;</li>
<li><figref idref="f0005">Fig. 8</figref> is a flowchart showing an example of the procedure of processing executed by the system;<!-- EPO <DP n="3"> --></li>
<li><figref idref="f0006">Fig. 9</figref> is a flowchart showing an example of the procedure of processing of ascertaining analysis processing;</li>
<li><figref idref="f0007">Fig. 10</figref> is a flowchart showing an example of the procedure of processing of determining the contents of analysis processing;</li>
<li><figref idref="f0008">Fig. 11</figref> is a flowchart showing an example of the procedure of control of executing analysis processing;</li>
<li><figref idref="f0009">Fig. 12</figref> is a flowchart showing an example of the procedure of control of executing post-processing;</li>
<li><figref idref="f0010">Figs. 13A and 13B</figref> are views showing the structures of a command and a response;</li>
<li><figref idref="f0010">Fig. 14</figref> is a view schematically showing data at an address that stores information of processing functions;</li>
<li><figref idref="f0011">Fig. 15</figref> is a view showing an example of information that the image capturing apparatus obtains;</li>
<li><figref idref="f0012">Fig. 16</figref> is a flowchart showing an example of the procedure of processing of automatically switching between storage processing and image analysis processing;</li>
<li><figref idref="f0013">Fig. 17</figref> is a flowchart showing an example of the procedure of processing of automatically switching between storage processing and image analysis processing;</li>
<li><figref idref="f0014">Fig. 18</figref> is a flowchart showing an example of the procedure of processing of automatically switching between storage processing and image analysis processing;</li>
<li><figref idref="f0015">Fig. 19</figref> is a flowchart showing an example of the procedure of processing of automatically switching between storage processing and image analysis processing;</li>
<li><figref idref="f0016">Fig. 20</figref> is a view showing the structures of a command and a response;<!-- EPO <DP n="4"> --></li>
<li><figref idref="f0016">Fig. 21</figref> is a view showing an example of a user interface;</li>
<li><figref idref="f0016">Fig. 22</figref> is a view showing an example of the user interface in a state in which a processing result is shown;</li>
<li><figref idref="f0017">Fig. 23</figref> is a view schematically showing an image analysis processing group for face authentication processing and a processing group executable in each apparatus;</li>
<li><figref idref="f0018">Fig. 24</figref> is a flowchart showing an example of the procedure of selection processing of a processing function to be used;</li>
<li><figref idref="f0019">Fig. 25</figref> is a flowchart showing an example of the procedure of selection processing of a processing function to be used; and</li>
<li><figref idref="f0020">Fig. 26</figref> is a flowchart showing an example of the procedure of selection processing of a processing function to be used.</li>
</ul></p>
<heading id="h0006">DESCRIPTION OF THE EMBODIMENTS</heading>
<p id="p0010" num="0010">Hereinafter, embodiments will be described in detail with reference to the attached drawings. Note, the following embodiments are not intended to limit the scope of the claimed invention. Multiple features are described in the embodiments, but limitation is not made to an invention that requires all such features, and multiple such features may be combined as appropriate. Furthermore, in the attached drawings, the same reference numerals are given to the same or similar configurations, and redundant description thereof is omitted.</p>
<heading id="h0007">&lt;System Arrangement&gt;</heading>
<p id="p0011" num="0011"><figref idref="f0001">Fig. 1</figref> shows an example of the arrangement of an image analysis system according to this embodiment. As an example, a case in which this system is a specific person tracking system will be described below. However, the present invention is not limited to this, and the following argument can be applied to an arbitrary system for analyzing an image and performing predetermined<!-- EPO <DP n="5"> --> information output. This system is configured to include image capturing apparatuses 110a to 110d, a network 120, and an input/output apparatus 130. Note that the image capturing apparatuses 110a to 110d each include a slot to/from which a device capable of recording, for example, a captured image can be attached/detached, and when the detachable devices 100a to 100d are inserted into the slots, the image capturing apparatuses 110a to 110d are connected to the detachable devices 100a to 100d. Note that the detachable devices 100a to 100d will be referred to as "detachable devices 100", and the image capturing apparatuses 110a to 110d will be referred to as "image capturing apparatuses 110" hereinafter.</p>
<p id="p0012" num="0012">The detachable device 100 is an arithmetic device attachable/detachable to/from the image capturing apparatus 110. As an example, the detachable device 100 is a device with a predetermined processing circuit mounted in an SD card. The detachable device 100 is configured to be inserted as a whole into the image capturing apparatus 110 in a form of, for example, an SD card, and can therefore be configured to be connectable to the image capturing apparatus 110 without making any portion project from the image capturing apparatus 110. Alternatively, the detachable device 100 may be configured such that, for example, a half or more of it can be inserted into the image capturing apparatus 110, and may therefore be configured to be connectable to the image capturing apparatus 110 while making a portion project a little from the image capturing apparatus 110. This can prevent the detachable device 100 from interfering with an obstacle such as a wiring and raise the convenience when using the device. In addition, since an SD card slot is prepared in a lot of existing image capturing apparatuses 110 such as a network camera, the detachable device 100 can provide an extension function to the existing image capturing apparatus 110. Note that other than the form of an SD card, the detachable device 100 may be configured<!-- EPO <DP n="6"> --> to be mounted in the image capturing apparatus 110 via an arbitrary interface used when mounting a storage device capable of storing an image captured by at least the image capturing apparatus 110. For example, the detachable device 100 may include a USB (Universal Serial Bus) interface, and may be configured to be mounted in a USB socket of the image capturing apparatus 110. The predetermined processing circuit is implemented by, for example, an FPGA (Field Programmable Gate Array) programmed to execute predetermined processing but may be implemented in another form.</p>
<p id="p0013" num="0013">The image capturing apparatus 110 is an image capturing apparatus such as a network camera. In this embodiment, the image capturing apparatus 110 incorporates an arithmetic apparatus capable of processing a video but is not limited to this. For example, an external computer such as a PC (Personal Computer) connected to the image capturing apparatus 110 may exist, and the combination may be handled as the image capturing apparatus 110.<br/>
Additionally, in this embodiment, the detachable devices 100 are mounted in all the image capturing apparatuses 110. Note that <figref idref="f0001">Fig. 1</figref> shows four image capturing apparatuses 110, and the detachable devices mounted in these. The number of combinations of devices may be three or less, or five or more. When the detachable device 100 having an image analysis processing function is mounted in the image capturing apparatus 110, video processing can be executed on the side of the image capturing apparatus 110 even if the image capturing apparatus 110 does not have the image analysis processing function. Also, in a form in which an arithmetic apparatus for video processing is arranged in the image capturing apparatus 110, as in this embodiment, image processing executable on the side of the image capturing apparatus 110 can be diversified/sophisticated by mounting the detachable device 100 including an arithmetic apparatus in the image capturing apparatus 110.<!-- EPO <DP n="7"> --></p>
<p id="p0014" num="0014">The input/output apparatus 130 is an apparatus that performs acceptance of input from a user and output of information (for example, display of information) to the user. In this embodiment, for example, the input/output apparatus 130 is a computer such as a PC, and information is input/output by a browser or a native application installed in the computer.</p>
<p id="p0015" num="0015">The image capturing apparatuses 110 and the input/output apparatus 130 are communicably connected via the network 120. The network 120 is configured to include a plurality of routers, switches, cables, and the like, which satisfy the communication standard of, for example, Ethernet®. In this embodiment, the network 120 can be an arbitrary network that enables communication between the image capturing apparatus 110 and the input/output apparatus 130, and can be constructed by an arbitrary scale and arrangement and a communication standard to comply with. For example, the network 120 can be the Internet, a wired LAN (Local Area Network), a wireless LAN, a WAN (Wide Area Network), or the like. The network 120 can be configured such that, for example, communication by a communication protocol complying with the ONVIF (Open Network Video Interface Forum) standard is possible. However, the network 120 is not limited to this and may be configured such that, for example, communication by another communication protocol such as a unique communication protocol is possible.</p>
<heading id="h0008">&lt;Apparatus Arrangement&gt;</heading>
<heading id="h0009">(Arrangement of Image Capturing Apparatus)</heading>
<p id="p0016" num="0016">The arrangement of the image capturing apparatus 110 will be described next. <figref idref="f0001">Fig. 2</figref> is a block diagram showing an example of the hardware arrangement of the image capturing apparatus 110. As the hardware arrangement, the image capturing apparatus 110 includes, for example, an image capturing unit 201, an image processing unit 202, an arithmetic processing unit<!-- EPO <DP n="8"> --> 203, a distribution unit 204, and an SD I/F unit 205. Note that I/F is an abbreviation of interface.</p>
<p id="p0017" num="0017">The image capturing unit 201 is configured to include a lens portion configured to form an image of light, and an image capturing element that performs analog signal conversion according to the formed image of light. The lens portion has a zoom function of adjusting an angle of view, a stop function of adjusting a light amount, and the like. The image capturing element has a gain function of adjusting sensitivity when converting light into an analog signal. These functions are adjusted based on set values notified from the image processing unit 202. The analog signal obtained by the image capturing unit 201 is converted into a digital signal by an analog-to-digital conversion circuit and transferred to the image processing unit 202 as an image signal.</p>
<p id="p0018" num="0018">The image processing unit 202 is configured to include an image processing engine, and peripheral devices thereof. The peripheral devices include, for example, a RAM (Random Access Memory), the drivers of I/Fs, and the like. The image processing unit 202 performs, for example, image processing such as development processing, filter processing, sensor correction, and noise removal for the image signal obtained from the image capturing unit 201, thereby generating image data. The image processing unit 202 can also transmit set values to the lens portion and the image capturing element and execute exposure adjustment to obtain an appropriately exposed image. The image data generated by the image processing unit 202 is transferred to the arithmetic processing unit 203.</p>
<p id="p0019" num="0019">The arithmetic processing unit 203 is formed by at least one processor such as a CPU or an MPU, memories such as a RAM and a ROM, the drivers of I/Fs, and the like. Note that CPU is the acronym of Central Processing Unit, MPU is the acronym of Micro Processing Unit, RAM is the acronym of Random<!-- EPO <DP n="9"> --> Access Memory, and ROM is the acronym of Read Only Memory. In an example, the arithmetic processing unit 203 can determine allocation concerning which one of the image capturing apparatus 110 and the detachable device 100 should execute each portion of processing to be executed in the above-described system, and execute processing corresponding to the allocation. Details of processing contents and processing allocation will be described later. The image received from the image processing unit 202 is transferred to the distribution unit 204 or the SD I/F unit 205. The data of the processing result is also transferred to the distribution unit 204.</p>
<p id="p0020" num="0020">The distribution unit 204 is configured to include a network distribution engine and, for example, peripheral devices such as a RAM and an ETH PHY module. The ETH PHY module is a module that executes processing of the physical (PHY) layer of Ethernet. The distribution unit 204 converts the image data or the data of the processing result obtained from the arithmetic processing unit 203 into a format distributable to the network 120, and outputs the converted data to the network 120. The SD I/F unit 205 is an interface portion used to connect the detachable device 100, and is configured to include, for example, a power supply, and a mounting part such as an attaching/detaching socket used to attach/detach the detachable device 100. Here, the SD I/F unit 205 is configured in accordance with the SD standard formulated by the SD Association. Communication between the detachable device 100 and the image capturing apparatus 110, such as transfer of an image obtained from the arithmetic processing unit 203 to the detachable device 100 or data obtaining from the detachable device 100, is performed via the SD I/F unit 205.</p>
<p id="p0021" num="0021"><figref idref="f0002">Fig. 3</figref> shows an example of the functional arrangement of the image capturing apparatus 110. The image capturing apparatus 110 includes, as its functions, for example, an image capturing control unit 301, a signal processing<!-- EPO <DP n="10"> --> unit 302, a storage unit 303, a control unit 304, an analysis unit 305, a device communication unit 306, and a network communication unit 307.</p>
<p id="p0022" num="0022">The image capturing control unit 301 executes control of capturing the peripheral environment via the image capturing unit 201. The signal processing unit 302 performs predetermined processing for the image captured by the image capturing control unit 301, thereby generating data of the captured image. The data of the captured image will simply be referred to as the "captured image" hereinafter. The signal processing unit 302, for example, encodes the image captured by the image capturing control unit 301. The signal processing unit 302 performs encoding for a still image using, for example, an encoding method such as JPEG (Joint Photographic Experts Group). The signal processing unit 302 performs encoding for a moving image using an encoding method such as H.264/MPEG-4 AVC (to be referred to as "H.264" hereinafter) or HEVC (High Efficiency Video Coding). The signal processing unit 302 may encode an image using an encoding method selected by the user from a plurality of encoding methods set in advance via, for example, an operation unit (not shown) of the image capturing apparatus 110.</p>
<p id="p0023" num="0023">The storage unit 303 stores a list (to be referred to as a "first processing list" hereinafter) of analysis processing executable by the analysis unit 305 and a list of post-processes for a result of analysis processing. The storage unit 303 also stores a result of analysis processing to be described later. Note that in this embodiment, processing to be executed is analysis processing. However, arbitrary processing may be executed, and concerning processing associated with the processing to be executed, the storage unit 303 may store the first processing list and the list of post-processes. The control unit 304 controls the signal processing unit 302, the storage unit 303, the analysis unit 305, the device communication unit 306, and the network communication unit 307 to execute<!-- EPO <DP n="11"> --> predetermined processing.</p>
<p id="p0024" num="0024">The analysis unit 305 selectively executes at least one of pre-analysis processing, analysis processing, and post-analysis processing to be described later for a captured image. Pre-analysis processing is processing to be executed for a captured image before analysis processing to be described later is executed. In the pre-analysis processing according to this embodiment, as an example, processing of dividing a captured image to create divided images is executed. Analysis processing is processing of outputting information obtained by analyzing an input image. In the analysis processing according to this embodiment, as an example, processing of receiving a divided image obtained by pre-analysis processing, executing at least one of human body detection processing, face detection processing, and vehicle detection processing, and outputting the analysis processing result is executed. The analysis processing can be processing configured to output the position of an object in a divided image using a machine learning model that has learned to detect an object included in an image using, for example, the technique in <nplcit id="ncit0001" npl-type="s"><text>J. Redmon and A. Farhadi "YOL09000: Better Faster Stronger" Computer Vision and Pattern Recognition (CVPR) 2016</text></nplcit>. Post-analysis processing is processing to be executed after analysis processing is executed. In the post-analysis processing according to this embodiment, as an example, processing of outputting, as a processing result, a value obtained by adding the numbers of objects detected in the divided images based on the analysis processing result for each divided image is executed. Note that the analysis processing may be processing of detecting an object in an image by performing pattern matching and outputting the position of the object.</p>
<p id="p0025" num="0025">The device communication unit 306 performs communication with the detachable device 100. The device communication unit 306 converts input data into a format processible by the detachable device 100, and transmits data<!-- EPO <DP n="12"> --> obtained by the conversion to the detachable device 100. In addition, the device communication unit 306 receives data from the detachable device 100, and converts the received data into a format processible by the image capturing apparatus 110. In this embodiment, as the conversion processing, the device communication unit 306 executes processing of converting a decimal between a floating point format and a fixed point format. However, the present invention is not limited to this, and another processing may be executed by the device communication unit 306. Additionally, in this embodiment, the device communication unit 306 transmits a command sequence determined in advance within the range of the SD standard to the detachable device 100, and receives a response from the detachable device 100, thereby performing communication with the detachable device 100. The network communication unit 307 performs communication with the input/output apparatus 130 via the network 120.</p>
<heading id="h0010">(Arrangement of Detachable Device)</heading>
<p id="p0026" num="0026"><figref idref="f0003">Fig. 4</figref> is a block diagram showing an example of the hardware arrangement of the detachable device 100. As an example, the detachable device 100 is configured to include an I/F unit 401, an FPGA 402, an SD controller 403, and a storage unit 404. The detachable device 100 is formed into a shape that can be inserted/removed into/from the attaching/detaching socket of the SD I/F unit 205 provided in the image capturing apparatus 110, that is, a shape complying with the SD standard.</p>
<p id="p0027" num="0027">The I/F unit 401 is an interface portion used to connect an apparatus such as the image capturing apparatus 110 and the detachable device 100. The I/F unit 401 is configured to include, for example, an electrical contact terminal that receives supply of power from the image capturing apparatus 110 and generates and distributes a power supply to be used in the detachable device 100, and the like. Concerning items defined in (complying with) the SD standard, the I/F unit<!-- EPO <DP n="13"> --> 401 complies with that, like the SD I/F unit 205 of the image capturing apparatus 110. Reception of images and setting data from the image capturing apparatus 110 and transmission of data from the FPGA 402 to the image capturing apparatus 110 are executed via the I/F unit 401.</p>
<p id="p0028" num="0028">The FPGA402 is configured to include an input/output control unit 410, a processing switching unit 411, and an arithmetic processing unit 412. The FPGA 402 is a kind of semiconductor device capable of repetitively reconstructing an internal logic circuit structure. By processing implemented by the FPGA 402, a processing function can be added (provided) to the apparatus in which the detachable device 100 is mounted. Additionally, since the logic circuit structure can be changed later by the reconstruction function of the FPGA 402, when the detachable device 100 is mounted in, for example, an apparatus in a field of a quickly advancing technology, appropriate processing can be executed in the apparatus at an appropriate timing. Note that in this embodiment, an example in which an FPGA is used will be described. However, for example, a general-purpose ASIC or a dedicated LSI may be used if processing to be described later can be executed. The FPGA 402 is activated by writing, from a dedicated I/F, setting data including the information of a logic circuit structure to be generated or reading out the setting data from the dedicated I/F. In this embodiment, the setting data is held in the storage unit 404. When powered on, the FPGA 402 reads out the setting data from the storage unit 404 and generates and activates a logic circuit. However, the present invention is not limited to this. For example, the image capturing apparatus 110 may write the setting data in the FPGA 402 via the I/F unit 401 by implementing a dedicated circuit in the detachable device.</p>
<p id="p0029" num="0029">The input/output control unit 410 is configured to include a circuit used to transmit/receive an image to/from the image capturing apparatus 110, a circuit<!-- EPO <DP n="14"> --> that analyzes a command received from the image capturing apparatus 110, a circuit that controls based on a result of analysis, and the like. Commands here are defined by the SD standard, and the input/output control unit 410 can detect some of them. Details of the functions will be described later. The input/output control unit 410 controls to transmit an image to the SD controller 403 in storage processing and transmit an image to the arithmetic processing unit 412 in image analysis processing. If the setting data of switching of processing is received, the input/output control unit 410 transmits the setting data to the processing switching unit 411. The processing switching unit 411 is configured to include a circuit configured to obtain the information of the image analysis processing function from the storage unit 404 based on the setting data received from the image capturing apparatus 110 and write the information in the arithmetic processing unit 412. The information of the image analysis processing function includes setting parameters representing, for example, the order and types of operations processed in the arithmetic processing unit 412, the coefficients of operations, and the like. The arithmetic processing unit 412 is configured to include a plurality of arithmetic circuits needed to execute the image analysis processing function. The arithmetic processing unit 412 executes each arithmetic processing based on the information of the image analysis processing function received from the processing switching unit 411, transmits the processing result to the image capturing apparatus 110, and/or records the processing result in the storage unit 404. As described above, the FPGA 402 extracts the setting data of an execution target processing function included in setting data corresponding to a plurality of processing functions held in advance, and rewrites processing contents to be executed by the arithmetic processing unit 412 based on the extracted setting data. This allows the detachable device 100 to selectively execute at least one of the plurality of processing functions. In addition, by<!-- EPO <DP n="15"> --> appropriately adding setting data of processing to be newly added, latest processing can be executed on the side of the image capturing apparatus 110. Note that holding a plurality of setting data corresponding to a plurality of processing functions will be referred to as holding a plurality of processing functions hereinafter. That is, even in a state in which the FPGA 402 of the detachable device 100 is configured to execute one processing function, if the processing contents of the arithmetic processing unit 412 can be changed by setting data for another processing function, this will be expressed as holding a plurality of processing functions.</p>
<p id="p0030" num="0030">The SD controller 403 is a known control IC (Integrated Circuit) as defined by the SD standard, and executes control of a slave operation of an SD protocol and control of data read/write for the storage unit 404. The storage unit 404 is formed by, for example, a NAND flash memory, and stores various kinds of information such as storage data written from the image capturing apparatus 110, the information of the image analysis processing function written in the arithmetic processing unit 412, and setting data of the FPGA 402.</p>
<p id="p0031" num="0031"><figref idref="f0003">Fig. 5</figref> shows an example of the functional arrangement of the detachable device 100. The detachable device 100 includes, as its functional arrangement, for example, an analysis unit 501 and a communication unit 502. The analysis unit 501 executes analysis processing for an image. For example, if an analysis processing setting request is input, the analysis unit 501 executes setting to set the input analysis processing in an executable state. If an image is input, the analysis unit 501 executes the analysis processing set in the executable state for the input image. In this embodiment, executable analysis processing includes human body detection processing and face detection processing but is not limited to these. For example, it may be processing (face authentication processing) of determining whether a person stored in advance is included in an image. For<!-- EPO <DP n="16"> --> example, if the degree of matching between the image characteristic amount of a person stored in advance and the image characteristic amount of a person detected from an input image is calculated, and the degree of matching is equal to or larger than a threshold, it is determined that the person is the person stored in advance. Alternatively, it may be processing of superimposing a predetermined mask image or performing mosaic processing on a person detected from an input image for the purpose of privacy protection. It may be processing of detecting, using a learning model that has learned a specific action of a person by machine learning, whether a person in an image is taking the specific action. Furthermore, it may be processing of determining what kind of region a region in an image is. It may be processing of determining, using, for example, a learning model that has learned buildings, roads, persons, sky and the like by machine learning, what kind of region a region in an image is. As described above, executable analysis processing can be applied to both image analysis processing using machine learning and image analysis processing without using machine learning. Each analysis processing described above may be executed not independently by the detachable device 100 but in cooperation with the image capturing apparatus 110. The communication unit 502 performs communication with the image capturing apparatus 110 via the I/F unit 401.</p>
<heading id="h0011">(Arrangement of Input/Output Apparatus)</heading>
<p id="p0032" num="0032"><figref idref="f0004">Fig. 6</figref> shows an example of the hardware arrangement of the input/output apparatus 130. The input/output apparatus 130 is formed as a computer such as a general PC, and is configured to include, for example, a processor 601 such as a CPU, memories such as a RAM 602 and a ROM 603, a storage device such as an HDD 604, and a communication I/F 605, as shown in <figref idref="f0004">Fig. 6</figref>. The input/output apparatus 130 can execute various kinds of functions by executing, by the processor 601, programs stored in the memories and the storage device.<!-- EPO <DP n="17"> --></p>
<p id="p0033" num="0033"><figref idref="f0004">Fig. 7</figref> shows an example of the functional arrangement of the input/output apparatus 130 according to this embodiment. The input/output apparatus 130 includes, as its functional arrangement, for example, a network communication unit 701, a control unit 702, a display unit 703, and an operation unit 704. The network communication unit 701 is connected to, for example, the network 120 and executes communication with an external apparatus such as the image capturing apparatus 110 via the network 120. Note that this is merely an example and, for example, the network communication unit 701 may be configured to establish direct communication with the image capturing apparatus 110 and communicate with the image capturing apparatus 110 without intervention of the network 120 or other apparatus. The control unit 702 controls such that the network communication unit 701, the display unit 703, and the operation unit 704 execute processing of their own. The display unit 703 presents information to the user via, for example, a display. In this embodiment, a result of rendering by a browser is displayed on a display, thereby presenting information to the user. Note that information may be presented by a method such as an audio or a vibration other than screen display. The operation unit 704 accepts an operation from the user. In this embodiment, the operation unit 704 is a mouse or a keyboard, and the user operates these to input a user operation to the browser. However, the operation unit 704 is not limited to this and may be, for example, another arbitrary device capable of detecting a user's intention, such as a touch panel or a microphone.</p>
<heading id="h0012">&lt;Procedure of Processing&gt;</heading>
<p id="p0034" num="0034">An example of the procedure of processing executed in the system will be described next. Note that processing executed by the image capturing apparatus 110 in the following processes is implemented by, for example, by a processor in the arithmetic processing unit 203, executing a program stored in a<!-- EPO <DP n="18"> --> memory or the like. However, this is merely an example, and processing to be described later may partially or wholly be implemented by dedicated hardware. In addition, processing executed by the detachable device 100 or the input/output apparatus 130 may also be implemented by, by a processor in each apparatus, executing a program stored in a memory or the like, and processing may partially or wholly be implemented by dedicated hardware.</p>
<heading id="h0013">(Overall Procedure)</heading>
<p id="p0035" num="0035"><figref idref="f0005">Fig. 8</figref> schematically shows a series of procedures of image analysis processing executed by the system. In this processing, first, the user mounts the detachable device 100 in the image capturing apparatus 110 (step S801). The image capturing apparatus 110 executes an initialization sequence of the detachable device 100 (step S802). In this initialization sequence, predetermined commands are transmitted/received between the image capturing apparatus 110 and the detachable device 100, and the image capturing apparatus 110 is thus set in a state in which it can use the detachable device 100. After that, the image capturing apparatus 110 ascertains processing executable by the detachable device 100, and ascertains processing that can be executed locally (that can be executed only by the image capturing apparatus 110 or by the combination of the image capturing apparatus 110 and the detachable device 100) (step S803). Note that although the detachable device 100 can be configured to execute arbitrary processing, processing irrelevant to processing that should be executed on the side of the image capturing apparatus 110 need not be taken into consideration. In an example, the image capturing apparatus 110 may hold a list of executable processes, which is obtained in advance from, for example, the input/output apparatus 130. In this case, when obtaining, from the detachable device 100, information representing processing executable by the detachable device 100, the image capturing apparatus 110 can ascertain only the executable processing<!-- EPO <DP n="19"> --> depending on whether the processing is included in the list. Next, the image capturing apparatus 110 determines processing to be executed, and executes setting of the detachable device 100 as needed (step S804). That is, if at least part of processing determined as an execution target is to be executed by the detachable device 100, setting of the detachable device 100 for the processing is executed. In this setting, for example, reconstruction of the FPGA 402 using setting data corresponding to the processing of the execution target can be performed. Then, the image capturing apparatus 110 or the detachable device 100 executes analysis processing (step S805). After that, the image capturing apparatus 110 executes post-processing (step S806). Note that the processes of steps S805 and S806 are repetitively executed. The processing shown in <figref idref="f0005">Fig. 8</figref> is executed when, for example, the detachable device 100 is mounted. However, at least part of the processing shown in <figref idref="f0005">Fig. 8</figref> may repetitively be executed such that, for example, the process of step S803 is executed again when the detachable device 100 is detached.</p>
<heading id="h0014">(Processing of Ascertaining Excitable Processing)</heading>
<p id="p0036" num="0036"><figref idref="f0006">Fig. 9</figref> shows an example of the procedure of processing of ascertaining processing executable by the image capturing apparatus 110. This processing corresponds to the process of step S803 in <figref idref="f0005">Fig. 8</figref>, and can be executed if a device such as the detachable device 100 is mounted on the image capturing apparatus 110 or removed, or if the image capturing apparatus 110 is powered on. In this processing, the image capturing apparatus 110 reads out processing executable by the detachable device 100, integrates it with analysis processing excitable by the image capturing apparatus 110 itself, and ascertains analysis processing executable on the side of the image capturing apparatus 110.</p>
<p id="p0037" num="0037">First, the control unit 304 of the image capturing apparatus 110 reads out a first processing list that is a list of processes executable by the analysis unit 305<!-- EPO <DP n="20"> --> of the image capturing apparatus 110 itself, which is stored in the storage unit 303 (step S901). Next, the control unit 304 determines whether the mounted device is, for example, a conventional device having only a storage function of a predetermined device such as the detachable device 100 having a specific processing function (step S902). For example, the control unit 304 controls the device communication unit 306 to issue a read request (read command) for a specific address to the mounted device and read out flag data stored at the specific address. The specific address will sometime be referred to as an "address A" hereinafter. Note that details of the data stored at the address A will be described later. The control unit 304 can determine, based on the read flag data, whether the detachable device 100 is a predetermined device having a specific processing function. However, this is merely an example, and it may be determined by another method whether the mounted device is a predetermined device.</p>
<p id="p0038" num="0038">If the mounted device is a predetermined device (YES in step S902), the control unit 304 executes processing of ascertaining processing executable in the device (detachable device 100). The control unit 304 controls the device communication unit 306 to communicate with detachable device 100 and obtain a list (to be referred to as a "second processing list" hereinafter) of processes executable in the detachable device 100 (step S903). The control unit 304 reads out the data stored at the address A as in a case in which, for example, it is determined whether the detachable device 100 is a predetermined device, thereby obtaining the second processing list. Note that, for example, the second processing list can be stored at the same address (address A) as the flag data used to determine whether the detachable device is a predetermined device. In this case, the image capturing apparatus 110 can simultaneously execute the process of step S902 and the process of step S903 by accessing the address A and simultaneously obtaining the flag data and the second processing list. However,<!-- EPO <DP n="21"> --> the present invention is not limited to this, and these data may be stored at different addresses. After that, the control unit 304 creates an integrated processing list in which the first processing list of processes executable by the image capturing apparatus 110 itself, which is read out from the storage unit 303, and the second processing list obtained from the detachable device are integrated (step S904), and ends the processing.</p>
<p id="p0039" num="0039">The integrated processing list represents a list of processes locally executable on the side of the image capturing apparatus 110 without performing processing by an apparatus such as a server apparatus on the network. Note that in this embodiment, the integrated processing list is a list obtained by the union of the processes included in the first processing list and the processes included in the second processing list. The integrated processing list is the list of processes included in at least one of the first processing list and the second processing list. However, the present invention is not limited to this. For example, if another processing can be executed by combining a process included in the first processing list and a process included in the second processing list, the other executable processing may be added to the integrated processing list. That is, if new analysis processing can be executed using at least some of the processes included in the first processing list and at least some of the processes included in the second processing list together, the information of the analysis processing can be included in the integrated processing list. For example, face authentication processing can be implemented by a function group of a face detection processing function, a face characteristic extraction processing function, and a face characteristic collation processing function. At this time, if the face detection processing function and the face characteristic extraction processing function are included in the first processing list, and the face characteristic collation processing function is included in the second processing list, the face authentication<!-- EPO <DP n="22"> --> processing can be included in the integrated processing list.</p>
<p id="p0040" num="0040">If the mounted device is not a predetermined device (NO in step S902), the control unit 304 determines that there is no processing executable by the mounted device. Hence, the control unit 304 sets the first processing list of processes executable by the self-apparatus, which is read out from the storage unit 303, as the integrated processing list representing processes locally executable on the side of the image capturing apparatus 110 (step S905), and ends the processing. Note that when the processing shown in <figref idref="f0006">Fig. 9</figref> is executed at the time of device removal, the predetermined device is not mounted, as a matter of course, and therefore, the first processing list is handled as the integrated processing list.</p>
<p id="p0041" num="0041">This makes it possible to form a list of processes locally executable on the side of the image capturing apparatus 110 based on whether the detachable device 100 capable of executing specific processing is mounted in the image capturing apparatus 110. In addition, when the integrated processing list is presented to the user, as will be described later, the user can select processing that becomes locally executable on the side of the image capturing apparatus 110 by the mounting of the detachable device 100.</p>
<p id="p0042" num="0042">Note that in this embodiment, an example in which the integrated processing list is generated has been described. However, the first processing list and the second processing list may separately be managed, and the integrated processing list may not be generated. That is, processes executable by the detachable device 100 and processes executable by the image capturing apparatus 110 without the detachable device 100 may be managed in a distinguishable manner and output. Even if the first processing list and the second processing list are managed in a distinguishable manner, the integrated processing list may be generated and managed. For example, if new processing can be executed using a<!-- EPO <DP n="23"> --> process included in the first processing list and a process included in the second processing list together, the new processing is included not in the first processing list and the second processing list but in the integrated processing list. Note that when the integrated processing list is output, information representing whether a process included in the integrated processing list is included in the first processing list or the second processing list in a distinguishable manner can be output together. This allows the user to recognize, for example, whether presented processing can be executed without the detachable device 100.</p>
<p id="p0043" num="0043">Note that the above-described processing list is provided to an external apparatus that is not included at least in the image capturing apparatus 110, like the input/output apparatus 130, but may not be provided to the outside. For example, the processing list may be output by displaying it on a display if the image capturing apparatus 110 includes a display or by outputting the processing list by an audio if the image capturing apparatus 110 has an audio output function. If the detachable device 100 having an unintended function is erroneously mounted in the image capturing apparatus 110, the user can quickly recognize the mounting error by presenting the processing list on the image capturing apparatus 110. As described above, the image capturing apparatus 110 can output, in an arbitrary format, information based on the first processing list representing processes executable by the image capturing apparatus 110 and the second processing list representing processes executable by the detachable device 100.</p>
<p id="p0044" num="0044">Additionally, when the detachable device 100 is removed, the image capturing apparatus 110 executes the processing shown in <figref idref="f0006">Fig. 9</figref> again, thereby updating the integrated processing list. At this time, the image capturing apparatus 110 can discard the second processing list concerning the removed detachable device 100. However, the present invention is not limited to this, and the image capturing apparatus 110 may separately store the second processing list<!-- EPO <DP n="24"> --> concerning a certain detachable device 100 in the storage unit 303 and output the second processing list even in a case in which the detachable device 100 is not mounted. That is, the image capturing apparatus 110 may output the second processing list for the detachable device 100 mounted and removed in the past. The image capturing apparatus 110 may output information representing processing executable using a process included in the second processing list concerning the detachable device 100 mounted and removed in the past and a process included in the first processing list (executable by the self-apparatus). In other words, the image capturing apparatus 110 can output information of processing that cannot be executed only by the self-apparatus. This makes it possible to notify the user that the detachable device 100 capable of executing processing represented by output information exists, and that the processing can be executed by mounting the detachable device 100.</p>
<p id="p0045" num="0045">Furthermore, the image capturing apparatus 110 may output the second processing list concerning the detachable device 100 (non-mounted device) that has never been mounted in the image capturing apparatus 110 itself in the past but can be mounted in the image capturing apparatus 110 itself. Information representing such a non-mounted device and analysis processing executable by the non-mounted device can be, for example, obtained by the image capturing apparatus 110 via an external server (not shown). The information representing the non-mounted device and analysis processing executable by the non-mounted device may be, for example, held by the image capturing apparatus 110 in advance.</p>
<p id="p0046" num="0046">In addition, the image capturing apparatus 110 may output information representing a processing executable using a process included in the second processing list for the non-mounted device and a process included in the first processing list (executable by the self-apparatus). In other words, the image<!-- EPO <DP n="25"> --> capturing apparatus 110 can output information of processing that cannot be executed only by the self-apparatus. This makes it possible to notify the user that the detachable device 100 capable of executing processing represented by output information exists, and that the processing can be executed by mounting the detachable device 100.</p>
<p id="p0047" num="0047">Note that when storing the second processing list for the detachable device 100 mounted and removed in the past, the image capturing apparatus 110 can store information capable of identifying the device, such as the model number of the detachable device 100, together. When outputting the second processing list concerning the detachable device 100, the image capturing apparatus 110 can output the information capable of identifying the detachable device 100 together. This allows the user to easily recognize which detachable device 100 should be mounted in the image capturing apparatus 110 to use a presented processing function.</p>
<heading id="h0015">(Processing of Determining Analysis Processing Contents)</heading>
<p id="p0048" num="0048"><figref idref="f0007">Fig. 10</figref> shows an example of the procedure of processing of determining analysis processing contents by the image capturing apparatus 110. In this processing, analysis processing locally executable on the side of the image capturing apparatus 110 is presented to the user via the input/output apparatus 130, and the input/output apparatus 130 accepts selection of the user. The image capturing apparatus 110 determines analysis processing to be executed in accordance with information representing the user selection accepted via the input/output apparatus 130.</p>
<p id="p0049" num="0049">In this processing, first, the control unit 702 of the input/output apparatus 130 controls the network communication unit 701 to execute communication with the image capturing apparatus 110 and request obtaining of a captured image, an integrated processing list, and a post-processing list (step S1001). As an<!-- EPO <DP n="26"> --> example, the input/output apparatus 130 transmits a request message defined by the ONVIF standard to the image capturing apparatus 110, thereby requesting transmission of information to the image capturing apparatus 110. However, the present invention is not limited to this, and the information transmission request may be done by another message or the like. In the image capturing apparatus 110, based on the request, the image capturing control unit 301 captures the peripheral environment, and the control unit 304 controls the signal processing unit 302 to process an image captured by the image capturing control unit 301 and obtain a captured image (step S1002). Note that the image capturing apparatus 110 may capture the peripheral environment independently of the presence/absence of the request and continuously obtain a captured image. The image capturing apparatus 110 may locally store the captured image or transfer the captured image to another apparatus such as a network server and store. The control unit 304 reads out a post-processing list stored in the storage unit 303. In this embodiment, the post-processing list includes display processing and storage processing but is not limited to this. The control unit 304 controls the network communication unit 307 to transmit the post-processing list, an integrated processing list obtained by the processing shown in <figref idref="f0006">Fig. 9</figref>, and the captured image obtained in step S1002 to the input/output apparatus 130 (step S1003). As an example, the image capturing apparatus 110 transmits a response message to the request message defined by the above-described ONVIF standard to the input/output apparatus 130, thereby transmitting the information to the input/output apparatus 130. However, the present invention is not limited to this, and the information may be transmitted by another message or the like. Note that only processing to be executed may be taken into consideration here, and the captured image request by the input/output apparatus 130 in step S1001, the captured image obtaining in step S1002, and captured image transmission to the<!-- EPO <DP n="27"> --> input/output apparatus 130 in step S1003 may not be performed.</p>
<p id="p0050" num="0050">The control unit 702 of the input/output apparatus 130 controls the network communication unit 701 to receive the captured image and the integrated processing list from the image capturing apparatus 110. The control unit 702 then controls the display unit 703 to present the integrated processing list and the post-processing list to the user by screen display or the like (step S1004). Note that at this time, the control unit 702 may also present the captured image to the user by screen display or the like. After that, the user confirms the integrated processing list and the post-processing list displayed by the display unit 703, and selects analysis processing to be executed (to be referred to as "execution target processing" hereinafter) from the integrated processing list via the operation unit 704 (step SI005). In addition, the user selects a post-processing to be executed (to be referred to as "execution target post-processing" hereinafter) via the operation unit 704 (step S 1006). Details of information presentation to the user in step S1004, analysis processing selection by the user in step S1005, and post-processing selection by the user in step S1006 will be described later. The operation unit 704 outputs the selection results of the execution target processing and the execution target post-processing to the control unit 702. The control unit 702 controls the network communication unit 701 to transmit information representing the execution target processing and the execution target post-processing input from the operation unit 704 to the image capturing apparatus 110 (step S1007).</p>
<p id="p0051" num="0051">The control unit 304 of the image capturing apparatus 110 controls the network communication unit 307 to receive the information representing the execution target processing selected by the user from the input/output apparatus 130 and determine whether the execution target processing is processing included in the second processing list (step S1008). If the execution target processing is<!-- EPO <DP n="28"> --> not included in the second processing list (NO in step S1008), the control unit 304 ends the processing shown in <figref idref="f0007">Fig. 10</figref> without making a notification to the detachable device 100 to execute the processing in the image capturing apparatus 110. On the other hand, if the execution target processing is included in the second processing list (YES in step S1008), the control unit 304 controls the device communication unit 306 to transfer an execution target processing setting request to the detachable device 100 (step S1009).</p>
<p id="p0052" num="0052">The communication unit 502 of the detachable device 100 receives the execution target processing setting request from the image capturing apparatus 110. At this time, the communication unit 502 can discriminate the execution target processing setting request by the amount of data written from the image capturing apparatus 110 or the type of a write command. Details of the setting request discrimination method will be described later. The communication unit 502 outputs the execution target processing setting request received from the image capturing apparatus 110 to the analysis unit 501. Based on the execution target processing setting request input from the communication unit 502, the analysis unit 501 executes setting to set the detachable device 100 in a state in which the execution target processing can be executed (step S1010). For example, after the completion of the setting processing, the communication unit 502 transmits a setting completion notification to the image capturing apparatus 110 (step S1011). Note that the communication unit 502 need only notify information for inhibiting the image capturing apparatus 110 from writing data at a timing at which the setting of the detachable device 100 is not completed yet, and may notify the image capturing apparatus 110 of the information of the setting completion timing or the like before the setting is actually completed. The control unit 304 of the image capturing apparatus 110 controls the device communication unit 306 to receive the setting completion notification from the<!-- EPO <DP n="29"> --> detachable device 100.</p>
<p id="p0053" num="0053">The setting completion notification from the detachable device 100 to the image capturing apparatus 110 can be executed using, for example, one of the following three methods. In the first notification method, the communication unit 502 outputs a BUSY signal in a case in which the setting of the execution target processing has not ended at the time of write processing of the data of the first block from the image capturing apparatus 110. Output of the BUSY signal is performed by, for example, driving a signal line of DATA defined by the SD standard to a Low state. In this case, the image capturing apparatus 110 confirms the BUSY signal, thereby discriminating whether the setting of the execution target processing is completed. In the second notification method, the time until setting of the execution target processing is completed is stored in advance at the above-described specific address, and the image capturing apparatus 110 reads out the information of the time until the setting completion. After the elapse of the time until the execution target processing setting completion, the image capturing apparatus 110 outputs write data (issues a write command). This allows the image capturing apparatus 110 to transmit the data of the captured image after the setting of the execution target processing is completed. In the third notification method, when the setting of the execution target processing is completed, the analysis unit 501 writes a setting completion flag at a second specific address of the detachable device 100. The image capturing apparatus 110 reads out the data at the second specific address, thereby discriminating whether the setting of the execution target processing is completed. Note that the information of the address at which the setting completion flag is written may be stored at the above-described specific address or may be stored at another address.</p>
<p id="p0054" num="0054">As in the processing shown in <figref idref="f0007">Fig. 10</figref>, when the integrated processing list determined depending on whether the detachable device 100 capable of executing<!-- EPO <DP n="30"> --> specific processing is mounted in the image capturing apparatus 110 is used, the execution target processing can appropriately be determined in consideration of the state on the side of the image capturing apparatus 110. If the execution target processing includes a process to be executed by the detachable device 100, setting of the detachable device 100 is automatically performed, thereby making a preparation for executing the processing selected by the user without performing a setting operation by the user. If the execution target processing does not include a process to be executed by the detachable device 100, setting of the detachable device 100 is not performed, thereby preventing setting of the detachable device 100 for being unnecessarily performed in a case in which the processing is to be executed only by the image capturing apparatus 110.</p>
<heading id="h0016">(Execution Control of Analysis Processing)</heading>
<p id="p0055" num="0055"><figref idref="f0008">Fig. 11</figref> shows an example of the procedure of control when the image capturing apparatus 110 executes analysis processing. In this processing, first, the image capturing control unit 301 captures the peripheral environment (step S1101). The control unit 304 controls the signal processing unit 302 to process an image captured by the image capturing control unit 301 and obtain a captured image. After that, the control unit 304 controls the analysis unit 305 to execute pre-analysis processing for the captured image input from the control unit 304 and obtain the image of the pre-analysis processing result (step S1102). The control unit 304 determines whether the execution target processing is included in the second processing list (step S1103).</p>
<p id="p0056" num="0056">Upon determining that the execution target processing is not included in the second processing list (NO in step S1103), the control unit 304 controls the analysis unit 305 to execute the execution target processing for the image of the pre-analysis processing result in the image capturing apparatus 110 (step S 1104). The control unit 304 controls the analysis unit 305 to execute post-analysis<!-- EPO <DP n="31"> --> processing for the analysis processing result (step S1108), and ends the processing.</p>
<p id="p0057" num="0057">If the execution target processing is included in the second processing list (YES in step S1103), the control unit 304 controls the device communication unit 306 to transmit the image of the pre-analysis processing result to the detachable device 100 (step S1105). For example, the control unit 304 issues a write request (write command) of the pre-analysis processing result, thereby transmitting the image of the pre-analysis processing result to the detachable device 100. The communication unit 502 of the detachable device 100 receives the image of the pre-analysis processing result from the image capturing apparatus 110, and outputs the image received from the image capturing apparatus 110 to the analysis unit 501. The analysis unit 501 executes the execution target processing set in step S1010 of <figref idref="f0007">Fig. 10</figref> for the image input from the communication unit 502 (step S1106). Then, the communication unit 502 transmits the analysis processing result obtained by the processing of the analysis unit 501 to the image capturing apparatus 110 (step S1107). The control unit 304 of the image capturing apparatus 110 controls the device communication unit 306 to receive the analysis processing result from the detachable device 100. After that, the control unit 304 controls the analysis unit 305 to execute post-analysis processing for the analysis processing result (step S1108).</p>
<p id="p0058" num="0058">Transmission of the analysis processing result from the detachable device 100 to the image capturing apparatus 110 is done, for example, in the following way. The analysis unit 501 of the detachable device 100 stores the analysis processing result at the storage destination address for the analysis processing result, which is assigned for each execution target processing. The image capturing apparatus 110 reads out information representing the storage address of the analysis processing result, which is stored at the address A together with, for<!-- EPO <DP n="32"> --> example, the second processing list, and issues a read request (read command) for the storage address. The detachable device 100 receives the read request for the storage address of the analysis processing result via the communication unit 502, and outputs the analysis processing result to the image capturing apparatus 110. Note that the image capturing apparatus 110 can issue the read request for the storage address of the analysis processing result, for example, after the elapse of an estimated processing time stored at the address A. In addition, the detachable device 100 may output a BUSY signal from the write request of the last block of the pre-analysis processing result transmitted from the image capturing apparatus 110 to the end of the execution target processing. In this case, the image capturing apparatus 110 can issue the read request for the storage address of the analysis processing result when the BUSY signal is not received any more. This allows the image capturing apparatus 110 to obtain the processing result after the end of the processing.</p>
<p id="p0059" num="0059">With the above-described processing, the image capturing apparatus 110 can determine, in accordance with the selected execution target processing, whether to transfer the captured image to the detachable device 100. It is therefore possible to execute analysis processing of the captured image while the user is not conscious of which one of the image capturing apparatus 110 or the detachable device 100 should execute analysis processing.</p>
<heading id="h0017">(Execution Control of Post-Processing)</heading>
<p id="p0060" num="0060"><figref idref="f0009">Fig. 12</figref> shows an example of the procedure of control when the image capturing apparatus 110 executes post-processing. In this processing, the control unit 304 of the image capturing apparatus 110 determines whether "display" is included in the execution target post-processing (step S1201). Upon determining that display is included in the execution target post-processing (YES in step S1201), the control unit 304 controls the network communication unit 307 to<!-- EPO <DP n="33"> --> transmit the result of analysis processing to the input/output apparatus 130 (step S1202). The control unit 702 of the input/output apparatus 130 controls the network communication unit 701 to receive the result of analysis processing from the image capturing apparatus 110, and then controls the display unit 703 to present the result of analysis processing to the user by screen display or the like (step S1203). On the other hand, if the control unit 304 determines that display is not included in the execution target post-processing (NO in step S1201), the processes of steps S1202 and S1203 are not executed.</p>
<p id="p0061" num="0061">In addition, the control unit 304 of the image capturing apparatus 110 determines whether "storage" is included in the execution target post-processing (step S1204). Note that the determination of step S1204 may be executed before step S1201 or may be executed in parallel to the step S1201. Upon determining that storage is included in the execution target post-processing (YES in step S1204), the control unit 304 controls the storage unit 303 to store the result of analysis processing and ends the processing. On the other hand, upon determining that storage is not included in the execution target post-processing (NO in step S1204), the control unit 304 ends the processing without executing the process of step S1205.</p>
<p id="p0062" num="0062">As described above, in accordance with the selected post-processing, the image capturing apparatus 110 can execute transfer of the result of analysis processing to the input/output apparatus 130 or storage in the storage unit 303 without accepting a special setting operation of the user and improve the convenience.</p>
<heading id="h0018">(Communication between Image Capturing Apparatus 110 and Detachable Device 100)</heading>
<p id="p0063" num="0063">Communication between the image capturing apparatus 110 and the detachable device 100 will be described here. The arithmetic processing unit<!-- EPO <DP n="34"> --> 203 of the image capturing apparatus 110 and the SD controller 403 of the detachable device 100 are connected by a power supply line, a GND line, a clock line, a command line, and a data line via the device insertion socket of the SD I/F unit 205 of the image capturing apparatus 110. Note that the clock line, the command line, and the data line are connected via the FPGA 402. On the clock line, a synchronization clock output from the arithmetic processing unit 203 is communicated. On the command line, a command issued for an operation request from the arithmetic processing unit 203 to the SD controller 403 and a response to the command from the SD controller 403 to the arithmetic processing unit 203 are communicated. On the data line, write data from the arithmetic processing unit 203 and read data from the detachable device 100 are communicated. In addition, the arithmetic processing unit 203 discriminates High and Low of a device detect signal of the device insertion socket of the SD I/F unit 205, thereby recognizing whether the detachable device 100 is inserted.</p>
<p id="p0064" num="0064">The arithmetic processing unit 203 issues a command to the SD controller 403 on the command line after power supply. Upon receiving a response from the SD controller 403 and output data representing device information as an SD card, the arithmetic processing unit 203 sets a voltage for data communication, a communication speed (clock frequency), and the like.</p>
<p id="p0065" num="0065"><figref idref="f0010">Figs. 13A and 13B</figref> show the structures of a command and a response communicated on the command line. The command and response have structures complying with the SD standard. A command 1301 issued from the arithmetic processing unit 203 to the SD controller 403 is configured to include a command number part 1304, a command argument part 1305, and an error correction data part 1306. In the command number part 1304, a value indicating the type of the command is described. For example, if a value "23" is stored in the command number part 1304, this indicates that the command is a block count<!-- EPO <DP n="35"> --> designation command for designating the number of data blocks. If a value "25" is stored in the command number part 1304, this indicates that the command is a multi-write command. If a value "12" is stored in the command number part 1304, this indicates that the command is a data transfer stop command. In the command argument part 1305, pieces of information such as the number of transfer data blocks and the write/read address of a memory are designated in accordance with the type of the command. A command start bit 1302 representing the start position of the command is added to the first bit of the command, and a command end bit 1307 representing the end of the command is added to the final bit of the command. Additionally, a direction bit 1303 representing that the command is a signal output from the image capturing apparatus 110 to the detachable device 100 is also added after the command start bit 1302.</p>
<p id="p0066" num="0066">A response 1311 returned from the SD controller 403 in response to the command from the arithmetic processing unit 203 includes a response number part 1314 representing for which command the response is returned, a response argument part 1315, and an error correction data part 1316. A response start bit 1312 representing the start position of the response is added to the first bit of the response, and a response end bit 1317 representing the end position of the response is added to the final bit of the response. Additionally, a direction bit 1313 representing that the response is a signal output from the detachable device 100 to the image capturing apparatus 110 is also added after the response start bit 1312. In the response argument part 1315, pieces of information such as the status of the SD card are stored in accordance with the command type.</p>
<p id="p0067" num="0067">A method of transmitting/receiving data between the arithmetic processing unit 203 and the detachable device 100 will be described next. In the SD I/F unit 205, data transfer is performed on a block basis in both data write and<!-- EPO <DP n="36"> --> read.</p>
<p id="p0068" num="0068">The following two methods are used by the arithmetic processing unit 203 to transfer the data of a plurality of blocks to the detachable device 100. In the first method, after the number of blocks is designated by a block count designation command for transfer data, data of the designated number of blocks are transferred by a multi-write command. In the block count designation command, the number of blocks of write data is designated by the command argument part 1305. In the multi-write command, the address of the storage unit 404 at which the data should be written is designated by the command argument part 1305. In the second method, data transfer is started by issuing a multi-write command without issuing a block count designation command. When the data transfer ends, a transfer stop command is issued, thereby ending the processing. At this time, the command argument part 1305 of the multi-write command designates only the address of the storage unit 404 at which the data should be written. The arithmetic processing unit 203 can arbitrarily switch the two write methods.</p>
<p id="p0069" num="0069">Note that when performing storage processing, the FPGA 402 directly inputs a command and data sent from the arithmetic processing unit 203 to the SD controller 403, and the SD controller 403 stores the received data at the address of the storage unit 404 designated by the command. When performing image analysis processing, the FPGA 402 executes analysis processing for data sent from the arithmetic processing unit 203, and outputs the data of the processing result and information for designating a predetermined address of the storage unit 404 to the SD controller 403. The SD controller 403 stores the processing result at the designated address of the storage unit.</p>
<p id="p0070" num="0070">The following two methods are used by the arithmetic processing unit 203 to read out the data of a plurality of blocks from the detachable device 100.<!-- EPO <DP n="37"> --> In the first method, after the number of blocks is designated by a block count designation command, a multi-read command is issued, and data of the designated number of blocks are read out. In the block count designation command, the number of blocks of read data is designated by the command argument part 1305. The command argument part 1305 of the multi-read command designates the address of the memory of the data read source. In the second method, data read is started by issuing a multi-read command without issuing a block count designation command, and the processing is ended by issuing a transfer stop command. The arithmetic processing unit 203 can arbitrarily switch the two read methods.</p>
<p id="p0071" num="0071">Note that if write data or read data is data of one block, a single-write command or a single-read command is issued, thereby executing data write or read without issuing a block count designation command and a transfer stop command. In the single-write command and the single-read command as well, the command argument part 1305 designates the address of the storage unit 404 of the access target, as in the above description.</p>
<p id="p0072" num="0072">The arithmetic processing unit 203 performs write to the detachable device 100, thereby transmitting data as the target of storage processing or image analysis processing to the detachable device 100. In addition, the arithmetic processing unit 203 performs read from the detachable device 100, thereby obtaining image data stored in the storage unit 404, a processing result of image analysis processing, and the information of the image analysis processing function held by the detachable device 100.</p>
<p id="p0073" num="0073">The detachable device 100 according to this embodiment stores the information of a processing function held by the self-device at the specific address A of the storage unit 404. The arithmetic processing unit 203 of the image capturing apparatus 110 can confirm the information of a processing function held<!-- EPO <DP n="38"> --> by the detachable device 100 by issuing a multi-read command or a single-read command to the address A. The information of a processing function here includes information representing whether the device holds the processing function, a time required until completion when the processing is executed, the data size of a processing result, and the information of an address at which the processing result is stored. <figref idref="f0010">Fig. 14</figref> shows an example of the information of processing functions. A processing function holding flag 1401 represents that the detachable device 100 has image analysis processing functions. The image capturing apparatus 110 confirms the processing function holding flag 1401, thereby determining whether the detachable device 100 has image analysis processing functions. A processing function class 1402 represents analysis processing held by the detachable device 100. An input data size 1403 and a processing data count 1404 represent information concerning the data input specifications of each processing function. An estimated processing time 1405 represents a time needed from data into to processing result output, and a processing result data count 1406 represents the number of data of a processing result. A processing result storage address 1407 represents a location where the processing result is stored in the storage unit 404. The arithmetic processing unit 203 reads out the data at the address A of the storage unit 404 as shown in <figref idref="f0010">Fig. 14</figref>, thereby obtaining a processing function table as shown in <figref idref="f0011">Fig. 15</figref>.</p>
<p id="p0074" num="0074">If a read command to the address A is not issued by the arithmetic processing unit 203, the detachable device 100 judges that the self-device is a device that does not use an image analysis processing function. In this case, concerning data to be transferred, the detachable device 100 can execute only storage processing for the storage unit 404. Hence, for a device that does not need an image analysis processing function, the detachable device 100 can function only as a memory device. A method of storing the information of<!-- EPO <DP n="39"> --> processing functions at the specific address A of the storage unit 404 has been described here. However, the present invention is not limited to this. For example, the information of processing functions may be added to the response argument part 1315 in a response to a command that is used at the time of initialization of the detachable device 100.</p>
<p id="p0075" num="0075">Note that the image capturing apparatus 110 executes read of the address A of the storage unit 404, for example, after the end of initialization of the detachable device 100. In addition, the image capturing apparatus 110 discards the read information if the device is not detected in the socket any more. If the device is inserted into the socket after the information is discarded, the image capturing apparatus 110 reads out the value of the address A again after the end of initialization. Hence, if a different detachable device is inserted, the image capturing apparatus 110 can read and set the information of functions held by the detachable device.</p>
<heading id="h0019">(Switching Control between Storage Processing and Image Analysis Processing)</heading>
<p id="p0076" num="0076">A method of automatically switching between storage processing and image analysis processing by the detachable device 100 will be described next. This processing is automatic determination processing of determining whether the detachable device 100 directly stores image data received from the image capturing apparatus 110 or performs image analysis processing for the image data. In an example, the image capturing apparatus 110 transmits a special command, thereby controlling which one of storage of image data transmitted to the detachable device 100 and image analysis processing for the image data should be executed by the detachable device 100. However, it is not easy to define such a special command because of the standard the detachable device 100 complies with. Hence, in this embodiment, processing to be executed by the detachable<!-- EPO <DP n="40"> --> device 100 can be switched by the following method without defining a special command. Note that in the following processing example, communication between the image capturing apparatus 110 and the detachable device 100 is performed by a method complying with the SD standard. However, the present invention is not limited to this. That is, processing similar to processing to be described below can be executed using a command or the like according to a predetermined standard the detachable device 100 complies with.</p>
<heading id="h0020">[Control Based on Transfer Data Amount]</heading>
<p id="p0077" num="0077"><figref idref="f0012">Fig. 16</figref> shows an example of the procedure of control of automatically switching between storage processing and image analysis processing based on the number of data blocks to be transferred to the detachable device 100.</p>
<p id="p0078" num="0078">First, the arithmetic processing unit 203 of the image capturing apparatus 110 issues a write command complying with the SD standard to the detachable device 100, and transfers data (step S1601). The FPGA402 of the detachable device 100 determines whether the number of blocks of the data written by the arithmetic processing unit 203 matches the data amount at the time of execution of image analysis processing (step S1602). The FPGA402 can identify the number of blocks of data by confirming the number of data blocks described in the command argument part 1305 of a block count designation command. If the block count designation command is not issued, the FPGA 402 may identify the number of blocks of data by counting the number of blocks transferred until a data transfer stop command is issued.</p>
<p id="p0079" num="0079">If the number of blocks of the data written by the arithmetic processing unit 203 matches the data amount at the time of execution of image analysis processing (YES in step S1602), the FPGA402 executes image analysis processing for the transferred data (step S 1603). The FPGA 402 obtains the processing result (step S 1604), issues a write command to the SD controller 403,<!-- EPO <DP n="41"> --> and stores the obtained processing result at the processing result storage address 1407 of the storage unit 404 according to the class of the analysis processing (step S1605). On the other hand, if the number of blocks of the data written by the arithmetic processing unit 203 does not match the data amount at the time of execution of image analysis processing (NO in step S1602), the transferred data is directly stored in the storage unit 404 (step S1606). For example, the FPGA402 issues a command similar to the write command issued by the arithmetic processing unit 203 to the SD controller 403, and directly transfers the transferred data. The SD controller 403 stores the transferred data at the address of the storage unit 404 designated by the write command.</p>
<p id="p0080" num="0080">The detachable device 100 holds information as shown in <figref idref="f0011">Fig. 15</figref> at the specific address A of the storage unit 404, and recognizes that, for example, the number of input data when executing analysis processing A is 20 blocks. For this reason, if the number of blocks of data written by the arithmetic processing unit 203 is 20 blocks, the FPGA 402 executes the analysis processing A, and otherwise, does not execute the analysis processing A. Note that the FPGA 402 may change the execution target analysis processing in accordance with the number of input blocks such that, for example, if the number of blocks of data written by the arithmetic processing unit 203 is 40 blocks, the FPGA 402 executes analysis processing C.</p>
<heading id="h0021">[Control Based on Write Address]</heading>
<p id="p0081" num="0081"><figref idref="f0013">Fig. 17</figref> shows an example of the procedure of control of switching between storage processing and image analysis processing based on a write address designated by the command argument part 1305 of a write command. In this processing as well, the arithmetic processing unit 203 of the image capturing apparatus 110 issues a write command to the SD controller 403 (step S1701). The FPGA 402 determines whether a write address designated by the command<!-- EPO <DP n="42"> --> argument part 1305 and representing an information storage destination in the storage unit 404 matches the processing result storage address 1407 shown in <figref idref="f0010">Fig. 14</figref> (step S1702). If the write address designated by the command argument part 1305 matches the processing result storage address 1407 (YES in step S1702), the FPGA 402 executes image analysis processing corresponding to the address for the transferred data (step S1703). The FPGA 402 obtains the processing result (step S1704), issues a write command to the SD controller 403, and stores the obtained processing result at the processing result storage address 1407 of the storage unit 404 (step S1705). On the other hand, if the write address designated by the command argument part 1305 does not match the processing result storage address 1407 (NO in step S1702), the FPGA 402 directly stores the transferred data in the storage unit 404 (step S1706). For example, the FPGA 402 issues a command similar to the write command issued by the arithmetic processing unit 203 to the SD controller 403, and directly transfers the transferred data. The SD controller 403 stores the transferred data at the address of the storage unit 404 designated by the write command.</p>
<p id="p0082" num="0082">The detachable device 100 holds information as shown in <figref idref="f0011">Fig. 15</figref> at the specific address A of the storage unit 404, and recognizes that, for example, an analysis result storage address at the time of execution of the analysis processing A should be 0xFFFFFFFF. For this reason, if the write address designated by the command obtained from the arithmetic processing unit 203 is 0xFFFFFFFF, the FPGA 402 executes the analysis processing A, and otherwise, does not execute the analysis processing A. Note that the FPGA 402 may change the execution target analysis processing in accordance with the write address designated by the command such that, for example, if the write address designated by the command obtained from the arithmetic processing unit 203 is 0xEEEEEEEE, the FPGA 402 executes analysis processing C.<!-- EPO <DP n="43"> --></p>
<p id="p0083" num="0083">As described above, the detachable device 100 can determine, based on the number of blocks or the write destination address of data written by the arithmetic processing unit 203, whether to perform image analysis processing or directly store the data. Note that the detachable device 100 may determine, in accordance with the combination of the number of blocks and the write destination address of data written by the arithmetic processing unit 203, whether to perform image analysis processing or directly store the data. For example, if both the number of blocks and the write destination address of data match the processing data count 1404 and the processing result storage address 1407, image analysis processing may be executed. In addition, if at least one of the number of blocks and the write destination address of data does not match the processing data count 1404 or the processing result storage address 1407 of any image analysis processing, storage processing can be executed.</p>
<p id="p0084" num="0084">With the above-described processing, the detachable device 100 can perform image analysis processing for data for which image analysis processing should be executed and store data that should be stored without executing image analysis processing without introducing an additional procedure for instructing whether to execute image analysis processing. Since this can prevent the system from becoming complex and obviate the necessity of executing an additional procedure, image analysis processing can quickly be started.</p>
<p id="p0085" num="0085">Note that the processing shown in <figref idref="f0013">Fig. 17</figref> may be executed in combination with the processing shown in <figref idref="f0012">Fig. 16</figref>. That is, if the number of blocks of image data and the storage destination address of information are values associated with image analysis processing, the image analysis processing may be executed.</p>
<p id="p0086" num="0086">Note that when performing image analysis processing, not only the processing result but also the transferred data as the target of analysis processing<!-- EPO <DP n="44"> --> may be stored together in an area of the storage unit 404 different from the processing result storage address 1407. Additionally, in the above-described control, if the detachable device 100 has a plurality of image analysis processing functions, the type of image analysis processing to be executed may be determined in accordance with the number of write blocks or the write address of data. For example, if the number of blocks or the write destination address of data matches the processing data count 1404 or the processing result storage address 1407 for certain image analysis processing of the plurality of image analysis processing functions, the image analysis processing can be executed.</p>
<heading id="h0022">[Control Based on Command]</heading>
<p id="p0087" num="0087"><figref idref="f0014">Fig. 18</figref> shows an example of basic processing of the procedure of control of switching between storage processing and image analysis processing based on a command. In the SD standard, a first protocol that writes data after a block count designation command is issued, and a second protocol that writes data without issuing a block count designation command are provided as protocols when writing data. Note that the second protocol issues a data transfer stop command when ending data write. In this processing example, image analysis processing is executed based on data transmission by the first protocol, and when data is transmitted by the second protocol, storage processing of storing image data in the storage unit 404 is executed without executing image analysis processing. Hence, the FPGA 402 of the detachable device 100 determines, depending on whether a block count designation command is issued for transmission of image data, whether to execute image analysis processing.</p>
<p id="p0088" num="0088">In this processing as well, first, the arithmetic processing unit 203 of the image capturing apparatus 110 issues a write command to the detachable device 100, and transfers data (step S1801). Here, the FPGA 402 of the detachable device 100 determines whether a block count designation command is issued (step<!-- EPO <DP n="45"> --> S1802). If a block count designation command is issued (YES in step S1802), the FPGA 402 executes image analysis processing for the transferred data (step S1803), and obtains the processing result (step S1804). The FPGA 402 designates a predetermined processing result storage address according to the class of analysis processing shown in <figref idref="f0010">Fig. 14</figref> and issues a write command to the SD controller 403, thereby storing the data of the processing result in the storage unit 404 (step S1805). If a block count designation command is not issued (NO in step S1802), the FPGA 402 issues a write command similar to the command issued by the arithmetic processing unit 203 to the SD controller 403. The FPGA 402 directly transmits the transferred data to the SD controller 403. The SD controller 403 stores the data at the address of the storage unit 404 designated by the write command from the FPGA 402 (step S1806).</p>
<p id="p0089" num="0089">Note that the block count designation command may be another predetermined command. That is, a predetermined command serving as a trigger to execute image analysis processing is set in advance, and the FPGA 402 executes image analysis processing for input image data based on at least reception of the predetermined command. Alternatively, another information capable of identifying the protocol to be used may be used. Note that, for example, upon receiving a predetermined command, the FPGA 402 may execute the processing shown in <figref idref="f0012">Fig. 16</figref> or <figref idref="f0013">17</figref> to determine whether to execute image analysis processing for input image data.</p>
<p id="p0090" num="0090">As described above, by instructing execution of image analysis processing by a command such as a block count designation command, the image capturing apparatus 110 can instruct processing to be executed by the detachable device 100 within the range of the protocol complying with the SD standard.</p>
<p id="p0091" num="0091">Note that as the existing commands of the SD standard, only 64 types of commands can be defined at maximum. Since basic commands used in a general<!-- EPO <DP n="46"> --> SD card already exist, there remains no sufficient room to newly define commands for, for example, image analysis processing. On the other hand, in the SD standard, an application command is issued, thereby using a command of contents specific to an application by a command issued next. For example, an application command can be a command in which the value of the command number part 1304 is "55". The second command issued after the transmission of the command whose command number part 1304 has a value "55" is handled as a command specified to the application. At this time, in the second command, even if a value indicating a general-purpose command defined by the conventional SD standard is stored in the command number part 1304, the second command is handled as a command for instructing a predetermined operation specific to the application. For example, if a value "25" is stored in the command number part 1304, it is generally indicated that the command is a multi-write command, as described above. On the other hand, in the second command issued after the transmission of the command whose command number part 1304 has a value "55", the value of the command number part 1304 is set to "25", and this can instruct an operation specific to the application, which is not a multi-write command. That is, even if the same value is stored in the command number part 1304 of a given command, the command can be handled as a command of a different significance depending on whether to issue an application command immediately before.</p>
<p id="p0092" num="0092">Processing to be executed by the detachable device 100 can be switched using the handling of the command. Japanese Patent Laid-Open No. <patcit id="pcit0001" dnum="JP2003196613A"><text>2003-196613</text></patcit> describes changing, using an application command, which one of the user data area and the secure area of a detachable device is to be accessed. In this embodiment, for example, if a write command is issued after issuance of an application command, the detachable device 100 can execute image analysis<!-- EPO <DP n="47"> --> processing as a command specific to the application. On the other hand, if a write command is issued without issuance of an application command, the detachable device 100 can execute storage processing of storing image data in the storage unit 404 as a write command of the SD standard. As described above, the FPGA 402 of the detachable device 100 can determine whether to execute image analysis processing depending on whether an application command is issued to transmit image data. According to this, by a method different from the procedure shown in <figref idref="f0014">Fig. 18</figref>, the image capturing apparatus 110 can switch, by a transmitted command, which one of storage processing and image analysis processing is to be executed by the detachable device 100.</p>
<p id="p0093" num="0093">In the technique described in Japanese Patent Laid-Open No. <patcit id="pcit0002" dnum="JP2003196613A"><text>2003-196613</text></patcit>, any other command is never generated during the period from the transmission of the application command to the transmission of the subsequent command. On the other hand, in this embodiment, for example, storage processing of an image captured by the image capturing apparatus 110 in the detachable device 100 and image processing by the detachable device 100 can be executed in parallel. That is, the arithmetic processing unit 203 of the image capturing apparatus 110 can parallelly request image analysis processing and storage processing from the detachable device 100. In this case, interruption of another command for image write may occur between, for example, an application command for image analysis processing and a subsequent command specific to the application. At this time, the other interruption command may be interpreted as a command specific to the application in the detachable device 100, and an unintended operation may occur. For example, in the above-described example, a command transmitted as a write command of the conventional SD standard may be handled as an execution command of image analysis processing. Also, in this case, a command transmitted as a command specific to the<!-- EPO <DP n="48"> --> application after that may be handled as a write command of the conventional SD standard. Note that to prevent issuance of such an interruption command, the software of the image capturing apparatus 110 can be updated. However, if the image capturing apparatus 110 that cannot update software exists, such a measure cannot be taken.</p>
<p id="p0094" num="0094">Hence, the arithmetic processing unit 203 of the image capturing apparatus 110 embeds interruption determination data in a command, thereby determining whether a command transmitted after an application command is a command specific to the application. The interruption determination data is, for example, data such as a bit string including a predetermined number of bits, and this is identification information representing that a group of commands are associated with one processing. When common interruption determination data is included in an application command and a command specific to the application, which is transmitted after that, it is indicated that the command specific to the application is associated with the application command transmitted before that. This allows the detachable device 100 to discriminate that the command transmitted by interruption is not associated with the application command, and the command can thus be handled as a command of the conventional SD standard. Note that, for example, a partial area of the command argument part 1305 in <figref idref="f0010">Fig. 13</figref> can be assigned to transmit the interruption determination data. In this case, the detachable device 100 temporarily stores the value stored in the partial area of the command argument part 1305 of an application command, and determines whether the same value is stored in the partial area of the command argument part 1305 of a command received later. If the same value is stored in the partial area of the command argument part 1305 of the command received later, the detachable device 100 determines that the command is a command specific to the application, and executes processing according to the command. On the other<!-- EPO <DP n="49"> --> hand, if the same value is not stored in the partial area of the command argument part 1305 of the command received later, the detachable device 100 determines that the command is a command transmitted by interruption and is not a command specific to the application. In this case, the detachable device 100 handles the command as a general-purpose command.</p>
<p id="p0095" num="0095">An example of the procedure of processing of determining whether to execute image analysis processing depending on whether an application command is issued will be described here with reference to <figref idref="f0015">Fig. 19</figref>. In this processing example, if a write command is issued after issuance of an application command, as described above, the write command is handled as a command specific to the application, and the detachable device 100 executes image analysis processing. On the other hand, if a write command is issued without issuance of an application command, the write command is handled as a command of the conventional SD standard, and the detachable device 100 executes storage processing of storing image data in the storage unit 404. Note that it is assumed here that, for example, the data length of the area of the command argument part 1305 shown in <figref idref="f0010">Fig. 13</figref> is 32 bits, and 16 bits of these are used for interruption determination data. That is, the data length of the command argument part 1305 is reduced to 16 bits, and the remaining 16 bits are used as interruption determination data. <figref idref="f0016">Fig. 20</figref> shows an example of the structure of a command in this case. In an example, a 16-bit interruption determination data part 2002 is arranged between a 16-bit command argument part 2001 and the error correction data part 1306. Note that this is merely an example, and, for example, the 16-bit interruption determination data part 2002 may be arranged between the command number part 1304 and the command argument part 2001. In addition, for example, the interruption determination data part 2002 may be arranged between an n-bit (1 ≤ n ≤ 15) first command argument part and a (16-n)-bit second<!-- EPO <DP n="50"> --> command argument part. The interruption determination data part 2002 may be arranged at another position. Note that the data length of the interruption determination data part 2002 may be shorter than 16 bits or may be longer. That is, as long as the setting concerning the position to arrange the interruption determination data part 2002 is shared between the image capturing apparatus 110 and the detachable device 100, the interruption determination data part 2002 can be included in the command in any way. Note that data to be stored in the interruption determination data part 2002 can be generated as a random bit string every time an application command is issued.</p>
<p id="p0096" num="0096">In this processing as well, first, the arithmetic processing unit 203 of the image capturing apparatus 110 issues a write command to the detachable device 100, and transfers data (step S1901), as in the processing shown in <figref idref="f0014">Fig. 18</figref>. The FPGA 402 of the detachable device 100 determines whether an application command is issued before an issued write command (step S1902).</p>
<p id="p0097" num="0097">If an application command is issued (YES in step S1902), the FPGA 402 determines whether the interruption determination data part 2002 of the application command and the interruption determination data part 2002 of the write command match (step S1903). If the interruption determination data parts 2002 of the application command and the write command match (YES in step S1903), the FPGA 402 executes image analysis processing for the transferred data (step S1904), and obtains the processing result (step S1905). The FPGA 402 designates a predetermined processing result storage address according to the class of analysis processing shown in <figref idref="f0010">Fig. 14</figref> and issues a write command to the SD controller 403, thereby storing the data of the processing result in the storage unit 404 (step S1906).</p>
<p id="p0098" num="0098">On the other hand, if an application command is not issued immediately before (NO in step S 1902), the FPGA 402 processes the command received in<!-- EPO <DP n="51"> --> step S1901 as a write command of the existing SD standard (step S1907). If the interruption determination data part 2002 of the application command and the interruption determination data part of the write command do not match (NO in step S1903), the FPGA 402 determines that the write command is an interruption command. In this case, the FPGA 402 processes the command received in step S1901 as a write command of the existing SD standard (step S1907). In step S1907, the FPGA 402 issues, to the SD controller 403, a write command similar to the command issued from the arithmetic processing unit 203. The FPGA 402 directly transmits the transferred data to the SD controller 403. The SD controller 403 stores the data at the address of the storage unit 404 designated by the write command from the FPGA 402.</p>
<p id="p0099" num="0099">Note that the FPGA 402 may divisionally receive the data of the command argument part 1305. For example, if a command structure as shown in <figref idref="f0016">Fig. 20</figref> is used, the FPGA 402 may combine the 16-bit command argument part 2001 of the application command and the 16-bit command argument part 2001 of the write command and handle these as 32-bit data. That is, the image capturing apparatus 110 can divide one data into a plurality of (two, in this case) partial data, store different partial data in the command argument parts 2001 with a reduced data length in the two commands associated with each other, and output the data.</p>
<p id="p0100" num="0100">Note that in place of the above-described write command, another predetermined command or a combination of predetermined commands may be used. That is, if a predetermined command serving as a trigger to execute image analysis processing is set in advance, the FPGA 402 executes image analysis processing of input image data based on at least reception of the predetermined command after reception of an application command. Alternatively, another information capable of specifying a protocol to be used may be used. Note that,<!-- EPO <DP n="52"> --> for example, if the command is received, the FPGA 402 may execute the processes shown in <figref idref="f0012 f0013 f0014 f0015">Figs. 16 to 19</figref> and determine whether to execute image analysis processing for input image data.</p>
<p id="p0101" num="0101">As described above, if a command such as an application command indicates that image analysis processing should be executed, the image capturing apparatus 110 can instruct processing to be executed to the detachable device 100 within the range of a protocol complying with the SD standard. Note that in the above-described example, an example in which one command specific to the application is transmitted after one application command has been described. However, the present invention is not limited to this. For example, a plurality of application commands may be transmitted, and a plurality of commands specific to the application may be transmitted. That is, three or more commands that are associated with each other and correspond to one processing may be used as a combination. This can increase the types of usable commands. For example, a command specific to the application can be defined by two or more commands transmitted after a command whose command number part 1304 has a value "55". In this case, common interruption determination data is stored in the plurality of commands. Hence, even if an interruption command is transmitted until three or more commands that are associated with each other and correspond to one processing are transmitted, the detachable device 100 can recognize that the command is an interruption command.</p>
<p id="p0102" num="0102">It can be said that at least a part of the above-described processing is processing of determining whether to execute image analysis processing depending on whether a command complying with the SD standard for transmission of image data includes a value associated with image analysis processing executable by the FPGA 402. That is, in the processing shown in <figref idref="f0012">Fig. 16</figref>, image analysis processing is executed when "23" is stored in the command<!-- EPO <DP n="53"> --> number part 1304, and a value indicating a predetermined number of blocks is stored in the command argument part 1305. In the processing shown in <figref idref="f0013">Fig. 17</figref>, image analysis processing is executed when a value indicating a processing result storage address is stored in the command argument part 1305. In the processing shown in <figref idref="f0014">Fig. 18</figref>, image analysis processing is executed when "23" is stored in the command number part 1304. In the processing shown in <figref idref="f0015">Fig. 19</figref>, if "23" is stored in the command number part 1304 of a received command, and "55" is stored in the command number part 1304 of the application command issued immediately before, image analysis processing is executed. As described above, by setting the contents of the command at the time of transmission of image data to a predetermined value associated with image analysis processing, it is possible to flexibly control, using a command complying with the SD standard, which one of image analysis processing and storage processing should be executed by the FPGA 402.</p>
<heading id="h0023">(Read of Processing Result)</heading>
<p id="p0103" num="0103">A method of reading out, by the image capturing apparatus 110, the processing result of image analysis processing stored in the detachable device 100 will be described next. The arithmetic processing unit 203 designates the processing result storage address 1407 shown in <figref idref="f0010">Fig. 14</figref> in the detachable device 100, and issues a read command to read out data as many as the processing result data count 1406 of each analysis processing. The SD controller 403 receives the read command via the FPGA 402, and outputs the data of the processing result stored at the designated address of the storage unit 404 to the arithmetic processing unit 203 of the image capturing apparatus 110. This allows the image capturing apparatus 110 to obtain the processing result of image analysis processing.</p>
<heading id="h0024">(Presentation of Information to User and Acceptance of User Selection)</heading><!-- EPO <DP n="54"> -->
<p id="p0104" num="0104">Examples of presentation of a captured image, an integrated processing list, and post-processing list to the user and a method of accepting user selection will be described. <figref idref="f0016">Fig. 21</figref> shows an example of screen display of a captured image, an integrated processing list, and a post-processing list via the display unit 703. By the display screen, for example, a user interface 2101 is displayed. The user interface 2101 includes, for example, a captured image display area 2102, an integrated processing list display area 2103, and a post-processing list display area 2104. The user confirms these areas, thereby ascertaining the captured image, the integrated processing list, and the post-processing list.</p>
<p id="p0105" num="0105">Note that the list to be displayed is not limited to only the integrated processing list. For example, the image capturing apparatus 110 can store a second processing list for a certain detachable device 100 in the storage unit 303 and transmit the second processing list stored in the storage unit 303 to the input/output apparatus 130 even if the detachable device 100 is not mounted. That is, the image capturing apparatus 110 may output the second processing list for the detachable device 100 mounted in the past. In this case, the input/output apparatus 130 can display analysis processing that is included in the second processing list but not in the integrated processing list in a gray-out state as analysis processing that is enabled by mounting the detachable device 100. It is therefore possible to promote the user to mount the detachable device 100 in the image capturing apparatus 110 to make the processing in the gray-out state executable. Additionally, for example, if the image capturing apparatus 110 and the detachable device 100 have identical processing functions, these can be integrated and displayed as one process. In this case, the image capturing apparatus 110 can determine which one of the image capturing apparatus 110 and the detachable device 100 executes the processing. This determination method will be described later.<!-- EPO <DP n="55"> --></p>
<p id="p0106" num="0106">Note that the input/output apparatus 130 may display analysis processing and post-processing displayed for the user such that the user can identify which one of the image capturing apparatus 110 and the detachable device 100 should perform each processing. For example, when creating an integrated processing list, the image capturing apparatus 110 makes the integrated processing list include information representing which one of the first processing list and the second processing list includes each analysis processing included in the integrated processing list. In accordance with the information representing which one of the first processing list and the second processing list includes each analysis processing included in the integrated processing list, the input/output apparatus 130 displays each analysis processing while changing the character color. This allows the user to confirm whether each processing is processing executable even if the detachable device 100 is removed. Note that if the image capturing apparatus 110 and the detachable device 100 can execute identical processes, and these are integrated and displayed as one process, this process can be displayed in a character color corresponding to the image capturing apparatus 110. This is because the process can be executed even if the detachable device 100 is removed. However, the present invention is not limited to this, and processing may be displayed in a character color representing that it is processing executable by both the image capturing apparatus 110 and the detachable device 100.</p>
<p id="p0107" num="0107">In addition, if processing that is executable when the image capturing apparatus 110 and the detachable device 100 cooperate is included in the integrated processing list, for the processing, information representing the necessity of cooperation may be included in the integrated processing list. In this case, processing implemented when the image capturing apparatus 110 and the detachable device 100 cooperate may be displayed in a still another character color. For example, face authentication processing can be implemented by a<!-- EPO <DP n="56"> --> function group of a face detection processing function, a face characteristic extraction processing function, and a face characteristic collation processing function. It is assumed that the image capturing apparatus 110 has the face detection processing function and the face characteristic extraction processing function, and the detachable device 100 has the face characteristic collation processing function. In this case, on the user interface 2101, for example, the face detection processing and the face characteristic extraction processing are displayed by blue characters, the face characteristic collation processing is displayed by red characters, and the face authentication processing is displayed by green characters.</p>
<p id="p0108" num="0108">Note that changing the character color is merely a form configured to display the functions such that which one of the image capturing apparatus 110 and the detachable device 100 should execute the functions or whether a function is executed by cooperation of these can be distinguished. Such distinguishable display may be done by another form. For example, the execution constituent of processing may explicitly be displayed by changing the background color of each processing. In addition, the difference of the execution constituent may be indicated by a character string. For example, a character string indicating the image capturing apparatus 110 can be added after a character string indicating processing to be executed by the image capturing apparatus 110, and a character string indicating the detachable device 100 can be added after a character string indicating processing to be executed by the detachable device 100. To a character string indicating processing implemented by cooperation of the image capturing apparatus 110 and the detachable device 100, a character string indicating cooperation of the image capturing apparatus 110 and the detachable device 100 can be added. As described above, the image capturing apparatus 110 provides, to the input/output apparatus 130, information representing<!-- EPO <DP n="57"> --> processes included in the first processing list and processes included in the second processing list in a distinguishable manner, thereby causing the display unit 703 of the input/output apparatus 130 to display the execution constituent of each process in a distinguishable manner. Even if the image capturing apparatus 110 includes a display unit, the execution constituent of each process can be displayed in a distinguishable manner by preparing information representing processes included in the first processing list and processes included in the second processing list in a distinguishable manner. That is, by outputting the information representing processes included in the first processing list and processes included in the second processing list in a distinguishable manner, the image capturing apparatus 110 can cause an arbitrary display device to display the execution constituent of each process in a distinguishable manner.</p>
<p id="p0109" num="0109">The user can select execution target processing from the integrated processing list displayed in the integrated processing list display area 2103 of the user interface 2101 via the operation unit 704. In addition, the user can select execution target post-processing from the processing list displayed in the post-processing list display area 2104 via the operation unit 704. For example, <figref idref="f0016">Fig. 21</figref> shows an example in which the user selects "face detection" processing as execution target analysis processing, and selects "display" and "storage" as execution target post-processing. Note that in this embodiment, an example in which only one execution target processing is selected is shown. However, the present invention is not limited to this. The system may be configured to allow the user to select a plurality of execution target processes. For example, in addition to "face detection", at least one of "human body detection" and "vehicle detection" may be selected. If one process is selected, selection of another process may be inhibited. As an example, if "human body detection" is selected in a state in which "face detection" is selected in the integrated processing list<!-- EPO <DP n="58"> --> display area 2103 shown in <figref idref="f0016">Fig. 21</figref>, selection of "face detection" may be canceled. <figref idref="f0016">Fig. 21</figref> shows an example in which both of two post-processes are selected. However, only one of them may be selectable.</p>
<p id="p0110" num="0110">Based on the selection of execution target processing and post-processing by the user, the image capturing apparatus 110 is notified of the selection result in step S1007 of <figref idref="f0007">Fig. 10</figref>. In addition, the control unit 702 of the input/output apparatus 130 may confirm the state of user selection for every predetermined period and notify the image capturing apparatus 110 of execution target processing depending on which processing is selected as the execution target. That is, the processes of steps S1005 to S1007 may periodically be executed, or selection in steps S1005 and S1006 may always be monitored, and the process of step S1007 may be executed when the selection state has changed.</p>
<p id="p0111" num="0111"><figref idref="f0016">Fig. 22</figref> shows an example of a method of displaying information in step S1203 in a case in which "face detection" is selected as the execution target processing, and "display" is selected as the execution target post-processing. In this example, the number 2201 of persons detected by face detection processing is displayed as the result of analysis processing on the screen of the user interface 2101 shown in <figref idref="f0016">Fig. 21</figref>. Note that <figref idref="f0016">Fig. 22</figref> is merely an example, and the result of processing may be displayed separately from the user interface 2101, and the result of processing may be displayed in another area of the user interface 2101.</p>
<p id="p0112" num="0112">In addition, a priority may be set for each of the execution target processing and post-processing selected by the user. For example, if a plurality of execution target processes exist, and priorities are set, the control unit 304 of the image capturing apparatus 110 executes processing (for example, the processes of steps S1103 to S1107) shown in <figref idref="f0008">Fig. 11</figref> for each execution target process in the order of priorities. Note that the calculation resource or network resource on the side of the image capturing apparatus 110 may be assigned based<!-- EPO <DP n="59"> --> on the priority. For example, a process of high priority may be executed for a video for every first predetermined number of frames, and a process of low priority may be executed for the video for every second predetermined number of frames, which is larger than the first predetermined number of frames. That is, the frequency of executing processing may be determined by priority. In addition, the frequency of transmitting the result of processing of high priority to the input/output apparatus 130 may be higher than the frequency of transmitting the result of processing of low priority to the input/output apparatus 130.</p>
<heading id="h0025">(Processing of Determining Processing Allocation between Image Capturing Apparatus and Detachable Device)</heading>
<p id="p0113" num="0113">When a plurality of processes are combined, a predetermined process may become executable. For example, face authentication processing can be executed by combining three processes, that is, face detection processing, face characteristic extraction processing, and face characteristic collation processing. If the image capturing apparatus 110 and the detachable device 100 can execute at least one of the three processes, the processes can be allocated between the apparatuses and executed. Additionally, in the image capturing apparatus 110 and the detachable device 100, for example, for at least one of the three processes described above, different processing functions suitable for each condition such as a condition (for example, an image capturing condition) under which data as the processing target is obtained or an analysis target can be prepared. For example, different processing functions may be prepared for processing for an image captured in daytime and processing for an image captured in nighttime. For example, as shown in <figref idref="f0017">Fig. 23</figref>, the image capturing apparatus 110 and the detachable device 100 are configured to have the face detection processing function, the face characteristic extraction processing function, and the face characteristic collation processing function and execute face authentication<!-- EPO <DP n="60"> --> processing. Note that even if the image capturing apparatus 110 and the detachable device 100 have the same functions, suitable conditions to use them can be different. In addition, each of the image capturing apparatus 110 and the detachable device 100 may have a plurality of processing functions capable of executing similar processes, like the detachable device 100 shown in <figref idref="f0017">Fig. 23</figref>, which has two face characteristic extraction processing functions. Accordingly, when processing is appropriately allocated between the image capturing apparatus 110 and the detachable device 100, processing suitable for various conditions can be executed.</p>
<p id="p0114" num="0114">Note that even if the image capturing apparatus 110 and the detachable device 100 perform the same processing, advantages and disadvantages occur because of the difference in the arrangement. For example, concerning the operation accuracy, the arithmetic processing unit 203 of the image capturing apparatus 110 can be advantageous because the bit width with respect to data is large. Concerning the operation speed, the detachable device 100 can be advantageous because the operation is performed by the logic circuit on the FPGA 402. If there exist a plurality of processing functions capable of executing the same processing, it is advantageous to select an appropriate processing function based on the environment of image capturing of the image capturing apparatus 110. Considering such circumstances, if the detachable device 100 has a processing function, it is important to appropriately determine whether to actually use the processing function and appropriately select a processing function to be used. Hence, a method of automatically selecting whether to cause the detachable device 100 to execute processing, whether to cause the image capturing apparatus 110 to execute processing, or whether to cause the image capturing apparatus 110 and the detachable device 100 to cooperatively execute processing will be described below. In addition, a method of automatically<!-- EPO <DP n="61"> --> selecting a processing function to be used by, for example, determining which one of a plurality of processing functions should be used in a case in which the image capturing apparatus 110 and the detachable device 100 have a plurality of processing functions capable of executing the same processing will also be described. Note that three processing examples will individually be described below, and these may be used in combination.</p>
<heading id="h0026">[First Processing Example]</heading>
<p id="p0115" num="0115">The fist processing example of selecting a processing function to be used will be described with reference to <figref idref="f0018">Fig. 24</figref>. In this example, to satisfy performance necessary for performing image analysis processing, a processing function to be used is selected from processing functions provided in the image capturing apparatus 110 and the detachable device 100. For example, this processing can be executed in a case in which there is a condition that, for example, processing needs to be performed at a predetermined frame rate or higher, and both the image capturing apparatus 110 and the detachable device 100 can execute the same processing.</p>
<p id="p0116" num="0116">In this processing, first, the user selects execution target processing via, for example, the user interface 2101 shown in <figref idref="f0016">Fig. 21</figref> on the input/output apparatus 130 (step S2401). Based on the user selection, the control unit 702 of the input/output apparatus 130 transmits an execution instruction command for the execution target processing to the image capturing apparatus 110. The control unit 304 of the image capturing apparatus 110 obtains the execution instruction command representing the selected process from the input/output apparatus 130. Note that if the image capturing apparatus 110 has an information presentation function of presenting executable processing and an operation acceptance function of causing the user to make a selection, the user may directly operate the image capturing apparatus 110 and instruct the execution target processing to the control<!-- EPO <DP n="62"> --> unit 304 of the image capturing apparatus 110.</p>
<p id="p0117" num="0117">The control unit 304 of the image capturing apparatus 110 confirms processing performance needed when executing the selected processing (step S2402). As for the setting of the processing performance, a set value may be determined in advance for each processing, or the user may set a target value when selecting processing. The control unit 304 executes, in the image capturing apparatus 110, the processing selected in step S2401 (step S2403). Note that this processing can be executed in parallel to image capturing. In addition, a function that exists only in the detachable device 100 in the processing functions to be used when executing the selected processing is executed by the detachable device 100 but not executed in the image capturing apparatus 110.</p>
<p id="p0118" num="0118">During execution of the processing of after completion of processing of a predetermined amount of data, the control unit 304 confirms whether the executed processing satisfies the processing performance set in step S2402 (step S2404). Upon confirming that the processing performance is satisfied (YES in step S2404), the control unit 304 returns the process to step S2403 to directly continue the processing. On the other hand, upon confirming that the processing performance is not satisfied (NO in step S2404), the control unit 304 advances the process to step S2405 to attempt a change to a processing allocation capable of satisfying the processing performance.</p>
<p id="p0119" num="0119">In step S2405, concerning processing that is a part of the processing executed by the image capturing apparatus 110 and is executable even in the detachable device 100, the execution constituent is changed to the detachable device 100. Since processes executable by the detachable device 100 are ascertained, the control unit 304 of the image capturing apparatus 110 selects processing to be transferred to the detachable device 100 from the list (second processing list) of processes and changes the execution constituent of the<!-- EPO <DP n="63"> --> processing. When the change is completed, the processing selected in step S2401 is allocated to the control unit 304 and the analysis unit 501 and executed (step S2406). After that, the control unit 304 confirms whether to return the processing function from the detachable device 100 to the image capturing apparatus 110 (step S2407). When the processing is returned to the image capturing apparatus 110, the processing can be executed at a higher operation accuracy.</p>
<p id="p0120" num="0120">If, for example, the reason why it is determined in step S2404 that the processing performance cannot be satisfied is a temporary high load state or the like, and the state is eliminated, the control unit 304 can determine that the process can be returned to the image capturing apparatus 110. That is, the control unit 304 can determine, based on the processing load of the image capturing apparatus 110, which one of the image capturing apparatus 110 and the detachable device 100 should execute the processing. Note that in addition to causing the detachable device 100 to execute processing in a state in which the processing load of the image capturing apparatus 110 is high, as described above, the image capturing apparatus 110 may be caused to execute processing in a state in which the processing load of the detachable device 100 is high. That is, which one of the image capturing apparatus 110 and the detachable device 100 should execute processing may be determined based on the processing load of the detachable device 100.</p>
<p id="p0121" num="0121">Additionally, if, for example, the target value of the processing performance is lowered by the user, the control unit 304 can determine that the processing can be returned to the image capturing apparatus 110. Upon determining to return the processing to the image capturing apparatus 110 (YES in step S2407), the control unit 304 changes the execution constituent of the part of the processing, which has been executed by the detachable device 100, to the<!-- EPO <DP n="64"> --> image capturing apparatus 110 (step S2408). Note that the processing whose execution constituent is returned to the image capturing apparatus 110 in step S2408 may be a part or whole of the processing whose execution constituent was changed to the detachable device 100 in step S2405. After the execution constituent of at least the part of the processing is returned to the image capturing apparatus 110, the control unit 304 returns the process to step S2403. On the other hand, upon determining not to return the processing to the image capturing apparatus 110 (NO in step S2407), the control unit 304 returns the process to step S2406 and continues the processing without changing the processing allocation.</p>
<p id="p0122" num="0122">Note that in a case in which the detachable device 100 has a plurality of processing functions capable of executing the same processing, if the processing performance cannot be satisfied after the execution constituent of the part of the processing is transferred to the detachable device 100, the processing function may be switched to the processing function for executing the same function. That is, in step S2407, instead of switching the execution constituent of the processing, the processing function to be used may be changed while keeping the detachable device 100 as the execution constituent.</p>
<p id="p0123" num="0123">In addition, even after the execution constituent of the part of the processing is transferred to the detachable device 100, if the processing performance confirmed in step S2402 cannot be satisfied, the control unit 304 may return the execution constituent of the processing to the image capturing apparatus 110. At this time, the control unit 304 can store information representing the processing performance confirmed in step S2402 as the information of the processing performance that cannot be satisfied by the current mounted detachable device 100. If similar processing performance or stricter processing performance is required, the control unit 304 may not cause the detachable device 100 to execute the processing. Similarly, for example, even in<!-- EPO <DP n="65"> --> a situation in which the processing load of the image capturing apparatus 110 is sufficiently small, if the processing performance confirmed in step S2402 cannot be satisfied, the information of the processing performance may be stored. In this case, in the subsequent processing, if the stored processing performance or stricter processing performance is confirmed in step S2402, the control unit 304 may transfer the execution constituent of a part of the processing on the detachable device 100 without executing the process of step S2403.</p>
<p id="p0124" num="0124">According to the first processing example, processing functions provided in the image capturing apparatus 110 and the detachable device 100 are selected, and processing is allocated between the apparatuses and executed to satisfy required processing performance. This makes it possible to perform appropriate processing allocation in accordance with, for example, the state of the image capturing apparatus 110 and maintain satisfactory processing performance.</p>
<heading id="h0027">[Second Processing Example]</heading>
<p id="p0125" num="0125">The second processing example of selecting a processing function to be used will be described next with reference to <figref idref="f0019">Fig. 25</figref>. This processing is executed when selecting a processing function to be used in a case in which the detachable device 100 has a plurality of processing functions capable of executing the same processing. Note that this processing can be executed in a case in which, for example, it is determined to cause the detachable device 100 to execute some processes in the first processing example. That is, when the detachable device 100 executes processing, this processing can be used by the detachable device 100 to determine which one of one or more processing functions capable of executing the processing should be used. However, this is merely an example, and processing allocation between the image capturing apparatus 110 and the detachable device 100 may be determined by this processing example. For example, if a plurality of processing functions capable of executing the same<!-- EPO <DP n="66"> --> processing exist in an integrated processing list in which processes executable by the image capturing apparatus 110 and the detachable device 100 are integrated, this processing example may be used to determine which one of the processing functions should be used. That is, if each of the image capturing apparatus 110 and the detachable device 100 has one or more processing functions capable of executing the same processing, this processing example can be used to determine which processing function should be used to execute process in which apparatus.</p>
<p id="p0126" num="0126">In this processing, first, as in step S2401 of <figref idref="f0018">Fig. 24</figref>, the user selects execution target processing on the input/output apparatus 130, and the control unit 304 of the image capturing apparatus 110 obtains information representing the selected processing from the input/output apparatus 130 (step S2501). The control unit 304 confirms the list (second processing list) of processes executable by the detachable device 100, and confirms, for the execution target processing, whether a plurality of processing functions capable of executing the same processing exist (step S2502). Upon determining that only one processing function capable of executing the execution target processing exists (NO in step S2502), the control unit 304 executes the processing using the processing function (step S2503). On the other hand, upon determining that a plurality of processing functions capable of executing the execution target processing exist (YES in step S2502), the control unit 304 advances the process to step S2504 to execute the processing using one of the plurality of processing functions.</p>
<p id="p0127" num="0127">In step S2504, the control unit 304 confirms the characteristic of each of the plurality of processing functions capable of executing the same processing that is the determination target of step S2502. Here, concerning, for example, face characteristic extraction, characteristics representing that a first processing function is suitable for processing an image of a relatively high brightness in daytime and a second processing function is suitable for processing an image of a<!-- EPO <DP n="67"> --> relatively low brightness in nighttime are confirmed. After the difference between the characteristics of the processing functions is confirmed, the control unit 304 confirms the current environment in which the image capturing apparatus 110 is performing image capturing (step S2505). Based on the characteristic of each processing function obtained in step S2504 and the information of the image capturing environment obtain in step S2505, the control unit 304 selects a processing function to be used in actual analysis processing (step S2506), and executes analysis processing using the selected processing function (step S2507).</p>
<p id="p0128" num="0128">Here, the confirmation of the image capturing environment can be done based on, for example, the internal clock of the image capturing apparatus 110 or the distribution of brightness values of an image captured by the image capturing apparatus 110. For example, if the internal clock indicates a nighttime zone, a processing function suitable for processing an image of a relatively low brightness value is selected. If the brightness values of the captured image localize on the low brightness side, a processing function suitable for processing an image of a relatively low brightness value is selected. Alternatively, the distribution of evaluation values of detection accuracy for a brightness value may be prepared for each processing function and, for example, a processing function for which the sum of values obtained by multiplying and adding the frequency of each brightness value of a captured image and a value indicating the detection accuracy of the brightness value is most excellent may be selected. The confirmation of the image capturing environment may be done based on, for example, the information of the angle of view (pan/tilt/zoom) at the time of image capturing of the image capturing apparatus 110. For example, a processing function to be used is selected based on, for example, which one of a dark area in a room or a bright area by a window is captured. Note that the characteristic of a processing function may be defined by an index other than the brightness value. For<!-- EPO <DP n="68"> --> example, various characteristics such as a high face extraction accuracy in an image including a predetermined object such as a window or a high detection accuracy for an object that is moving at a high speed can be used as the reference of selection of a processing function to be used. Additionally, for example, each processing function may have a characteristic representing that processing is performed at a high speed but at a low accuracy or a characteristic representing that processing is performed relatively at a low speed but at a high accuracy. A suitable processing function may be selected in accordance with a processing condition.</p>
<p id="p0129" num="0129">The control unit 304 confirms whether the image capturing environment has changed (step S2508). If the image capturing environment has changed (YES in step S2508), the control unit 304 executes the processing of selecting a processing function suitable for the environment after the change again (step S2506), and executes analysis processing by the selected processing function (step S2507). On the other hand, if the image capturing environment has not changed (NO in step S2508), the control unit 304 continues analysis processing without changing the processing function (step S2507).</p>
<p id="p0130" num="0130">According to this processing, it is possible to select a processing function suitable for the environment from a plurality of processing functions capable of executing the same processing and use the processing function. This makes it possible to selectively use an appropriate processing function for each environment from the viewpoint of accuracy of processing or the like.</p>
<heading id="h0028">[Third Processing Example]</heading>
<p id="p0131" num="0131">The third processing example of determining allocation of processing between the image capturing apparatus 110 and the detachable device 100 will be described next with reference to <figref idref="f0020">Fig. 26</figref>. In this processing, allocation of processing is determined based on whether processing can be completed only by<!-- EPO <DP n="69"> --> the combination of processing functions provided in the detachable device 100.</p>
<p id="p0132" num="0132">In this processing, first, as in step S2401 of <figref idref="f0018">Fig. 24</figref> or step S2501 of <figref idref="f0019">Fig. 25</figref>, the user selects execution target processing on the input/output apparatus 130, and the control unit 304 of the image capturing apparatus 110 obtains information representing the selected processing from the input/output apparatus 130 (step S2601). The control unit 304 determines whether the selected processing can be implemented (completed) only by the detachable device 100 (step S2602). Note that the control unit 304 can perform the determination of step S2602 based on, for example, whether all functions of the selected processing can be satisfied by the combinations of processing functions provided in the detachable device 100 or whether a processing result can be stored in the detachable device 100. For example, if all functions of the selected processing can be satisfied by the combinations of the processing functions provided in the detachable device 100, and the processing result can be stored in the detachable device 100, the control unit 304 determines that the processing can be completed only by the detachable device 100.</p>
<p id="p0133" num="0133">Upon determining that the selected processing cannot be completed only by the detachable device 100 (NO in step S2602), the control unit 304 allocates the processing between the image capturing apparatus 110 and the detachable device 100 (step S2603). In this case, processing allocation in the first processing example and the second processing example can be performed. Note that in this case, all processes may be executed by the image capturing apparatus 110, that is, use of the processing functions of the detachable device 100 may be inhibited. On the other hand, upon determining that the selected processing can be completed only by the detachable device 100 (YES in step S2602), the control unit 304 selects which processing function of the processing functions provided in the detachable device 100 should be used (step S2604). Note that if the<!-- EPO <DP n="70"> --> detachable device 100 has a plurality of processing functions capable of executing the same processing, which processing function should be used is selected as in the second processing example. After that, the control unit 304 executes processing of causing the detachable device 100 to execute image analysis processing using the selected processing function (step S2605). In addition, the control unit 304 executes processing of storing, in the detachable device 100, the result of performing image analysis processing in step S2605 (step S2606). These processes are executed using, for example, commands of the SD standard. Note that in step S2606, the result may be stored in the storage unit 404, or if a RAM is provided in the FPGA 402, the result may be stored in the RAM</p>
<p id="p0134" num="0134">In this processing example, if processing can be completed in the detachable device 100, the detachable device 100 is caused to execute the processing. Accordingly, processing to be executed by the image capturing apparatus 110 is only image transmission to the detachable device 100, and the processing load can greatly be reduced.</p>
<p id="p0135" num="0135">In the above-described way, functions executable on the side of the image capturing apparatus 110 are increased using the detachable device 100, thereby enhancing processing functions in the system. For example, when a latest processing function is implemented in the detachable device 100, image analysis processing by the latest processing function can be executed on the side of the image capturing apparatus 110 without replacing the image capturing apparatus 110. This can flexibly operate the system and improve the convenience.</p>
<p id="p0136" num="0136">In the above-described embodiment, image analysis processing has been described as an example of analysis processing. However, the present invention is also applicable to audio analysis processing. For example, the present invention can be applied to processing of detecting an audio pattern such as a<!-- EPO <DP n="71"> --> scream, a gunshot, or glass breaking sound. For example, a characteristic amount of an audio is extracted by various audio data analysis methods such as spectrum analysis, and the extracted characteristic amount is compared with the detected audio pattern. By calculating the degree of matching, a specific audio pattern can be detected.</p>
<p id="p0137" num="0137">When performing audio analysis processing, audio data is divided into audio data of a predetermined time, audio analysis processing is performed using the audio data of the predetermined time as a unit. In addition, the predetermined time appropriately changes depending on the audio pattern of the detection target. For this reason, audio data of a time corresponding to an audio pattern to be detected is input to the detachable device 100. The detachable device 100 has a function of analyzing the input audio data or a function of holding the input audio data.</p>
<p id="p0138" num="0138">In the above-described embodiment, the detachable device 100 capable of non-temporarily storing data input from the image capturing apparatus 110 has been described as an example. However, in some embodiments, the detachable device 100 that cannot non-temporarily store data input from the image capturing apparatus 110 may be used. That is, the detachable device 100 may only perform analysis processing for data input from the image capturing apparatus 110, and need not have the function of non-temporarily storing the data. In other words, the detachable device 100 may be not assumed to be used to store data, like a normal SD card, and may have only the function of analysis processing.</p>
<heading id="h0029">Other Embodiments</heading>
<p id="p0139" num="0139">Embodiment(s) of the present invention can also be realized by a computer of a system or apparatus that reads out and executes computer executable instructions (e.g., one or more programs) recorded on a storage medium (which may also be referred to more fully as a 'non-transitory computer-readable<!-- EPO <DP n="72"> --> storage medium') to perform the functions of one or more of the above-described embodiment(s) and/or that includes one or more circuits (e.g., application specific integrated circuit (ASIC)) for performing the functions of one or more of the above-described embodiment(s), and by a method performed by the computer of the system or apparatus by, for example, reading out and executing the computer executable instructions from the storage medium to perform the functions of one or more of the above-described embodiment(s) and/or controlling the one or more circuits to perform the functions of one or more of the above-described embodiment(s). The computer may comprise one or more processors (e.g., central processing unit (CPU), micro processing unit (MPU)) and may include a network of separate computers or separate processors to read out and execute the computer executable instructions. The computer executable instructions may be provided to the computer, for example, from a network or the storage medium. The storage medium may include, for example, one or more of a hard disk, a random-access memory (RAM), a read only memory (ROM), a storage of distributed computing systems, an optical disk (such as a compact disc (CD), digital versatile disc (DVD), or Blu-ray Disc (BD)™), a flash memory device, a memory card, and the like.</p>
<p id="p0140" num="0140">While the present invention has been described with reference to exemplary embodiments, it is to be understood that the invention is not limited to the disclosed exemplary embodiments. The scope of the following claims is to be accorded the broadest interpretation so as to encompass all such modifications and equivalent structures and functions.</p>
<p id="p0141" num="0141">An image capturing apparatus (110) that includes a mounting part (205) capable of attaching/detaching a device (100) capable of holding at least an image captured by the image capturing apparatus and capable of communicating with the<!-- EPO <DP n="73"> --> mounted device in accordance with a predetermined standard is provided. The apparatus outputs to a device, if the device having a function of executing image analysis processing for image data captured by the apparatus is mounted in the mounting part, a command complying with the predetermined standard and causing the device to execute the image analysis processing. The apparatus outputs at least two commands associated with each other and causing the device to execute the image analysis processing, wherein each of the at least two commands includes data representing that the at least two commands are associated with each other.</p>
</description>
<claims id="claims01" lang="en"><!-- EPO <DP n="74"> -->
<claim id="c-en-0001" num="0001">
<claim-text>An image capturing apparatus (110) comprising:
<claim-text>a mounting part (205) capable of attaching/detaching a device (100) capable of holding at least an image captured by the image capturing apparatus and capable of communicating with the mounted device in accordance with a predetermined standard; and</claim-text>
<claim-text>output means for, if a device having a function of executing image analysis processing for image data captured by the image capturing apparatus is mounted in the mounting part, outputting, to the device, a command complying with the predetermined standard and configured to cause the device to execute the image analysis processing,</claim-text>
<claim-text>wherein the output means outputs at least two commands associated with each other and configured to cause the device to execute the image analysis processing, and each of the at least two commands includes data representing that the at least two commands are associated with each other.</claim-text></claim-text></claim>
<claim id="c-en-0002" num="0002">
<claim-text>The apparatus according to claim 1, wherein the device can store at least the image data, and<br/>
when causing the device to store the image data without causing the device to execute the image analysis processing, the output means outputs one predetermined command.</claim-text></claim>
<claim id="c-en-0003" num="0003">
<claim-text>The apparatus according to claim 1 or 2, wherein the command output by the output means includes an area where information according to a type of the command is stored,<br/>
a data length of the area of each of the at least two commands is shorter than the data length of the area in a command that is not associated with the image analysis processing, and<br/>
the data representing that the at least two commands are associated with<!-- EPO <DP n="75"> --> each other is included in each of the at least two commands and is not included in the command that is not associated with the image analysis processing.</claim-text></claim>
<claim id="c-en-0004" num="0004">
<claim-text>The apparatus according to claim 3, wherein the output means divides one data into a plurality of partial data, and different partial data are stored in the areas of the at least two commands.</claim-text></claim>
<claim id="c-en-0005" num="0005">
<claim-text>The apparatus according to any one of claims 1 to 4, wherein the predetermined standard is an SD standard.</claim-text></claim>
<claim id="c-en-0006" num="0006">
<claim-text>A device (100) mounted in a mounting part (205) of an image capturing apparatus (110) including the mounting part capable of attaching/detaching a device capable of holding at least an image captured by the image capturing apparatus and capable of communicating with the mounted device in accordance with a predetermined standard, comprising:
<claim-text>processing means for executing image analysis processing for image data captured by the image capturing apparatus; and</claim-text>
<claim-text>obtaining means for obtaining, from the image capturing apparatus, a command complying with the predetermined standard and configured to cause the device to execute the image analysis processing,</claim-text>
<claim-text>wherein the processing means executes the image analysis processing if the obtaining means obtains at least two commands associated with each other, and each of the at least two commands includes data representing that the at least two commands are associated with each other.</claim-text></claim-text></claim>
<claim id="c-en-0007" num="0007">
<claim-text>The device according to claim 6, further comprising storage means capable of storing at least image data concerning the image captured by the image capturing apparatus,<br/>
wherein if the obtaining means obtains one predetermined command that does not include the data representing that the at least two commands are associated with each other, the processing means does not execute the image<!-- EPO <DP n="76"> --> analysis processing, and the storage means stores the image data.</claim-text></claim>
<claim id="c-en-0008" num="0008">
<claim-text>The device according to claim 6 or 7, wherein the command obtained by the obtaining means includes an area where information according to a type of the command is stored,<br/>
a data length of the area of each of the at least two commands is shorter than the data length of the area in a command that is not associated with the image analysis processing, and<br/>
the data representing that the at least two commands are associated with each other is included in each of the at least two commands and is not included in the command that is not associated with the image analysis processing.</claim-text></claim>
<claim id="c-en-0009" num="0009">
<claim-text>The device according to claim 8, wherein the obtaining means obtains one data by combining different partial data stored in the areas of the at least two commands.</claim-text></claim>
<claim id="c-en-0010" num="0010">
<claim-text>The device according to any one of claims 6 to 9, wherein the predetermined standard is an SD standard.</claim-text></claim>
<claim id="c-en-0011" num="0011">
<claim-text>A control method executed by an image capturing apparatus (110) including a mounting part (205) capable of attaching/detaching a device (100) capable of holding at least an image captured by the image capturing apparatus and capable of communicating with the mounted device in accordance with a predetermined standard, comprising<br/>
if a device having a function of executing image analysis processing for image data captured by the image capturing apparatus is mounted in the mounting part, outputting, to the device, a command complying with the predetermined standard and configured to cause the device to execute the image analysis processing,<br/>
wherein when outputting the command, at least two commands associated with each other and configured to cause the device to execute the<!-- EPO <DP n="77"> --> image analysis processing are output, and each of the at least two commands includes data representing that the at least two commands are associated with each other.</claim-text></claim>
<claim id="c-en-0012" num="0012">
<claim-text>A control method executed by a device (100) mounted in a mounting part of an image capturing apparatus (110) including the mounting part (205) capable of attaching/detaching a device capable of holding at least an image captured by the image capturing apparatus and capable of communicating with the mounted device in accordance with a predetermined standard, and having a function of executing image analysis processing for image data captured by the image capturing apparatus, comprising:
<claim-text>obtaining, from the image capturing apparatus, a command complying with the predetermined standard and configured to cause the device to execute the image analysis processing; and</claim-text>
<claim-text>executing the image analysis processing if at least two commands associated with each other are obtained, and each of the at least two commands includes data representing that the at least two commands are associated with each other.</claim-text></claim-text></claim>
<claim id="c-en-0013" num="0013">
<claim-text>A program configured to cause a computer to operate as an image capturing apparatus defined in any one of claims 1 to 5.</claim-text></claim>
<claim id="c-en-0014" num="0014">
<claim-text>A program configured to cause a computer to operate as a device defined in any one of claims 6 to 10.</claim-text></claim>
</claims>
<drawings id="draw" lang="en"><!-- EPO <DP n="78"> -->
<figure id="f0001" num="1,2"><img id="if0001" file="imgf0001.tif" wi="157" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="79"> -->
<figure id="f0002" num="3"><img id="if0002" file="imgf0002.tif" wi="129" he="151" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="80"> -->
<figure id="f0003" num="4,5"><img id="if0003" file="imgf0003.tif" wi="158" he="225" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="81"> -->
<figure id="f0004" num="6,7"><img id="if0004" file="imgf0004.tif" wi="126" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="82"> -->
<figure id="f0005" num="8"><img id="if0005" file="imgf0005.tif" wi="125" he="192" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="83"> -->
<figure id="f0006" num="9"><img id="if0006" file="imgf0006.tif" wi="146" he="176" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="84"> -->
<figure id="f0007" num="10"><img id="if0007" file="imgf0007.tif" wi="157" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="85"> -->
<figure id="f0008" num="11"><img id="if0008" file="imgf0008.tif" wi="158" he="211" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="86"> -->
<figure id="f0009" num="12"><img id="if0009" file="imgf0009.tif" wi="136" he="190" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="87"> -->
<figure id="f0010" num="13A,13B,14"><img id="if0010" file="imgf0010.tif" wi="147" he="227" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="88"> -->
<figure id="f0011" num="15"><img id="if0011" file="imgf0011.tif" wi="97" he="219" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="89"> -->
<figure id="f0012" num="16"><img id="if0012" file="imgf0012.tif" wi="141" he="178" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="90"> -->
<figure id="f0013" num="17"><img id="if0013" file="imgf0013.tif" wi="141" he="178" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="91"> -->
<figure id="f0014" num="18"><img id="if0014" file="imgf0014.tif" wi="141" he="178" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="92"> -->
<figure id="f0015" num="19"><img id="if0015" file="imgf0015.tif" wi="153" he="218" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="93"> -->
<figure id="f0016" num="20,21,22"><img id="if0016" file="imgf0016.tif" wi="157" he="233" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="94"> -->
<figure id="f0017" num="23"><img id="if0017" file="imgf0017.tif" wi="135" he="121" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="95"> -->
<figure id="f0018" num="24"><img id="if0018" file="imgf0018.tif" wi="146" he="224" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="96"> -->
<figure id="f0019" num="25"><img id="if0019" file="imgf0019.tif" wi="153" he="213" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="97"> -->
<figure id="f0020" num="26"><img id="if0020" file="imgf0020.tif" wi="158" he="167" img-content="drawing" img-format="tif"/></figure>
</drawings>
<search-report-data id="srep" lang="en" srep-office="EP" date-produced=""><doc-page id="srep0001" file="srep0001.tif" wi="157" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="155" he="233" type="tif"/></search-report-data><search-report-data date-produced="20210804" id="srepxml" lang="en" srep-office="EP" srep-type="ep-sr" status="n"><!--
 The search report data in XML is provided for the users' convenience only. It might differ from the search report of the PDF document, which contains the officially published data. The EPO disclaims any liability for incorrect or incomplete data in the XML for search reports.
 -->

<srep-info><file-reference-id>EP102651</file-reference-id><application-reference><document-id><country>EP</country><doc-number>21161689.1</doc-number></document-id></application-reference><applicant-name><name>CANON KABUSHIKI KAISHA</name></applicant-name><srep-established srep-established="yes"/><srep-invention-title title-approval="yes"/><srep-abstract abs-approval="yes"/><srep-figure-to-publish figinfo="by-applicant"><figure-to-publish><fig-number>19</fig-number></figure-to-publish></srep-figure-to-publish><srep-info-admin><srep-office><addressbook><text>DH</text></addressbook></srep-office><date-search-report-mailed><date>20210812</date></date-search-report-mailed></srep-info-admin></srep-info><srep-for-pub><srep-fields-searched><minimum-documentation><classifications-ipcr><classification-ipcr><text>H04N</text></classification-ipcr></classifications-ipcr></minimum-documentation></srep-fields-searched><srep-citations><citation id="sr-cit0001"><patcit dnum="US2012254796A1" id="sr-pcit0001" url="http://v3.espacenet.com/textdoc?DB=EPODOC&amp;IDX=US2012254796&amp;CY=ep"><document-id><country>US</country><doc-number>2012254796</doc-number><kind>A1</kind><name>TAN JOON YONG WAYNE [SG]</name><date>20121004</date></document-id></patcit><category>X</category><rel-claims>1,2,5-7,10-14</rel-claims><category>A</category><rel-claims>3,4,8,9</rel-claims><rel-passage><passage>* paragraph [0052] - paragraph [0084] *</passage></rel-passage><rel-passage><passage>* figures 1-7 *</passage></rel-passage></citation><citation id="sr-cit0002"><patcit dnum="US2020073796A1" id="sr-pcit0002" url="http://v3.espacenet.com/textdoc?DB=EPODOC&amp;IDX=US2020073796&amp;CY=ep"><document-id><country>US</country><doc-number>2020073796</doc-number><kind>A1</kind><name>KATSUMATA KOHEI [JP]</name><date>20200305</date></document-id></patcit><category>A</category><rel-claims>1-14</rel-claims><rel-passage><passage>* claims 5,6 *</passage></rel-passage></citation></srep-citations><srep-admin><examiners><primary-examiner><name>Didierlaurent, P</name></primary-examiner></examiners><srep-office><addressbook><text>The Hague</text></addressbook></srep-office><date-search-completed><date>20210804</date></date-search-completed></srep-admin><!--							The annex lists the patent family members relating to the patent documents cited in the above mentioned European search report.							The members are as contained in the European Patent Office EDP file on							The European Patent Office is in no way liable for these particulars which are merely given for the purpose of information.							For more details about this annex : see Official Journal of the European Patent Office, No 12/82						--><srep-patent-family><patent-family><priority-application><document-id><country>US</country><doc-number>2012254796</doc-number><kind>A1</kind><date>20121004</date></document-id></priority-application><family-member><document-id><country>AU</country><doc-number>2010332369</doc-number><kind>A1</kind><date>20120719</date></document-id></family-member><family-member><document-id><country>CA</country><doc-number>2783559</doc-number><kind>A1</kind><date>20110623</date></document-id></family-member><family-member><document-id><country>CN</country><doc-number>102782663</doc-number><kind>A</kind><date>20121114</date></document-id></family-member><family-member><document-id><country>EA</country><doc-number>201290494</doc-number><kind>A1</kind><date>20130130</date></document-id></family-member><family-member><document-id><country>EP</country><doc-number>2513801</doc-number><kind>A1</kind><date>20121024</date></document-id></family-member><family-member><document-id><country>GB</country><doc-number>2491988</doc-number><kind>A</kind><date>20121219</date></document-id></family-member><family-member><document-id><country>JP</country><doc-number>5539534</doc-number><kind>B2</kind><date>20140702</date></document-id></family-member><family-member><document-id><country>JP</country><doc-number>2013514580</doc-number><kind>A</kind><date>20130425</date></document-id></family-member><family-member><document-id><country>KR</country><doc-number>20120106972</doc-number><kind>A</kind><date>20120927</date></document-id></family-member><family-member><document-id><country>MY</country><doc-number>158321</doc-number><kind>A</kind><date>20160930</date></document-id></family-member><family-member><document-id><country>NZ</country><doc-number>601023</doc-number><kind>A</kind><date>20140131</date></document-id></family-member><family-member><document-id><country>SG</country><doc-number>181499</doc-number><kind>A1</kind><date>20120730</date></document-id></family-member><family-member><document-id><country>TW</country><doc-number>201140432</doc-number><kind>A</kind><date>20111116</date></document-id></family-member><family-member><document-id><country>US</country><doc-number>2012254796</doc-number><kind>A1</kind><date>20121004</date></document-id></family-member><family-member><document-id><country>WO</country><doc-number>2011075076</doc-number><kind>A1</kind><date>20110623</date></document-id></family-member><family-member><document-id><country>WO</country><doc-number>2011075078</doc-number><kind>A1</kind><date>20110623</date></document-id></family-member></patent-family><patent-family><priority-application><document-id><country>US</country><doc-number>2020073796</doc-number><kind>A1</kind><date>20200305</date></document-id></priority-application><family-member><document-id><country>CN</country><doc-number>110876030</doc-number><kind>A</kind><date>20200310</date></document-id></family-member><family-member><document-id><country>US</country><doc-number>2020073796</doc-number><kind>A1</kind><date>20200305</date></document-id></family-member></patent-family></srep-patent-family></srep-for-pub></search-report-data>
<ep-reference-list id="ref-list">
<heading id="ref-h0001"><b>REFERENCES CITED IN THE DESCRIPTION</b></heading>
<p id="ref-p0001" num=""><i>This list of references cited by the applicant is for the reader's convenience only. It does not form part of the European patent document. Even though great care has been taken in compiling the references, errors or omissions cannot be excluded and the EPO disclaims all liability in this regard.</i></p>
<heading id="ref-h0002"><b>Patent documents cited in the description</b></heading>
<p id="ref-p0002" num="">
<ul id="ref-ul0001" list-style="bullet">
<li><patcit id="ref-pcit0001" dnum="JP2003196613A"><document-id><country>JP</country><doc-number>2003196613</doc-number><kind>A</kind></document-id></patcit><crossref idref="pcit0001">[0092]</crossref><crossref idref="pcit0002">[0093]</crossref></li>
</ul></p>
<heading id="ref-h0003"><b>Non-patent literature cited in the description</b></heading>
<p id="ref-p0003" num="">
<ul id="ref-ul0002" list-style="bullet">
<li><nplcit id="ref-ncit0001" npl-type="s"><article><author><name>J. REDMON</name></author><author><name>A. FARHADI</name></author><atl>YOL09000: Better Faster Stronger</atl><serial><sertitle>Computer Vision and Pattern Recognition (CVPR)</sertitle><pubdate><sdate>20160000</sdate><edate/></pubdate></serial></article></nplcit><crossref idref="ncit0001">[0024]</crossref></li>
</ul></p>
</ep-reference-list>
</ep-patent-document>
