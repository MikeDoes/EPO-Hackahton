<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE ep-patent-document PUBLIC "-//EPO//EP PATENT DOCUMENT 1.5.1//EN" "ep-patent-document-v1-5-1.dtd">
<!-- This XML data has been generated under the supervision of the European Patent Office -->
<ep-patent-document id="EP19902450A1" file="EP19902450NWA1.xml" lang="en" country="EP" doc-number="3890370" kind="A1" date-publ="20211006" status="n" dtd-version="ep-patent-document-v1-5-1">
<SDOBI lang="en"><B000><eptags><B001EP>ATBECHDEDKESFRGBGRITLILUNLSEMCPTIESILTLVFIROMKCYALTRBGCZEEHUPLSKBAHRIS..MTNORSMESMMAKHTNMD..........</B001EP><B005EP>J</B005EP><B007EP>BDM Ver 2.0.12 (4th of August) -  1100000/0</B007EP></eptags></B000><B100><B110>3890370</B110><B120><B121>EUROPEAN PATENT APPLICATION</B121><B121EP>published in accordance with Art. 153(4) EPC</B121EP></B120><B130>A1</B130><B140><date>20211006</date></B140><B190>EP</B190></B100><B200><B210>19902450.6</B210><B220><date>20191220</date></B220><B240><B241><date>20210630</date></B241></B240><B250>zh</B250><B251EP>en</B251EP><B260>en</B260></B200><B300><B310>201811611661</B310><B320><date>20181227</date></B320><B330><ctry>CN</ctry></B330></B300><B400><B405><date>20211006</date><bnum>202140</bnum></B405><B430><date>20211006</date><bnum>202140</bnum></B430></B400><B500><B510EP><classification-ipcr sequence="1"><text>H04W   4/40        20180101AFI20200703BHEP        </text></classification-ipcr><classification-ipcr sequence="2"><text>H04W  28/10        20090101ALI20200703BHEP        </text></classification-ipcr><classification-ipcr sequence="3"><text>H04W  40/24        20090101ALI20200703BHEP        </text></classification-ipcr><classification-ipcr sequence="4"><text>H04W  76/10        20180101ALI20200703BHEP        </text></classification-ipcr></B510EP><B520EP><classifications-cpc><classification-cpc sequence="1"><text>H04W  76/10        20180201 LI20200725BCEP        </text></classification-cpc><classification-cpc sequence="2"><text>H04W  40/24        20130101 LI20200725BCEP        </text></classification-cpc><classification-cpc sequence="3"><text>H04W  28/10        20130101 LI20200725BCEP        </text></classification-cpc><classification-cpc sequence="4"><text>H04W   4/40        20180201 LI20200725BCEP        </text></classification-cpc></classifications-cpc></B520EP><B540><B541>de</B541><B542>KOMMUNIKATIONSVERFAHREN UND -VORRICHTUNG</B542><B541>en</B541><B542>COMMUNICATION METHOD AND APPARATUS</B542><B541>fr</B541><B542>PROCÉDÉ ET APPAREIL DE COMMUNICATION</B542></B540><B590><B598>3</B598></B590></B500><B700><B710><B711><snm>Huawei Technologies Co., Ltd.</snm><iid>101903059</iid><irf>P57935/EP</irf><adr><str>Huawei Administration Building, 
Bantian, Longgang District</str><city>Shenzhen Guangdong 518129</city><ctry>CN</ctry></adr></B711></B710><B720><B721><snm>ZHANG, Chengchen</snm><adr><str>Huawei Administration Building
Bantian, Longgang District</str><city>Shenzhen, Guangdong 518129</city><ctry>CN</ctry></adr></B721><B721><snm>WU, Wenfu</snm><adr><str>Huawei Administration Building
Bantian, Longgang District</str><city>Shenzhen, Guangdong 518129</city><ctry>CN</ctry></adr></B721><B721><snm>ZONG, Zaifeng</snm><adr><str>Huawei Administration Building
Bantian, Longgang District</str><city>Shenzhen, Guangdong 518129</city><ctry>CN</ctry></adr></B721></B720><B740><B741><snm>Thun, Clemens</snm><iid>101429838</iid><adr><str>Mitscherlich PartmbB 
Patent- und Rechtsanwälte 
Sonnenstraße 33</str><city>80331 München</city><ctry>DE</ctry></adr></B741></B740></B700><B800><B840><ctry>AL</ctry><ctry>AT</ctry><ctry>BE</ctry><ctry>BG</ctry><ctry>CH</ctry><ctry>CY</ctry><ctry>CZ</ctry><ctry>DE</ctry><ctry>DK</ctry><ctry>EE</ctry><ctry>ES</ctry><ctry>FI</ctry><ctry>FR</ctry><ctry>GB</ctry><ctry>GR</ctry><ctry>HR</ctry><ctry>HU</ctry><ctry>IE</ctry><ctry>IS</ctry><ctry>IT</ctry><ctry>LI</ctry><ctry>LT</ctry><ctry>LU</ctry><ctry>LV</ctry><ctry>MC</ctry><ctry>MK</ctry><ctry>MT</ctry><ctry>NL</ctry><ctry>NO</ctry><ctry>PL</ctry><ctry>PT</ctry><ctry>RO</ctry><ctry>RS</ctry><ctry>SE</ctry><ctry>SI</ctry><ctry>SK</ctry><ctry>SM</ctry><ctry>TR</ctry></B840><B844EP><B845EP><ctry>BA</ctry></B845EP><B845EP><ctry>ME</ctry></B845EP></B844EP><B848EP><B849EP><ctry>KH</ctry></B849EP><B849EP><ctry>MA</ctry></B849EP><B849EP><ctry>MD</ctry></B849EP><B849EP><ctry>TN</ctry></B849EP></B848EP><B860><B861><dnum><anum>CN2019127195</anum></dnum><date>20191220</date></B861><B862>zh</B862></B860><B870><B871><dnum><pnum>WO2020135274</pnum></dnum><date>20200702</date><bnum>202027</bnum></B871></B870></B800></SDOBI>
<abstract id="abst" lang="en">
<p id="pa01" num="0001">This application provides a communication method and apparatus. According to the communication method, a session management function SMF receives a first message sent by a first terminal apparatus. The first message is used to request the SMF to establish a first session for the first terminal apparatus. The first message is further used to indicate that the first session is used for communication between the first terminal apparatus and a second terminal apparatus. The first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system. Then, the SMF sends address information of the first terminal apparatus to a first management network element based on the first message. This provides a possibility of exchanging address information of terminal apparatuses in an unmanned aerial vehicle communication system.<img id="iaf01" file="imgaf001.tif" wi="91" he="73" img-content="drawing" img-format="tif"/></p>
</abstract>
<description id="desc" lang="en"><!-- EPO <DP n="1"> -->
<heading id="h0001"><b>CROSS-REFERENCE TO RELATED APPLICATIONS</b></heading>
<p id="p0001" num="0001">This application claims priority to <patcit id="pcit0001" dnum="CN201811611661" dnum-type="L"><text>Chinese Patent Application No. 201811611661.2</text></patcit>, filed with Chinese Patent Office on December 27, 2018 and entitled "COMMUNICATION METHOD AND APPARATUS", which is incorporated herein by reference in its entirety.</p>
<heading id="h0002"><b>TECHNICAL FIELD</b></heading>
<p id="p0002" num="0002">This application relates to the field of mobile communication technologies, and in particular, to a communication method and apparatus.</p>
<heading id="h0003"><b>BACKGROUND</b></heading>
<p id="p0003" num="0003">In recent years, an unmanned aerial vehicle industry develops rapidly. A scenario of communication between an unmanned aerial vehicle controller and an unmanned aerial vehicle accordingly changes. Currently, for short-distance control, address information may be exchanged between the unmanned aerial vehicle controller and the unmanned aerial vehicle by using a Bluetooth low energy (bluetoothlowenergy, BLE) technology, a wireless local area network, and the like, to implement pairing and connection. For long-distance control, especially control in a non-line-of-sight scenario, the unmanned aerial vehicle controller and the unmanned aerial vehicle may need to implement pairing and connection by using a 3rd generation partnership project (3rd generation partnership project, 3GPP) network. For this scenario, the 3GPP provides a new traffic management entity to manage the address information of the unmanned aerial vehicle controller and the unmanned aerial vehicle.</p>
<p id="p0004" num="0004">However, currently in the 3 GPP network, the unmanned aerial vehicle controller and the unmanned aerial vehicle are connected to the network only as common terminal apparatuses, and the address information cannot be exchanged between the unmanned aerial vehicle controller and the unmanned aerial vehicle.<!-- EPO <DP n="2"> --></p>
<heading id="h0004"><b>SUMMARY</b></heading>
<p id="p0005" num="0005">This application provides a communication method and apparatus, to exchange address information between an unmanned aerial vehicle controller and an unmanned aerial vehicle in a 3GPP network.</p>
<p id="p0006" num="0006">According to a first aspect, this application provides a communication method. The communication method may be implemented by a session management function SMF. Specifically, the SMF may receive a first message sent by a first terminal apparatus. The first message is used to request the SMF to establish a first session for the first terminal apparatus. The first message is further used to indicate that the first session is used for communication between the first terminal apparatus and a second terminal apparatus. The first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system. Then, the SMF sends address information of the first terminal apparatus to a first management network element based on the first message. The address information of the first terminal apparatus is used to indicate an address of the first terminal apparatus and/or an address of a user plane function UPF corresponding to the first terminal apparatus.</p>
<p id="p0007" num="0007">By using the foregoing method, after the first message is received and if the first message is used to indicate that the first session is used to indicate the first terminal apparatus and the second terminal apparatus in the same unmanned aerial vehicle communication system to communicate with each other, the SMF sends the address information of the first terminal apparatus to the first management network element. This provides a possibility of exchanging address information of terminal apparatuses in an unmanned aerial vehicle communication system.</p>
<p id="p0008" num="0008">In a possible design, if the first management network element includes a traffic management entity and after the SMF sends the address information of the first terminal apparatus to the first management network element, the SMF receives address information of the second terminal apparatus from the traffic management entity. The address information of the second terminal apparatus is used to indicate an address of the second terminal apparatus and/or an address of a UPF corresponding to the second terminal apparatus.</p>
<p id="p0009" num="0009">In a possible design, the SMF may determine a first rule based on the address information of the second terminal apparatus, and send the first rule to the UPF corresponding to the first terminal apparatus. The first rule is used to indicate a routing rule from the first terminal apparatus to the second terminal apparatus and/or a data packet filtering rule between the first terminal apparatus and the second terminal apparatus. Alternatively, the SMF may send the address information of the second terminal apparatus to the UPF corresponding to the first terminal apparatus.</p>
<p id="p0010" num="0010">In a possible design, the SMF may allocate, based on the address information of the second terminal apparatus, a tunnel corresponding to the first session, and send information about the tunnel to the UPF corresponding to the first terminal apparatus. The tunnel is used for the communication between the first terminal apparatus and the<!-- EPO <DP n="3"> --> second terminal apparatus.</p>
<p id="p0011" num="0011">In a possible design, the SMF may send a second message to the traffic management entity. The second message is used to subscribe to the address information of the second terminal apparatus. Then, the SMF may receive the address information of the second terminal apparatus from the traffic management entity. In an implementation, the second message may include an identifier of the second terminal apparatus.</p>
<p id="p0012" num="0012">In a possible design, if the first management network element includes a traffic management entity, the SMF may further send an identifier of a PCF, address information of the PCF, or a portion of or all information of the identifier of the second terminal apparatus to the traffic management entity, so that the traffic management entity determines to send address information of the second terminal apparatus to the PCF, to trigger the PCF to generate a session management policy of the first session between the first terminal apparatus and the second terminal apparatus.</p>
<p id="p0013" num="0013">In a possible design, the first management network element includes a PCF. The SMF may further send an identifier of the second terminal apparatus to the PCF after sending the address information of the first terminal apparatus to the PCF.</p>
<p id="p0014" num="0014">In a possible design, the SMF may receive a session management policy of the first session from the PCF. The SMF may further determine a second rule according to the session management policy of the first session. The second rule is used to indicate a routing rule from the first terminal apparatus to the second terminal apparatus and/or a data packet filtering rule between the first terminal apparatus and the second terminal apparatus. The SMF may send the second rule to the UPF corresponding to the first terminal apparatus.</p>
<p id="p0015" num="0015">In a possible design, if the first management network element includes a traffic management entity, the SMF may further receive a first response message from the traffic management entity. The first response message is used to indicate that the traffic management entity completes storage of the address information of the first terminal apparatus.</p>
<p id="p0016" num="0016">In addition, if the communication method is implemented by a first terminal apparatus, the first terminal apparatus may generate a first message. The first message may be used to request an SMF to establish a first session for the first terminal apparatus, and the first message is used to indicate that the first session is used for communication between the first terminal apparatus and a second terminal apparatus. The first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system. Then, the first terminal apparatus may send the first message to the SMF.</p>
<p id="p0017" num="0017">In a possible design, the first message may further carry an identifier of the second terminal apparatus.</p>
<p id="p0018" num="0018">In a possible design, after sending the first message, the first terminal apparatus may further receive a<!-- EPO <DP n="4"> --> response message from the SMF. The response message is used to indicate a result of establishing the first session. For example, the response message may indicate establishment of the first session is completed.</p>
<p id="p0019" num="0019">In addition, if the communication method is implemented by a traffic management entity, the traffic management entity may receive address information of a first terminal apparatus from a second management network element. Then, the traffic management entity may store the address information of the first terminal apparatus.</p>
<p id="p0020" num="0020">In a possible design, the traffic management entity may further send the address information of the first terminal apparatus to an SMF that manages a second terminal apparatus. The first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system.</p>
<p id="p0021" num="0021">In a possible design, after receiving a second message sent by the SMF that manages the second terminal apparatus, the traffic management entity may send the address information of the first terminal apparatus. The second message is used to subscribe to the address information of the first terminal apparatus. In an implementation, the second message may carry an identifier of the first terminal apparatus.</p>
<p id="p0022" num="0022">In a possible design, if the second management network element includes an SMF that manages the first terminal apparatus, after storing the address information of the first terminal apparatus, the traffic management entity may further send address information of a second terminal apparatus to the SMF. In a possible design, after receiving a third message sent by the SMF, the traffic management entity may send the address information of the first terminal apparatus. The third message is used to subscribe to the address information of the second terminal apparatus. The third message may include an identifier of the second terminal apparatus.</p>
<p id="p0023" num="0023">In a possible design, if the traffic management entity receives an identifier of a PCF and/or address information of the PCF from the SMF that manages the first terminal apparatus, the traffic management entity may further send address information of a second terminal apparatus to the PCF. In a possible design, after receiving a fourth message sent by the PCF, the traffic management entity may send the address information of the second terminal apparatus to the PCF. The fourth message is used to subscribe to the address information of the second terminal apparatus. The fourth message may include an identifier of the second terminal apparatus.</p>
<p id="p0024" num="0024">In a possible design, if the second management network element includes a PCF, and after storing the address information of the first terminal apparatus, the traffic management entity may further send address information of a second terminal apparatus to the PCF, so that the PCF generates a session management policy corresponding to the first session. In a possible design, after receiving a fifth message sent by the PCF, the traffic management entity may send the address information of the second terminal apparatus to the PCF. The fifth message is used to subscribe to the address information of the second terminal apparatus. The fifth message may include an identifier of the second<!-- EPO <DP n="5"> --> terminal apparatus.</p>
<p id="p0025" num="0025">In addition, if the communication method is implemented by a policy control function PCF, the PCF may receive address information of a second terminal apparatus from a traffic management entity, and generate a session management policy of a first session based on the address information. The session management policy may be used to determine a first rule. The first rule is used to indicate a routing rule from a first terminal apparatus to the second terminal apparatus and/or a data packet filtering rule between the first terminal apparatus and the second terminal apparatus. Then, the PCF may send the session management policy of the first session to an SMF that manages the first terminal apparatus.</p>
<p id="p0026" num="0026">In a possible design, before receiving the address information of the second terminal apparatus from the traffic management entity, the PCF may further receive address information of the first terminal apparatus from the SMF, and send the address information of the first terminal apparatus to the traffic management entity, so that the traffic management entity stores the address information of the first terminal apparatus.</p>
<p id="p0027" num="0027">In a possible design, before receiving the address information of the second terminal apparatus from the traffic management entity, the PCF may further send a request message to the traffic management entity. The request message may be used to subscribe to the address information of the second terminal apparatus. The request message may include an identifier of the second terminal apparatus.</p>
<p id="p0028" num="0028">According to a second aspect, this application provides a communication apparatus. The communication apparatus has a function of implementing the communication method provided in the embodiments of this application by the SMF, the traffic management entity, the PCF, or the UE in the method example in the first aspect. The function may be implemented by hardware, or may be implemented by hardware executing corresponding software. The hardware or the software includes one or more modules corresponding to the function.</p>
<p id="p0029" num="0029">In a possible design, the apparatus includes a transceiver unit and a processing unit. These units may perform corresponding functions in the method example in the first aspect. For details, refer to detailed descriptions in the method example. Details are not described herein again.</p>
<p id="p0030" num="0030">In another possible design, a structure of the apparatus includes a processor, a memory, and a transceiver. The processor, the memory, and the transceiver may be connected by using a bus or another medium. The processor invokes an instruction stored in the memory, to perform a corresponding function in the method example in the first aspect.</p>
<p id="p0031" num="0031">According to a third aspect, an embodiment of this application further provides a computer-readable storage medium. The computer-readable storage medium stores a computer program. When the program is executed<!-- EPO <DP n="6"> --> by a processor, a computer is enabled to perform the method provided in any one of the first aspect or the designs of the first aspect.</p>
<p id="p0032" num="0032">According to a fourth aspect, an embodiment of this application further provides a computer program product. The computer program product stores an instruction, and when the instruction is run on a computer, the computer is enabled to perform the method provided in any one of the first aspect or the designs of the first aspect.</p>
<p id="p0033" num="0033">According to a sixth aspect, an embodiment of this application provides a chip system. The chip system includes a processor, and may further include a memory, configured to implement the method according to any one of the first aspect or the possible implementations of the first aspect. The chip system may include a chip, or may include a chip and another discrete component.</p>
<p id="p0034" num="0034">According to a seventh aspect, an embodiment of this application provides a communication system, and the communication system includes the communication apparatus according to the second aspect.</p>
<heading id="h0005"><b>BRIEF DESCRIPTION OF DRAWINGS</b></heading>
<p id="p0035" num="0035">
<ul id="ul0001" list-style="none" compact="compact">
<li><figref idref="f0001">FIG. 1</figref> is a schematic architectural diagram of a communication system according to this application;</li>
<li><figref idref="f0001">FIG. 2</figref> is a schematic architectural diagram of a communication system according to this application;</li>
<li><figref idref="f0002">FIG. 3</figref> is a schematic flowchart of a communication method according to this application;</li>
<li><figref idref="f0003">FIG. 4A</figref> and <figref idref="f0004">FIG. 4B</figref> are a schematic flowchart of a communication method according to this application;</li>
<li><figref idref="f0005">FIG. 5A</figref> and <figref idref="f0006">FIG. 5B</figref> are a schematic flowchart of a communication method according to this application;</li>
<li><figref idref="f0007">FIG. 6A</figref> and <figref idref="f0008">FIG. 6B</figref> are a schematic flowchart of a communication method according to this application;</li>
<li><figref idref="f0009">FIG. 7A</figref> and <figref idref="f0010">FIG. 7B</figref> are a schematic flowchart of a communication method according to this application;</li>
<li><figref idref="f0011">FIG. 8</figref> is a schematic structural diagram of a communication apparatus according to this application;</li>
<li><figref idref="f0011">FIG. 9</figref> is a schematic structural diagram of a communication apparatus according to this application;</li>
<li><figref idref="f0012">FIG. 10</figref> is a schematic structural diagram of a communication apparatus according to this application;</li>
<li><figref idref="f0012">FIG. 11</figref> is a schematic structural diagram of a communication apparatus according to this application; and</li>
<li><figref idref="f0013">FIG. 12</figref> is a schematic structural diagram of a communication apparatus according to this application.</li>
</ul></p>
<heading id="h0006"><b>DESCRIPTION OF EMBODIMENTS</b></heading>
<p id="p0036" num="0036">To make objectives, technical solutions, and advantages of this application clearer, the following further<!-- EPO <DP n="7"> --> describes this application in detail with reference to the accompanying drawings. A specific operation method in a method embodiment may also be used in an apparatus embodiment or a system embodiment.</p>
<p id="p0037" num="0037">The following explains terms related in this application.
<ol id="ol0001" compact="compact" ol-style="">
<li>1. At least one means one or more, that is, including one, two, three, or more.</li>
<li>2. A plurality of means two or more, that is, including two, three, or more.</li>
<li>3. Carrying may mean that a message is used to carry information or data, or may mean that a message includes information.</li>
<li>4. An unmanned aerial vehicle communication system may also be referred to as an unmanned aerial system (unmanned aerial system, UAS), and is a communication system including at least one unmanned aerial vehicle control apparatus and at least one unmanned aerial vehicle apparatus. An unmanned aerial vehicle control apparatus and an unmanned aerial vehicle apparatus that belong to a same unmanned aerial vehicle communication system can implement pairing and connection, so that the unmanned aerial vehicle control apparatus controls the unmanned aerial vehicle apparatus. The unmanned aerial vehicle control apparatus (or referred to as an unmanned aerial vehicle controller) may be configured to control the unmanned aerial vehicle, for example, triggering an operation instruction, and controlling a flight status and a flight track of the unmanned aerial vehicle. The unmanned aerial vehicle may perform a corresponding flight operation based on the operation instruction triggered by the unmanned aerial vehicle control apparatus. The operation instruction herein may be sent by using the unmanned aerial vehicle communication system. In this application, the unmanned aerial vehicle control apparatus and the unmanned aerial vehicle may be collectively referred to as the unmanned aerial vehicle apparatus.</li>
<li>5. A traffic management entity is a core network (CN) entity that is provided by a 3GPP and that is configured to manage an unmanned aerial vehicle control apparatus and an unmanned aerial vehicle. The traffic management entity may specifically be configured to store related data of the unmanned aerial vehicle control apparatus and the unmanned aerial vehicle, for example, an identifier of the unmanned aerial vehicle apparatus, information about an owner of the unmanned aerial vehicle apparatus, path information, current address information of the unmanned aerial vehicle apparatus, and an operating status. The traffic management entity may further be configured to perform pairing between the unmanned aerial vehicle control apparatus and the unmanned aerial vehicle, identify a UAS, authorize another device to operate the UAS, manage or intervene in communication between the unmanned aerial vehicle control apparatus and the unmanned aerial vehicle, or the like. The traffic management entity in this application includes but is not limited to an unmanned aerial vehicle traffic management (unmanned aerial vehicle traffic management, UTM). Currently, only one traffic management entity or a plurality of traffic management<!-- EPO <DP n="8"> --> entities that exchange information may be set on a core network side.</li>
</ol></p>
<p id="p0038" num="0038">The following describes the embodiments of this application in detail with reference to the accompanying drawings. First, a wireless communication system provided in the embodiments of this application is described. A communication method provided in this application may be applied to the system. Then, the communication method provided in the embodiments of this application is described. Finally, an apparatus provided in the embodiments of this application is described. The apparatus may be configured to perform the communication method provided in this application.</p>
<p id="p0039" num="0039">An application scenario of the wireless communication system provided in this application includes but is not limited to a global system of mobile communication (Global System of Mobile communication, GSM) system, a code division multiple access (Code Division Multiple Access, CDMA) system, a wideband code division multiple access (Wideband Code Division Multiple Access, WCDMA) system, a general packet radio service (General Packet Radio Service, GPRS), a long term evolution (Long Term Evolution, LTE) system, an LTE frequency division duplex (Frequency Division Duplex, FDD) system, an LTE time division duplex (Time Division Duplex, TDD), a universal mobile telecommunication system (Universal Mobile Telecommunication System, UMTS), a worldwide interoperability for microwave access (Worldwide Interoperability for Microwave Access, WiMAX) communication system, a future 5<sup>th</sup> generation (5th Generation, 5G) system, a new radio (New Radio, NR) communication system, an NR vehicle to everything (vehicle to everything, V2X) system, a future mobile communication-based internet of vehicles system, or the like. It should be understood that a wireless communication system 100 provided in the embodiments of this application is applicable to both a low-frequency scenario (sub 6G) and a high-frequency scenario (above 6G).</p>
<p id="p0040" num="0040">For example, the wireless communication system provided in the embodiments of this application may be a 5G communication system including the traffic management entity (for example, the UTM). As shown in <figref idref="f0001">FIG. 1</figref>, in a possible implementation, the wireless communication system 100 provided in this application may include a terminal (UE) 101, an access network (access network, AN) or a radio access network (radio access network, RAN) (referred to as (R)AN in the following) 102, a user plane function (user plane function, UPF) 103, a session management function (session management function, SMF) 104 and a UTM 105. It should be understood that the wireless communication system 100 may further include other core network elements such as an access and mobility management function (access and mobility management function, AMF), an authentication server function (authentication server function, AUSF), a network slice selection function (network slice selection function, NSSF), a network exposure function (network exposure function, NEF), a network function repository function (NF<!-- EPO <DP n="9"> --> Repository Function, NRF, NF, network function), a policy control function (policy control function, PCF), a unified data management (unified data management, UDM), and an application function (application function, AF).</p>
<p id="p0041" num="0041">It should be understood that the UE 101 may be the unmanned aerial vehicle apparatus (the unmanned aerial vehicle control apparatus and/or the unmanned aerial vehicle) in this application. The UE 101 may access the SMF 104 by using the (R)AN 102.</p>
<p id="p0042" num="0042">A main function of the (R)AN 102 is to control a user (for example, UE) to access a mobile communication network by using an access network. Specifically, a RAN implements a radio access technology, and provides connection between a communication device, for example, the UE, and a core network. A RAN device forming the RAN includes but is not limited to a base station (g nodeB, gNB) in 5G, an eNodeB, a radio network controller (radio network controller, RNC), a node B (node B, NB), a base station controller (base station controller, BSC), a base transceiver station (base transceiver station, BTS), a home evolved node B (for example, home evolved base station, or home node B, HNB), a baseband unit (baseband unit, BBU), a transmitting and receiving point (transmitting and receiving point, TRP), a transmitting point (transmitting point, TP), a mobile switching center, and the like. In addition, the RAN device may further include a wireless fidelity (wireless fidelity, wifi) access point (access point, AP), and the like.</p>
<p id="p0043" num="0043">The UPF 103 may be used as a UPF corresponding to the UE 101, and is configured to process a packet sent by the UE 101 or sent to the UE 101, collect statistics about the packet, and forward the packet on a user plane path.</p>
<p id="p0044" num="0044">The SMF 104 may be configured to manage the UE 101, and may specifically be configured to manage a session of the UE 101, select the UPF corresponding to the UE 101, create a user plane data transmission path of the session on the UPF, and configure a packet processing rule for the UPF to implement user plane data transmission.</p>
<p id="p0045" num="0045">The UTM 105 may be configured to manage the unmanned aerial vehicle control apparatus and the unmanned aerial vehicle. The UTM 105 may communicate with another core network element in the core network through a core network interface. For example, the UTM 105 communicates with the SMF 104 through the core network interface (for example, a Nutm interface).</p>
<p id="p0046" num="0046">As shown in <figref idref="f0001">FIG. 2</figref>, based on the wireless communication system 100 shown in <figref idref="f0001">FIG. 1</figref>, when long-distance communication is performed, the unmanned aerial vehicle control apparatus and the unmanned aerial vehicle may separately access different RANs (the different RANs herein may be RANs in different geographical locations, so that an unmanned aerial vehicle control apparatus and an unmanned aerial vehicle that are located at different locations access the different RANs), and may separately access the core network by using different RANs. Then, the<!-- EPO <DP n="10"> --> unmanned aerial vehicle controller and the unmanned aerial vehicle may separately be connected to a same UTM by using the core network. Therefore, address information of the unmanned aerial vehicle controller and the unmanned aerial vehicle in different radio access devices is exchanged by using the UTM, to implement pairing.</p>
<p id="p0047" num="0047">The following describes the communication method provided in the embodiments of this application with reference to <figref idref="f0002">FIG. 3</figref>. The method is performed by a first terminal apparatus (an unmanned aerial vehicle apparatus in an unmanned aerial vehicle communication system, which may be the unmanned aerial vehicle apparatus or an unmanned aerial vehicle control apparatus), an SMF that manages the first terminal apparatus, and a traffic management entity. It should be understood that the first terminal apparatus herein may be the unmanned aerial vehicle control apparatus, or may be an unmanned aerial vehicle.</p>
<p id="p0048" num="0048">The method may include the following steps.</p>
<p id="p0049" num="0049">S101: The first terminal apparatus sends a first message to a session management function SMF, where the first message is used to request the SMF to establish a first session for the first terminal apparatus, the first message is further used to indicate that the first session is used for communication between the first terminal apparatus and a second terminal apparatus, and the first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system.</p>
<p id="p0050" num="0050">S102: The SMF receives the first message.</p>
<p id="p0051" num="0051">S103: The SMF sends address information of the first terminal apparatus to a first management network element based on the first message, where the address information of the first terminal apparatus may be used to indicate an address of the first terminal apparatus and/or an address of a user plane function UPF corresponding to the first terminal apparatus.</p>
<p id="p0052" num="0052">S104: The first management network element receives the address information of the first terminal apparatus.</p>
<p id="p0053" num="0053">In the foregoing communication method, after the SMF receives the first message that is sent by the first terminal apparatus and that is used to request to establish the first session, if the first message is used to indicate that the first session is used to indicate the first terminal apparatus and the second terminal apparatus in the same unmanned aerial vehicle communication system to communicate with each other, the SMF sends the address information of the first terminal apparatus to the first management network element. This provides a possibility of exchanging address information of terminal apparatuses in the unmanned aerial vehicle communication system.</p>
<p id="p0054" num="0054">In an implementation of the step shown in S101, the first session herein may be a protocol data unit (protocol data unit, PDU) session. The PDU session may be used to transmit uplink and downlink user data of the first<!-- EPO <DP n="11"> --> terminal apparatus. Therefore, the communication method provided in this application may be initiated when the unmanned aerial vehicle terminal apparatus requests the SMF to establish the PDU session. The first message may be a PDU session establishment request message sent by the first terminal apparatus to the SMF, and the message is used to request to establish the PDU session (namely, the first session). After receiving the first message used to request to establish the first session, the SMF may select a UPF for the first terminal apparatus in a process of establishing the first session, and the UPF is the UPF corresponding to the first terminal apparatus. In an implementation, because the first message further indicates that the first session is used for communication between unmanned aerial vehicle apparatuses in the unmanned aerial vehicle communication system, the SMF may select a UPF that supports the communication between the unmanned aerial vehicle apparatuses as the UPF corresponding to the first terminal apparatus. The UPF that supports the communication between the unmanned aerial vehicle apparatuses can meet a specific quality of service (quality of service, QoS) requirement of the unmanned aerial vehicle. In a possible implementation, the first message may carry information used to indicate that the first session is used for the communication between the first terminal apparatus and the second terminal apparatus in the unmanned aerial vehicle communication system. For example, a bit in a field in the first message may be used to indicate that the first session is used for the communication between the first terminal apparatus and the second terminal apparatus in the unmanned aerial vehicle communication system.</p>
<p id="p0055" num="0055">After selecting the UPF corresponding to the first terminal apparatus, the SMF may further send an N4 session establishment request to the UPF, to request to establish an N4 session between the SMF and the UPF. The N4 session establishment request may carry the information used to indicate that the first session is used for the communication between the first terminal apparatus and the second terminal apparatus in the unmanned aerial vehicle communication system. After sending the N4 session establishment request to the UPF, the SMF may further receive a response message sent by the UPF. The response message may be used to indicate that establishment of the N4 session between the SMF and the UPF is completed.</p>
<p id="p0056" num="0056">In an implementation of the step shown in S103, the SMF may further send an identifier of the first terminal apparatus to the first management network element. In an implementation, because the SMF manages the first terminal apparatus, the SMF may obtain the identifier of the first terminal apparatus in a process in which the first terminal apparatus accesses the SMF. Before sending the address information of the first terminal apparatus, the SMF may further query the address of the first terminal apparatus from a unified data management (unified data management, UDM) after receiving the first message, and use the address of the first terminal apparatus as the address information of the first terminal apparatus. Alternatively, when selecting the UPF for the first terminal apparatus, the<!-- EPO <DP n="12"> --> SMF may allocate an address to the first terminal apparatus and use the address as the address information of the first terminal apparatus. In addition, the SMF may also use address information of the UPF selected for the first terminal apparatus (namely, information used to indicate the address of the UPF corresponding to the first terminal apparatus) as the address information of the first terminal apparatus.</p>
<p id="p0057" num="0057">The first management network element in this application may be a traffic management entity (for example, a UTM) or a PCF. That the traffic management entity is the UTM is used as an example for further description.</p>
<p id="p0058" num="0058">In a possible implementation, the SMF may send the address information of the first terminal apparatus to the UTM. After receiving the address information of the first terminal apparatus according to the step shown in S104, the UTM may store the address information of the first terminal apparatus. Then, the UTM may send a first response message to the SMF, to indicate that the address information of the first terminal apparatus is stored. In addition, if the SMF may further send the identifier of the first terminal apparatus to the UTM, the UTM may store a correspondence between the identifier of the first terminal apparatus and the address information of the first terminal apparatus.</p>
<p id="p0059" num="0059">After sending the address information of the first terminal apparatus to the UTM, the SMF may further receive address information of the second terminal apparatus sent by the UTM. The address information of the second terminal apparatus is used to indicate an address of the second terminal apparatus and/or an address of a UPF corresponding to the second terminal apparatus.</p>
<p id="p0060" num="0060">In an implementation, the SMF may determine a first rule based on the address information of the second terminal apparatus. The first rule may be used for the communication between the first terminal apparatus and the second terminal apparatus. The first rule specifically includes a routing rule from the first terminal apparatus to the second terminal apparatus, and/or include a data packet filtering rule between the first terminal apparatus and the second terminal apparatus. The routing rule may be used for routing of an instruction and/or data transmitted between the first terminal apparatus and the second terminal apparatus. The data packet filtering rule may be used to identify a data packet flow transmitted between the first terminal apparatus and the second terminal apparatus. The SMF may send the first rule to the UPF corresponding to the first terminal apparatus, so that the UPF supports the communication between the first terminal apparatus and the second terminal apparatus. For example, the UPF may locally store the first rule. Subsequently, when information such as an instruction or data sent by the first terminal apparatus to the second terminal apparatus passes through the UPF, the UPF may perform routing and/or data packet flow identification according to the first rule.</p>
<p id="p0061" num="0061">In addition, in an implementation, the SMF may allocate, based on the address information of the second<!-- EPO <DP n="13"> --> terminal apparatus, a tunnel corresponding to the first session, and send information about the tunnel to the UPF corresponding to the first terminal apparatus. The tunnel is a dedicated channel for communication between the UPF corresponding to the first terminal apparatus and the UPF corresponding to the second terminal apparatus. The tunnel one-to-one corresponds to the first session. When data that needs to be transmitted to the second terminal apparatus arrives at the UPF corresponding to the first terminal apparatus, the UPF corresponding to the first terminal apparatus may directly send the data to the UPF corresponding to the second terminal apparatus through the tunnel.</p>
<p id="p0062" num="0062">In addition, the SMF may also send the address information of the second terminal apparatus to the UPF corresponding to the first terminal apparatus, so that the UPF determines the first rule, or the UPF allocates the tunnel corresponding to the first session.</p>
<p id="p0063" num="0063">For example, before receiving the address information of the second terminal apparatus sent by the UTM, the SMF may further send a second message to the UTM. The second message may be used to subscribe to the address information of the second terminal apparatus. The second message may carry an identifier of the second terminal apparatus. Specifically, the second message may be used to request the UTM to send the address information of the second terminal apparatus to the SMF after storing the address information of the second terminal apparatus. For example, if the UTM does not store the address information of the second terminal apparatus when receiving the second message, the UTM may send the address information of the second terminal apparatus to the SMF after storing the address information of the second terminal apparatus. In addition, the UTM may also select, according to preconfiguration (for example, the UTM may learn of, in advance, an unmanned aerial vehicle terminal apparatus that can perform pairing and connection to the first terminal apparatus), at least one terminal apparatus from terminal apparatuses to which the stored address information belongs as the second terminal apparatus. Therefore, even if the second message does not carry the identifier of the second terminal apparatus, the UTM can also send the address information of the second terminal apparatus to the SMF, thereby improving pairing efficiency of the unmanned aerial vehicle terminal apparatus.</p>
<p id="p0064" num="0064">Alternatively, when sending the address information of the first terminal apparatus to the UTM, the SMF may further send, to the UTM, indication information used to request the address information of the second terminal apparatus, so that after storing the address information of the first terminal apparatus, the UTM sends the address information of the second terminal apparatus to the SMF.</p>
<p id="p0065" num="0065">In addition, the SMF may further request the UTM to send the stored address information of the second terminal apparatus to the SMF, and the UTM may query the address information of the second terminal apparatus. The request may carry the identifier of the second terminal apparatus. For example, if the UTM stores a<!-- EPO <DP n="14"> --> correspondence between the identifier of the second terminal apparatus and the address information of the second terminal apparatus, the UTM may determine the address information of the second terminal apparatus based on the identifier of the second terminal apparatus. If the UTM does not find the address information of the second terminal apparatus, the UTM may feed back to the SMF, to indicate that the UTM does not find the address information of the second terminal apparatus. Alternatively, the UTM may not feed back, and the SMF determines, after sending the second message, that the address information of the second terminal apparatus is not received within preset duration, to determine that the UTM does not find the address information of the second terminal apparatus. After determining that the UTM does not find the address information of the second terminal apparatus, the SMF may send the second message to the UTM, to subscribe to the address information of the second terminal apparatus. The UTM may send the address information of the second terminal apparatus to the SMF based on the second message after storing the address information of the second terminal apparatus.</p>
<p id="p0066" num="0066">For example, the SMF may further send an identifier of the PCF and/or address information of the PCF to the UTM, and the SMF may further send, to the UTM, information used to request the PCF to determine a session management (session management, SM) policy of the first session. The information may be sent by the SMF to the UTM by using a separate message, or may be sent to the UTM as information in another message. The information may be used to indicate the UTM to trigger the PCF to determine the session management policy of the first session. In a solution in which the information used to request the PCF to determine the session management policy of the first session is sent, the SMF may further send the identifier of the first terminal apparatus and/or the identifier of the second terminal apparatus to the UTM. Then, after determining the address information of the second terminal apparatus, the UTM sends the address information of the second terminal apparatus to the PCF based on the information used to request the PCF to determine the session management policy of the first session, so that the PCF determines the session management policy of the first session. The session management policy of the first session may be used to determine a second rule. The second rule includes a routing rule from the first terminal apparatus to the second terminal apparatus and/or a data packet filtering rule between the first terminal apparatus and the second terminal apparatus. After determining the session management policy of the first session, the PCF may send the session management policy of the first session to the SMF. The SMF determines the second rule according to the session management policy of the first session, and sends the second rule to the UPF corresponding to the first terminal apparatus. The UPF performs, according to the second rule, routing of the instruction and/or the data and/or filtering of data packet between the first terminal apparatus and the second terminal apparatus.</p>
<p id="p0067" num="0067">Further, the UTM may further send the address information of the second terminal apparatus to the PCF,<!-- EPO <DP n="15"> --> so that the PCF determines the session management policy of the first session. Before the UTM sends the address information of the second terminal apparatus to the PCF, the SMF may further send the second message to the UTM, to subscribe to the address information of the second terminal apparatus. If the UTM does not find the address information of the second terminal apparatus, the UTM may not send the address information of the second terminal apparatus to the PCF. When the PCF receives the message used to request the PCF to determine the session management policy of the first session but does not receive the address information of the second terminal apparatus, the PCF may send a third message to the UTM. The third message is used to subscribe to the address information of the second terminal apparatus. For a setting and sending manner of the third message, refer to a sending manner of the second message.</p>
<p id="p0068" num="0068">For example, after the UTM stores the address information of the first terminal apparatus, if the UTM previously receives a message that is sent by an SMF that manages the second terminal apparatus and/or the UPF corresponding to the second terminal apparatus and that is used to subscribe to the address information of the first terminal apparatus, the UTM may send the address information of the first terminal apparatus to the SMF that manages the second terminal apparatus and/or the UPF corresponding to the second terminal apparatus. For a manner of the message that is sent by the SMF that manages the second terminal apparatus and/or the UPF corresponding to the second terminal apparatus and that is used to subscribe to the address information of the first terminal apparatus, refer to the sending manner of the second message in this application. For a processing manner after the SMF that manages the second terminal apparatus receives the address information of the first terminal apparatus, refer to a processing manner after the SMF that manages the first terminal apparatus receives the address information of the second terminal apparatus provided in this application. For a processing manner after the UPF corresponding to the second terminal apparatus receives the address information of the first terminal apparatus, refer to a processing manner after the UPF corresponding to the first terminal apparatus receives the address information of the second terminal apparatus provided in this application.</p>
<p id="p0069" num="0069">In another possible implementation, the SMF may send the address information of the first terminal apparatus to the PCF. Then, the PCF may send the address information of the first terminal apparatus to the UTM, and then the UTM may store the address information of the first terminal apparatus. In the foregoing manner, the SMF may send the address information of the first terminal apparatus to the UTM, and the UTM stores the address information of the first terminal apparatus, so that the UTM manages address information of the unmanned aerial vehicle apparatus in the unmanned aerial vehicle communication system. After the UTM stores the address information of the first terminal apparatus, the UTM may send a second response message to the PCF. The second<!-- EPO <DP n="16"> --> response message is used to indicate the UTM to complete storage of the address information of the first terminal apparatus. In an implementation, the SMF may further send the identifier of the second terminal apparatus to the PCF.</p>
<p id="p0070" num="0070">For example, the SMF may send the message, carrying the address information of the first terminal apparatus, used to request the PCF to determine the session management policy of the first session to the PCF. Alternatively, the SMF may separately send the message and the address information of the first terminal apparatus to the PCF. The message used to request the PCF to determine the session management policy of the first session may further carry information used to indicate that the first session is used for the communication between the first terminal apparatus and the second terminal apparatus in the same unmanned aerial vehicle communication system.</p>
<p id="p0071" num="0071">After receiving the message used to request the PCF to determine the session management policy of the first session, the PCF may further send a fourth message to the UTM. The fourth message may be used to request to subscribe to the address information of the second terminal apparatus, and then the PCF may receive the address information of the second terminal apparatus from the UTM. For a setting and sending manner of the fourth message, refer to a sending manner of the second message. After receiving the address information of the second terminal apparatus from the UTM, the PCF may determine the session management policy of the first session based on the address information, and send the session management policy of the first session to the SMF. The SMF may determine the second rule according to the session management policy of the first session, and send the second rule to the UPF corresponding to the first terminal apparatus. The second rule is used for the communication between the first terminal apparatus and the second terminal apparatus. Specifically, the second rule may include the routing rule from the first terminal apparatus to the second terminal apparatus and/or the data packet filtering rule between the first terminal apparatus and the second terminal apparatus.</p>
<p id="p0072" num="0072">The following describes, with reference to <figref idref="f0003">FIG. 4A</figref> and <figref idref="f0004">FIG. 4B</figref>, a procedure of a communication method according to an embodiment of this application is described. The procedure specifically includes the following steps.</p>
<p id="p0073" num="0073">S201: A first terminal apparatus sends a first message to an SMF, where the first message is used to request the SMF to establish a first session for the first terminal apparatus, the first message is further used to indicate that the first session is used for communication between the first terminal apparatus and a second terminal apparatus, and the first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system. The first message may carry information used to indicate that the first session is used for the communication between the first terminal apparatus and the second terminal apparatus in the same unmanned aerial vehicle communication system. The first message may further carry an identifier of the second terminal apparatus. The first message may be a PDU session establishment request.<!-- EPO <DP n="17"> --></p>
<p id="p0074" num="0074">S202: The SMF receives the first message.</p>
<p id="p0075" num="0075">S203: The SMF sends, based on the first message, an N4 session establishment request to a UPF corresponding to the first terminal apparatus. The N4 session establishment request may carry the information used to indicate that the first session is used for the communication between the first terminal apparatus and the second terminal apparatus in the same unmanned aerial vehicle communication system.</p>
<p id="p0076" num="0076">S204: The SMF receives a response message from the UPF corresponding to the first terminal apparatus, where the response message indicates that establishment of an N4 session between the SMF and the UPF is completed.</p>
<p id="p0077" num="0077">S205: The SMF sends a PDU session establishment response message to the first terminal apparatus, to indicate that establishment of the first session is completed. It should be understood that the PDU session establishment response message herein may further be used to indicate that the first session fails to be established when the first session fails to be established.</p>
<p id="p0078" num="0078">S206: The SMF sends address information of the first terminal apparatus to a UTM based on the first message, so that the UTM stores the address information of the first terminal apparatus.</p>
<p id="p0079" num="0079">S207: The UTM receives and stores the address information of the first terminal apparatus. If the UTM previously receives a message that is sent by an SMF that manages the second terminal apparatus and/or a UPF corresponding to the second terminal apparatus and that is used to subscribe to the address information of the first terminal apparatus, after S207, the UTM may send the address information of the first terminal apparatus to the SMF that manages the second terminal apparatus and/or the UPF corresponding to the second terminal apparatus.</p>
<p id="p0080" num="0080">S208: The UTM sends a first response message to the SMF, where the first response message is used to indicate that the UTM has stored the address information of the first terminal apparatus.</p>
<p id="p0081" num="0081">S209: The SMF sends a message used to request address information of the second terminal apparatus to the UTM. The message may include an identifier of the second terminal apparatus.</p>
<p id="p0082" num="0082">S210: The UTM receives the message used to request the address information of the second terminal apparatus, and determines the address information of the second terminal apparatus. The UTM may query and determine the address information of the second terminal apparatus from the stored identifier of the terminal apparatus and the stored address information of the terminal apparatus based on the identifier of the second terminal apparatus carried in the message. Alternatively, the UTM may select, according to preconfiguration, at least one terminal apparatus that can perform pairing and connection to the first terminal apparatus from terminal apparatuses to which the stored address information belongs as the second terminal apparatus, and use address information of the terminal apparatus as the address information of the second terminal apparatus. If the UTM does not find the address<!-- EPO <DP n="18"> --> information of the second terminal apparatus, the UTM may perform corresponding feedback to the SMF, or does not perform feedback, so that the SMF determines, after determining that the address information of the second terminal apparatus is not received within preset duration, that the UTM does not find the address information of the second terminal apparatus. In this case, the SMF may send a second message to the UTM, to subscribe to the address information of the second terminal apparatus. After receiving the second message, the UTM may send the address information of the second terminal apparatus to the SMF after storing the address information of the second terminal apparatus.</p>
<p id="p0083" num="0083">S211: The UTM sends the address information of the second terminal apparatus to the SMF.</p>
<p id="p0084" num="0084">S212: The SMF sends the address information of the second terminal apparatus and/or a first rule to the UPF corresponding to the first terminal apparatus. The first rule is determined by the SMF based on the address information of the second terminal apparatus. The first rule may specifically include a routing rule from the first terminal apparatus to the second terminal apparatus, and/or include a data packet filtering rule between the first terminal apparatus and the second terminal apparatus.</p>
<p id="p0085" num="0085">S213: The UPF receives the first rule, or the UPF determines the first rule based on the address information of the second terminal apparatus.</p>
<p id="p0086" num="0086">It should be understood that the steps S207 to S213 may also be completed before S206. Atime sequence relationship between the foregoing steps is not specifically limited in this application.</p>
<p id="p0087" num="0087">The following describes, with reference to <figref idref="f0005">FIG. 5A</figref> and <figref idref="f0006">FIG. 5B</figref>, a procedure of another communication method according to an embodiment of this application is described. The procedure specifically includes the following steps.</p>
<p id="p0088" num="0088">S301: A first terminal apparatus sends a first message to an SMF, where the first message is used to request the SMF to establish a first session for the first terminal apparatus, the first message is further used to indicate that the first session is used for communication between the first terminal apparatus and a second terminal apparatus, and the first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system. The first message may carry information used to indicate that the first session is used for the communication between the first terminal apparatus and the second terminal apparatus in the same unmanned aerial vehicle communication system. The first message may further carry an identifier of the second terminal apparatus.</p>
<p id="p0089" num="0089">S302: The SMF receives the first message.</p>
<p id="p0090" num="0090">S303: The SMF sends, based on the first message, a message used to request a PCF to determine a session management policy of the first session to the PCF, where the message carries address information of the first<!-- EPO <DP n="19"> --> terminal apparatus. The first message may further carry the information used to indicate that the first session is used for the communication between the first terminal apparatus and the second terminal apparatus in the same unmanned aerial vehicle communication system.</p>
<p id="p0091" num="0091">S304: The PCF sends the address information of the first terminal apparatus to a UTM.</p>
<p id="p0092" num="0092">S305: The UTM receives and stores the address information of the first terminal apparatus. If the UTM previously receives a message that is sent by an SMF that manages the second terminal apparatus and/or a UPF corresponding to the second terminal apparatus and that is used to subscribe to the address information of the first terminal apparatus, after S307, the UTM may send the address information of the first terminal apparatus to the SMF that manages the second terminal apparatus and/or the UPF corresponding to the second terminal apparatus.</p>
<p id="p0093" num="0093">S306: The UTM sends a second response message to the PCF, where the second response message is used to indicate that the UTM has stored the address information of the first terminal apparatus.</p>
<p id="p0094" num="0094">S307: The PCF sends a message used to request address information of the second terminal apparatus to the UTM. The message may include the identifier of the second terminal apparatus.</p>
<p id="p0095" num="0095">S308: The UTM receives the message used to request the address information of the second terminal apparatus, and determines the address information of the second terminal apparatus. The UTM may query and determine the address information of the second terminal apparatus from the stored identifier of the terminal apparatus and the stored address information of the terminal apparatus based on the identifier of the second terminal apparatus carried in the message. Alternatively, the UTM may select, according to preconfiguration, at least one terminal apparatus that can perform pairing and connection to the first terminal apparatus from terminal apparatuses to which the stored address information belongs as the second terminal apparatus, and use address information of the terminal apparatus as the address information of the second terminal apparatus. If the UTM does not find the address information of the second terminal apparatus, the UTM may perform corresponding feedback to the PCF, or do not perform feedback, so that after determining that the address information of the second terminal apparatus is not received within preset duration, the PCF determines that the UTM does not find the address information of the second terminal apparatus. In this case, the PCF may send a fifth message to the UTM to subscribe to address information of the second terminal apparatus. After receiving the fifth message, the UTM may send the address information of the second terminal apparatus to the PCF after storing the address information of the second terminal apparatus.</p>
<p id="p0096" num="0096">S309: The UTM sends the address information of the second terminal apparatus to the PCF.</p>
<p id="p0097" num="0097">S310: The PCF receives the address information of the second terminal apparatus, and determines the session management policy of the first session based on the address information of the second terminal apparatus.<!-- EPO <DP n="20"> --></p>
<p id="p0098" num="0098">S311: The PCF sends the session management policy of the first session to the SMF.</p>
<p id="p0099" num="0099">S312: The SMF determines a second rule according to the session management policy of the first session, where the second rule may include a routing rule from the first terminal apparatus to the second terminal apparatus and/or a data packet filtering rule between the first terminal apparatus and the second terminal apparatus.</p>
<p id="p0100" num="0100">S313: The SMF sends an N4 session establishment request to the UPF corresponding to the first terminal apparatus, where the request carries the second rule. The N4 session establishment request may further carry the information used to indicate that the first session is used for the communication between the first terminal apparatus and the second terminal apparatus in the same unmanned aerial vehicle communication system.</p>
<p id="p0101" num="0101">S314: The SMF receives a response message from the UPF corresponding to the first terminal apparatus, where the response message indicates that establishment of an N4 session between the SMF and the UPF is completed.</p>
<p id="p0102" num="0102">S315: The SMF sends a PDU session establishment response message to the first terminal apparatus, to indicate that establishment of the first session is completed.</p>
<p id="p0103" num="0103">It should be understood that the steps S406 to S415 may also be completed before S405. A time sequence relationship between the foregoing steps is not specifically limited in this application.</p>
<p id="p0104" num="0104">The following describes, with reference to <figref idref="f0007">FIG. 6A</figref> and <figref idref="f0008">FIG. 6B</figref>, a procedure of another communication method according to an embodiment of this application is described. The procedure specifically includes the following steps.</p>
<p id="p0105" num="0105">S401: A first terminal apparatus sends a first message to an SMF, where the first message is used to request the SMF to establish a first session for the first terminal apparatus, the first message is further used to indicate that the first session is used for communication between the first terminal apparatus and a second terminal apparatus, and the first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system. The first message may carry information used to indicate that the first session is used for the communication between the first terminal apparatus and the second terminal apparatus in the same unmanned aerial vehicle communication system. The first message carries an identifier of the second terminal apparatus.</p>
<p id="p0106" num="0106">S402: The SMF receives the first message.</p>
<p id="p0107" num="0107">S403: The SMF sends, based on the first message, an N4 session establishment request to a UPF corresponding to the first terminal apparatus. The N4 session establishment request may carry the information used to indicate that the first session is used for the communication between the first terminal apparatus and the second terminal apparatus in the same unmanned aerial vehicle communication system.</p>
<p id="p0108" num="0108">S404: The SMF receives a response message from the UPF corresponding to the first terminal apparatus,<!-- EPO <DP n="21"> --> where the response message indicates that establishment of an N4 session between the SMF and the UPF is completed.</p>
<p id="p0109" num="0109">S405: The SMF sends a PDU session establishment response message to the first terminal apparatus, to indicate that establishment of the first session is completed.</p>
<p id="p0110" num="0110">S406: The SMF sends address information of the first terminal apparatus, and an identifier of a PCF and/or address information of the PCF to a UTM based on the first message.</p>
<p id="p0111" num="0111">S407: The UTM receives and stores the address information of the first terminal apparatus. If the UTM previously receives a message that is sent by an SMF that manages the second terminal apparatus and/or a UPF corresponding to the second terminal apparatus and that is used to subscribe to the address information of the first terminal apparatus, after S407, the UTM may send the address information of the first terminal apparatus to the SMF that manages the second terminal apparatus and/or the UPF corresponding to the second terminal apparatus.</p>
<p id="p0112" num="0112">S408: The UTM sends a first response message to the SMF, where the first response message is used to indicate that the UTM has stored the address information of the first terminal apparatus.</p>
<p id="p0113" num="0113">S409: The SMF sends a message used to request the PCF to determine a session management policy of the first session to the UTM. The message is used to request the UTM to trigger the PCF to determine the session management policy of the first session. The second message may carry an identifier of the first terminal apparatus and the identifier of the second terminal apparatus.</p>
<p id="p0114" num="0114">S410: The UTM receives the message used to request the PCF to determine the session management policy of the first session, and determines address information of the second terminal apparatus. The UTM may query and determine the address information of the second terminal apparatus from the stored identifier of the terminal apparatus and the stored address information of the terminal apparatus based on the identifier of the second terminal apparatus carried in the message. Alternatively, the UTM may select, according to preconfiguration, at least one terminal apparatus that can perform pairing and connection to the first terminal apparatus from terminal apparatuses to which the stored address information belongs as the second terminal apparatus, and use address information of the terminal apparatus as the address information of the second terminal apparatus.</p>
<p id="p0115" num="0115">S411: The UTM sends, based on the identifier of the PCF and/or the address information of the PCF, the address information of the second terminal apparatus and the information used to request the PCF to determine the session management policy of the first session to the PCF. The information used to request the PCF to determine the session management policy of the first session is used to request the PCF to determine the session management policy of the first session. If the UTM finds the address information of the second terminal apparatus from the stored address information of the terminal apparatus after receiving the message used to request the PCF to determine the session<!-- EPO <DP n="22"> --> management policy of the first session, the UTM may send both the address information of the second terminal apparatus and the information used to request the PCF to determine the session management policy of the first session to the PCF. If the UTM does not find the address information of the second terminal apparatus from the stored address information of the terminal apparatus, the UTM may send only the information used to request the PCF to determine the session management policy of the first session to the PCF. After determining that the second terminal apparatus receives the information used to request the PCF to determine the session management policy of the first session but does not receive the address information of the second terminal apparatus, the second terminal apparatus may send a fourth message to the UTM, to subscribe to the address information of the second terminal apparatus. After receiving the fourth message, the UTM may send the address information of the second terminal apparatus to the PCF after storing the address information of the second terminal apparatus.</p>
<p id="p0116" num="0116">S412: The PCF determines the session management policy of the first session based on the address information of the second terminal apparatus.</p>
<p id="p0117" num="0117">S413: The PCF sends the session management policy of the first session to the SMF.</p>
<p id="p0118" num="0118">S414: The SMF determines a second rule according to the session management policy of the first session. The second rule may include a routing rule from the first terminal apparatus to the second terminal apparatus and/or a data packet filtering rule between the first terminal apparatus and the second terminal apparatus.</p>
<p id="p0119" num="0119">S415: The SMF may send the second rule to the UPF corresponding to the first terminal apparatus.</p>
<p id="p0120" num="0120">It should be understood that the steps S406 to S415 may also be completed before S405. A time sequence relationship between the foregoing steps is not specifically limited in this application.</p>
<p id="p0121" num="0121">The following describes, with reference to <figref idref="f0009">FIG. 7A</figref> and <figref idref="f0010">FIG. 7B</figref>, a procedure of a communication method according to an embodiment of this application is described. The procedure specifically includes the following steps.</p>
<p id="p0122" num="0122">S501: A first terminal apparatus sends a first message to an SMF, where the first message is used to request the SMF to establish a first session for the first terminal apparatus, the first message is further used to indicate that the first session is used for communication between the first terminal apparatus and a second terminal apparatus, and the first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system. The first message may carry information used to indicate that the first session is used for the communication between the first terminal apparatus and the second terminal apparatus in the same unmanned aerial vehicle communication system. The first message may further carry an identifier of the second terminal apparatus.</p>
<p id="p0123" num="0123">S502: The SMF receives the first message.</p>
<p id="p0124" num="0124">S503. The SMF sends an N4 session establishment request to a UPF corresponding to the first terminal<!-- EPO <DP n="23"> --> apparatus. The N4 session establishment request may carry the information used to indicate that the first session is used for the communication between the first terminal apparatus and the second terminal apparatus in the same unmanned aerial vehicle communication system.</p>
<p id="p0125" num="0125">S504: The SMF receives a response message from the UPF corresponding to the first terminal apparatus, where the response message indicates that establishment of an N4 session between the SMF and the UPF is completed.</p>
<p id="p0126" num="0126">S505: The SMF sends a PDU session establishment response message to the first terminal apparatus based on the first message, to indicate that establishment of the first session is completed.</p>
<p id="p0127" num="0127">S506: The SMF sends address information of the first terminal apparatus to a UTM based on the first message, so that the UTM stores the address information of the first terminal apparatus.</p>
<p id="p0128" num="0128">S507: The UTM receives and stores the address information of the first terminal apparatus. If the UTM previously receives a message that is sent by an SMF that manages the second terminal apparatus and/or a UPF corresponding to the second terminal apparatus and that is used to subscribe to the address information of the first terminal apparatus, after S507, the UTM may send the address information of the first terminal apparatus to the SMF that manages the second terminal apparatus and/or the UPF corresponding to the second terminal apparatus.</p>
<p id="p0129" num="0129">S508: The UTM sends a first response message to the SMF, where the first response message is used to indicate that the UTM has stored the address information of the first terminal apparatus.</p>
<p id="p0130" num="0130">S509: The SMF sends a message used to request address information of the second terminal apparatus to the UTM. The message may include the identifier of the second terminal apparatus.</p>
<p id="p0131" num="0131">S510: The UTM receives the message used to request the address information of the second terminal apparatus, and determines the address information of the second terminal apparatus. The UTM may query and determine the address information of the second terminal apparatus from the stored identifier of the terminal apparatus and the stored address information of the terminal apparatus based on the identifier of the second terminal apparatus carried in the message. Alternatively, the UTM may select, according to preconfiguration, at least one terminal apparatus that can perform pairing and connection to the first terminal apparatus from terminal apparatuses to which the stored address information belongs as the second terminal apparatus, and use address information of the terminal apparatus as the address information of the second terminal apparatus. If the UTM does not find the address information of the second terminal apparatus, the UTM may perform corresponding feedback to the SMF, or does not perform feedback, so that the SMF determines, after determining that the address information of the second terminal apparatus is not received within preset duration, that the UTM does not find the address information of the second terminal apparatus. In this case, the SMF may send a second message to the UTM, to subscribe to the address<!-- EPO <DP n="24"> --> information of the second terminal apparatus. After receiving the second message, the UTM may send the address information of the second terminal apparatus to the SMF after storing the address information of the second terminal apparatus.</p>
<p id="p0132" num="0132">S511: The UTM sends the address information of the second terminal apparatus to the SMF.</p>
<p id="p0133" num="0133">S512: The SMF sends, to the UPF corresponding to the first terminal apparatus, the address information of the second terminal apparatus and/or information that is about a tunnel corresponding to the first session and that is allocated by the SMF. The tunnel is allocated by the SMF based on the address information of the second terminal apparatus, and the tunnel is used for the communication between the first terminal apparatus and the second terminal apparatus.</p>
<p id="p0134" num="0134">S513: The UPF receives the information about the tunnel, or determines information about a communication tunnel between the first terminal apparatus and the second terminal apparatus based on the address information of the second terminal apparatus.</p>
<p id="p0135" num="0135">It should be understood that the steps S506 to S513 may also be completed before S505. Atime sequence relationship between the foregoing steps is not specifically limited in this application.</p>
<p id="p0136" num="0136">Based on a same inventive concept as the foregoing method embodiments, the embodiments of this application further provide a communication apparatus. The communication apparatus may be configured to implement functions performed by the SMF, the traffic management entity, the first terminal apparatus, or the PCF in the foregoing method embodiments.</p>
<p id="p0137" num="0137">As shown in <figref idref="f0011">FIG. 8</figref>, an embodiment of this application further provides a communication apparatus 800, configured to perform an operation performed by an SMF in the foregoing communication method. The communication apparatus 800 may include a receiving unit 801 and a sending unit 802. In addition, the communication apparatus 800 may further include a processing unit 803.</p>
<p id="p0138" num="0138">In an implementation, the receiving unit 801 is used to receive a first message from a first terminal apparatus. The first message is used to request the SMF to establish a first session for the first terminal apparatus. The first message is further used to indicate that the first session is used for communication between the first terminal apparatus and a second terminal apparatus. The first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system. The sending unit 802 may be configured to send address information of the first terminal apparatus to a first management network element based on the first message. The address information of the first terminal apparatus is used to indicate an address of the first terminal apparatus and/or an address of a user plane function UPF corresponding to the first terminal apparatus.<!-- EPO <DP n="25"> --></p>
<p id="p0139" num="0139">For example, if the first management network element includes a traffic management entity, and after the sending unit 802 sends the address information of the first terminal apparatus to the first management network element, the receiving unit 801 is further configured to receive address information of the second terminal apparatus from the traffic management entity. The address information of the second terminal apparatus is used to indicate an address of the second terminal apparatus and/or an address of a UPF corresponding to the second terminal apparatus.</p>
<p id="p0140" num="0140">After the receiving unit 801 receives the address information of the second terminal apparatus from the traffic management entity, the processing unit 803 may be configured to determine a first rule based on the address information of the second terminal apparatus. The sending unit 802 may be configured to send the first rule to the UPF corresponding to the first terminal apparatus. The first rule is used to indicate a routing rule from the first terminal apparatus to the second terminal apparatus and/or a data packet filtering rule between the first terminal apparatus and the second terminal apparatus. Alternatively, the sending unit 802 may be configured to send the address information of the second terminal apparatus to the UPF corresponding to the first terminal apparatus.</p>
<p id="p0141" num="0141">Before the receiving unit 801 receives the address information of the second terminal apparatus from the traffic management entity, the sending unit 802 may further send a second message to the traffic management entity. The second message is used to subscribe to the address information of the second terminal apparatus. The second message may include an identifier of the second terminal apparatus.</p>
<p id="p0142" num="0142">For example, if the first management network element includes the traffic management entity, the sending unit 802 may further be configured to send an identifier of a policy control function PCF, address information of the PCF, or a portion of or all information of the identifier of the second terminal apparatus to the traffic management entity.</p>
<p id="p0143" num="0143">After the sending unit 802 sends the identifier of the policy control function PCF, the address information of the PCF, or a portion of or all information of the identifier of the second terminal apparatus to the traffic management entity, the receiving unit 801 may further be configured to receive a session management policy of the first session from the PCF. The processing unit 803 may further be configured to determine a second rule according to the session management policy of the first session. The second rule is used to indicate the routing rule from the first terminal apparatus to the second terminal apparatus and/or the data packet filtering rule between the first terminal apparatus and the second terminal apparatus. The sending unit 802 may further be configured to send the second rule to the UPF corresponding to the first terminal apparatus.</p>
<p id="p0144" num="0144">The first management network element includes the PCF. After the sending unit 802 sends the address information of the first terminal apparatus to the first management network element, the receiving unit 801 may further<!-- EPO <DP n="26"> --> be configured to receive the session management policy of the first session from the PCF. The processing unit 803 may further be configured to determine the second rule according to the session management policy of the first session. The second rule is used to indicate the routing rule from the first terminal apparatus to the second terminal apparatus and/or the data packet filtering rule between the first terminal apparatus and the second terminal apparatus. The sending unit 802 may further be configured to send the second rule to the UPF corresponding to the first terminal apparatus.</p>
<p id="p0145" num="0145">The sending unit 802 may further be configured to send the identifier of the second terminal apparatus to the PCF.</p>
<p id="p0146" num="0146">After the receiving unit 801 receives the address information of the second terminal apparatus from the traffic management entity, the processing unit 803 may further be configured to allocate, based on the address information of the second terminal apparatus, a tunnel corresponding to the first session. The sending unit 802 may further be configured to send information about the tunnel to the UPF corresponding to the first terminal apparatus. The tunnel is used for the communication between the first terminal apparatus and the second terminal apparatus.</p>
<p id="p0147" num="0147">For example, if the first management network element includes the traffic management entity, the receiving unit 801 may further receive a first response message from the traffic management entity. The first response message is used to indicate that the traffic management entity completes storage of the address information of the first terminal apparatus.</p>
<p id="p0148" num="0148">As shown in <figref idref="f0011">FIG. 9</figref>, an embodiment of this application further provides a communication apparatus 900, configured to perform an operation performed by the first terminal apparatus in the foregoing communication method. The communication apparatus 900 may include a processing unit 901 and a sending unit 902. In addition, the communication apparatus 900 may further include a receiving unit 903.</p>
<p id="p0149" num="0149">In an implementation, the processing unit 901 may be configured to generate a first message. The first message is used to request a session management function SMF to establish a first session for the first terminal apparatus. The first message is further used to indicate that the first session is used for communication between the first terminal apparatus and a second terminal apparatus. The first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system. The sending unit 902 may be configured to send the first message to the session management function SMF. The first message may include an identifier of the second terminal apparatus.</p>
<p id="p0150" num="0150">For example, after the sending unit 902 sends the first message to the session management function SMF, the receiving unit 903 may be configured to receive a response message from the SMF. The response message is used<!-- EPO <DP n="27"> --> to indicate a result of establishing the first session.</p>
<p id="p0151" num="0151">As shown in <figref idref="f0012">FIG. 10</figref>, an embodiment of this application further provides a communication apparatus 1000, configured to perform an operation performed by the traffic management entity in the foregoing communication method. The communication apparatus 1000 may include a receiving unit 1001 and a processing unit 1002. In addition, the communication apparatus 1000 may further include a sending unit 1003.</p>
<p id="p0152" num="0152">In an implementation, the receiving unit 1001 may be configured to receive address information of a first terminal apparatus from a second management network element. The address information of the first terminal apparatus is used to indicate an address of the first terminal apparatus and/or an address of a user plane function UPF corresponding to the first terminal apparatus. The processing unit 1002 may be configured to store the address information of the first terminal apparatus.</p>
<p id="p0153" num="0153">For example, after the processing unit 1002 stores the address information of the first terminal apparatus, the sending unit 1003 may be configured to send the address information of the first terminal apparatus to an SMF that manages a second terminal apparatus. The first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system.</p>
<p id="p0154" num="0154">Before the sending unit 1003 sends the address information of the first terminal apparatus to the SMF that manages the second terminal apparatus, the receiving unit 1001 may further receive a second message from the SMF that manages the second terminal apparatus. The second message is used to subscribe to the address information of the first terminal apparatus. The second message may include an identifier of the first terminal apparatus.</p>
<p id="p0155" num="0155">For example, if the second management network element includes an SMF that manages the first terminal apparatus, and after the processing unit 1002 stores the address information of the first terminal apparatus, the sending unit 1003 further sends address information of the second terminal apparatus to the SMF that manages the first terminal apparatus. The first terminal apparatus and the second terminal apparatus belong to the same unmanned aerial vehicle communication system. The address information of the second terminal apparatus is used to indicate an address of the second terminal apparatus and/or an address of a user plane function UPF corresponding to the second terminal apparatus.</p>
<p id="p0156" num="0156">Before the sending unit 1003 sends the address information of the second terminal apparatus to the SMF that manages the first terminal apparatus, the receiving unit 1001 may further receive a third message from the SMF that manages the first terminal apparatus. The third message is used to subscribe to the address information of the second terminal apparatus. The third message may include an identifier of the second terminal apparatus.</p>
<p id="p0157" num="0157">The receiving unit 1001 may further be configured to receive an identifier of a PCF and/or address<!-- EPO <DP n="28"> --> information of the PCF from the SMF that manages the first terminal apparatus. After the processing unit 1002 stores the address information of the first terminal apparatus, the sending unit 1003 may send the address information of the second terminal apparatus to the PCF. The address information of the second terminal apparatus is used to indicate the address of the second terminal apparatus and/or the address of the UPF corresponding to the second terminal apparatus. The first terminal apparatus and the second terminal apparatus belong to the same unmanned aerial vehicle communication system.</p>
<p id="p0158" num="0158">Before the sending unit 1003 sends the address information of the second terminal apparatus to the PCF, the receiving unit 1001 may further be configured to receive a fourth message from the SMF that manages the first terminal apparatus. The fourth message is used to subscribe to the address information of the second terminal apparatus. The fourth message may include the identifier of the second terminal apparatus.</p>
<p id="p0159" num="0159">For example, if the second management network element includes the PCF, after the processing unit 1002 stores the address information of the first terminal apparatus, the sending unit 1003 may further send the address information of the second terminal apparatus to the PCF. The address information of the second terminal apparatus is used to indicate the address of the second terminal apparatus and/or the address of the UPF corresponding to the second terminal apparatus. The first terminal apparatus and the second terminal apparatus belong to the same unmanned aerial vehicle communication system.</p>
<p id="p0160" num="0160">Before the sending unit 1003 sends the address information of the second terminal apparatus to the PCF, the receiving unit 1001 may further be configured to receive a fifth message from the PCF. The fifth message is used to subscribe to the address information of the second terminal apparatus. The fifth message may include the identifier of the second terminal apparatus.</p>
<p id="p0161" num="0161">As shown in <figref idref="f0012">FIG. 11</figref>, an embodiment of this application further provides a communication apparatus 1100, configured to perform an operation performed by the traffic management entity in the foregoing communication method. The communication apparatus 1100 may include a receiving unit 1101, a processing unit 1102, and a sending unit 1103.</p>
<p id="p0162" num="0162">In an implementation, the receiving unit 1101 may be configured to receive address information of a second terminal apparatus from the traffic management entity. The processing unit 1102 may be configured to determine a session management policy of a first session based on address information of the second terminal apparatus. The first session is used for communication between a first terminal apparatus and the second terminal apparatus. The first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system. The session management policy of the first session may be used to determine a first rule. The<!-- EPO <DP n="29"> --> first rule is used to indicate a routing rule from the first terminal apparatus to the second terminal apparatus and/or a data packet filtering rule between the first terminal apparatus and the second terminal apparatus. The sending unit 1103 may be configured to send the session management policy of the first session to a session management function SMF that manages the first terminal apparatus.</p>
<p id="p0163" num="0163">Before the receiving unit 1101 receives the address information of the second terminal apparatus from the traffic management entity, the receiving unit 1101 may further be configured to receive the address information of the first terminal apparatus from the session management function SMF that manages the first terminal apparatus. Then, the sending unit 1103 may be configured to send the address information of the first terminal apparatus to the traffic management entity.</p>
<p id="p0164" num="0164">Before the receiving unit 1101 receives the address information of the second terminal apparatus from the traffic management entity, the sending unit 1103 may further send a request message to the traffic management entity. The request message is used to subscribe to the address information of the second terminal apparatus. The request message may include an identifier of the second terminal apparatus.</p>
<p id="p0165" num="0165">Based on a same inventive concept as the foregoing method embodiments, as shown in <figref idref="f0013">FIG. 12</figref>, an embodiment of this application further provides a communication apparatus 1200. The communication apparatus 1200 is configured to implement operations performed by an SMF, a traffic management entity, a first terminal apparatus, or a PCF in the methods provided in the foregoing embodiments. For brief description, a schematic diagram of a possible entity apparatus of each of the foregoing network elements is shown by referencing <figref idref="f0013">FIG. 12</figref>. It may be understood that <figref idref="f0013">FIG. 12</figref> is merely a schematic diagram, and may be applied to the foregoing various different network elements and apparatuses. The communication apparatus 1200 may include a transceiver 1201, a processor 1202, and a memory 1203. The transceiver 1201 may support, in a wireless or wired manner, the communication apparatus 1200 in performing communication. Specifically, the transceiver 1201 may be a wireless transceiver, and may be used by the communication apparatus 1200 to perform receiving and sending through a radio air interface. The transceiver 1201 may also be another communication interface, and is configured to support, by using a wired link, the communication apparatus 1200 in performing communication. For example, the transceiver 1201 may be an optical fiber link interface, an Ethernet interface, a copper wire interface, or the like. The memory 1203 is configured to store a program instruction and data. The processor 1202 may be configured for the communication apparatus 1200 to invoke and execute the program instruction in the memory 1203. When the program is executed, the processor 1202 performs an operation performed by the SMF, the traffic management entity, the first terminal apparatus, or the PCF in the method provided in the foregoing embodiment. It should be understood that corresponding steps performed by<!-- EPO <DP n="30"> --> the sending unit (for example, the sending unit 802, the sending unit 902, the sending unit 1003, or the sending unit 1103) and the receiving unit (the receiving unit 801, the receiving unit 901, the receiving unit 1001, or the receiving unit 1101) in <figref idref="f0011 f0012">FIG. 8 to FIG. 11</figref> may be implemented by the transceiver 1201. Corresponding steps performed by the processing units (the processing unit 803, the processing unit 901, the processing unit 1002, or the processing unit 1102) in <figref idref="f0011 f0012">FIG. 8 to FIG. 11</figref> may be implemented by the processor 1202 by invoking the program instruction stored in the memory 1203. For brevity, steps that can be performed by the transceiver 1201 and the processor 1202 are not described herein again. For this step, refer to the descriptions of the corresponding units in <figref idref="f0011 f0012">FIG. 8 to FIG. 11</figref>.</p>
<p id="p0166" num="0166">It should be understood that the processor 1202 in this application may be a central processing unit (central processing unit, CPU), a network processor (network processor, NP), or a combination of a CPU and an NP. The memory 1203 may be a random-access memory (random-access memory, RAM), a read-only memory (read-only memory, ROM), or the like.</p>
<p id="p0167" num="0167">Based on a same concept as the foregoing method embodiments, this application further provides a computer program product. When the computer program product is invoked and executed by a computer, the computer can implement an operation performed by the SMF, the traffic management entity, the first terminal apparatus, or the PCF in the foregoing method embodiments in any possible implementation of the foregoing method embodiments or the method embodiments.</p>
<p id="p0168" num="0168">Based on the same concept as the foregoing method embodiments, this application further provides a chip or a chip system. The chip is coupled to a transceiver, and is configured to implement the operation performed by the SMF, the traffic management entity, the first terminal apparatus, or the PCF in the foregoing method embodiments in any possible implementation of the foregoing method embodiments or the method embodiments. "Coupling" means that two components are directly or indirectly combined with each other, this combination may be fixed or movable, and may allow communication of a fluid, electricity, an electrical signal, or another type of signal between the two components. The chip system may include the chip.</p>
<p id="p0169" num="0169">Based on the same concept as the foregoing method embodiments, this application further provides a communication system. The communication system may be configured to implement the operation performed by the SMF, the traffic management entity, the first terminal apparatus, or the PCF in the foregoing method embodiments in any possible implementation of the foregoing method embodiments or the method embodiments. For example, the communication system has a structure shown in <figref idref="f0001">FIG. 1</figref>.</p>
<p id="p0170" num="0170">The embodiments of this application are described with reference to flowcharts and/or block diagrams of the method, the apparatus, and the computer program product in the embodiments. It should be understood that a<!-- EPO <DP n="31"> --> computer program instruction may be used to implement each process and/or each block in the flowcharts and/or the block diagrams and a combination of a process and/or a block in the flowcharts and/or the block diagrams. The computer program instruction may be provided for a general-purpose computer, a specific-purpose computer, an embedded processor, or a processor of any other programmable data processing device to generate a machine, so that the instruction executed by a computer or a processor of any other programmable data processing device generates an apparatus for implementing a specific function in one or more processes in the flowcharts and/or in one or more blocks in the block diagrams.</p>
<p id="p0171" num="0171">The computer program instruction may be stored in a computer-readable memory that can indicate the computer or the another programmable data processing device to work in a specific manner, so that the instruction stored in the computer-readable memory generates an artifact that includes an instruction apparatus. The instruction apparatus implements the specific function in one or more processes in the flowcharts and/or in one or more blocks in the block diagrams.</p>
<p id="p0172" num="0172">The computer program instruction may be loaded onto the computer or the another programmable data processing device, so that a series of operations and steps are performed on the computer or the another programmable device, thereby generating computer-implemented processing. Therefore, the instruction executed on the computer or the another programmable device provides a step for implementing the specific function in one or more processes in the flowcharts and/or in one or more blocks in the block diagrams.</p>
</description>
<claims id="claims01" lang="en"><!-- EPO <DP n="32"> -->
<claim id="c-en-0001" num="0001">
<claim-text>A communication method, comprising:
<claim-text>receiving, by a session management function SMF, a first message from a first terminal apparatus, wherein the first message is used to request the SMF to establish a first session for the first terminal apparatus, the first message is further used to indicate that the first session is used for communication between the first terminal apparatus and a second terminal apparatus, and the first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system; and</claim-text>
<claim-text>sending, by the SMF, address information of the first terminal apparatus to a first management network element based on the first message, wherein the address information of the first terminal apparatus is used to indicate an address of the first terminal apparatus and/or an address of a user plane function UPF corresponding to the first terminal apparatus.</claim-text></claim-text></claim>
<claim id="c-en-0002" num="0002">
<claim-text>The method according to claim 1, wherein the first management network element comprises a traffic management entity; and<br/>
after the sending, by the SMF, address information of the first terminal apparatus to a first management network element based on the first message, the method further comprises:<br/>
receiving, by the SMF, address information of the second terminal apparatus from the traffic management entity, wherein the address information of the second terminal apparatus is used to indicate an address of the second terminal apparatus and/or an address of a UPF corresponding to the second terminal apparatus.</claim-text></claim>
<claim id="c-en-0003" num="0003">
<claim-text>The method according to claim 2, further comprising:
<claim-text>determining, by the SMF, a first rule based on the address information of the second terminal apparatus, and sending the first rule to the UPF corresponding to the first terminal apparatus, wherein the first rule is used to indicate a routing rule from the first terminal apparatus to the second terminal apparatus and/or a data packet filtering rule between the first terminal apparatus and the second terminal apparatus; or</claim-text>
<claim-text>sending, by the SMF, the address information of the second terminal apparatus to the UPF corresponding to the first terminal apparatus.</claim-text></claim-text></claim>
<claim id="c-en-0004" num="0004">
<claim-text>The method according to claim 2, wherein before the receiving, by the SMF, address information of the second terminal apparatus from the traffic management entity, the method further comprises:<br/>
sending, by the SMF, a second message to the traffic management entity, wherein the second message is used to subscribe to the address information of the second terminal apparatus.<!-- EPO <DP n="33"> --></claim-text></claim>
<claim id="c-en-0005" num="0005">
<claim-text>The method according to claim 4, wherein the second message comprises an identifier of the second terminal apparatus.</claim-text></claim>
<claim id="c-en-0006" num="0006">
<claim-text>The method according to claim 1, wherein the first management network element comprises a traffic management entity; and<br/>
the method further comprises:<br/>
sending, by the SMF, an identifier of a policy control function PCF, address information of the PCF, or a portion of or all information of the identifier of the second terminal apparatus to the traffic management entity.</claim-text></claim>
<claim id="c-en-0007" num="0007">
<claim-text>The method according to claim 6, wherein after the sending, by the SMF, an identifier of a policy control function PCF, address information of the PCF, or a portion of or all information of the identifier of the second terminal apparatus to the traffic management entity, the method further comprises:
<claim-text>receiving, by the SMF, a session management policy of the first session from the PCF;</claim-text>
<claim-text>determining, by the SMF, a second rule according to the session management policy of the first session, wherein the second rule is used to indicate a routing rule from the first terminal apparatus to the second terminal apparatus and/or a data packet filtering rule between the first terminal apparatus and the second terminal apparatus; and</claim-text>
<claim-text>sending, by the SMF, the second rule to the UPF corresponding to the first terminal apparatus.</claim-text></claim-text></claim>
<claim id="c-en-0008" num="0008">
<claim-text>The method according to claim 1, wherein the first management network element comprises a PCF.</claim-text></claim>
<claim id="c-en-0009" num="0009">
<claim-text>The method according to claim 8, wherein after the sending, by the session management function SMF, address information of the first terminal apparatus to a first management network element based on the first message, the method further comprises:
<claim-text>receiving, by the SMF, a session management policy of the first session from the PCF;</claim-text>
<claim-text>determining, by the SMF, a second rule according to the session management policy of the first session, wherein the second rule is used to indicate a routing rule from the first terminal apparatus to the second terminal apparatus and/or a data packet filtering rule between the first terminal apparatus and the second terminal apparatus; and</claim-text>
<claim-text>sending, by the SMF, the second rule to the UPF corresponding to the first terminal apparatus.</claim-text></claim-text></claim>
<claim id="c-en-0010" num="0010">
<claim-text>The method according to claim 8 or 9, further comprising:<br/>
sending, by the SMF, an identifier of the second terminal apparatus to the PCF.</claim-text></claim>
<claim id="c-en-0011" num="0011">
<claim-text>The method according to claim 2, wherein after the receiving, by the SMF, address information of the second terminal apparatus from the traffic management entity, the method further comprises:
<claim-text>allocating, by the SMF based on the address information of the second terminal apparatus, a tunnel corresponding to the first session; and<!-- EPO <DP n="34"> --></claim-text>
<claim-text>sending, by the SMF, information about the tunnel to the UPF corresponding to the first terminal apparatus, wherein the tunnel is used for the communication between the first terminal apparatus and the second terminal apparatus.</claim-text></claim-text></claim>
<claim id="c-en-0012" num="0012">
<claim-text>The method according to claim 1, the first management network element comprises a traffic management entity; and the method further comprises:<br/>
receiving, by the SMF, a first response message from the traffic management entity, wherein the first response message is used to indicate that the traffic management entity completes storage of the address information of the first terminal apparatus.</claim-text></claim>
<claim id="c-en-0013" num="0013">
<claim-text>A communication method, comprising:
<claim-text>generating, by a first terminal apparatus, a first message, wherein the first message is used to request a session management function SMF to establish a first session for the first terminal apparatus, the first message is further used to indicate that the first session is used for communication between the first terminal apparatus and a second terminal apparatus, and the first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system; and</claim-text>
<claim-text>sending, by the first terminal apparatus, the first message to the session management function SMF.</claim-text></claim-text></claim>
<claim id="c-en-0014" num="0014">
<claim-text>The method according to claim 13, wherein the first message comprises an identifier of the second terminal apparatus.</claim-text></claim>
<claim id="c-en-0015" num="0015">
<claim-text>The method according to claim 13, wherein after the sending, by the first terminal apparatus, the first message to the session management function SMF, the method further comprises:<br/>
receiving, by the first terminal apparatus, a response message from the SMF, wherein the response message is used to indicate a result of establishing the first session.</claim-text></claim>
<claim id="c-en-0016" num="0016">
<claim-text>A communication method, comprising:
<claim-text>receiving, by a traffic management entity, address information of a first terminal apparatus from a second management network element, wherein the address information of the first terminal apparatus is used to indicate an address of the first terminal apparatus and/or an address of a user plane function UPF corresponding to the first terminal apparatus; and</claim-text>
<claim-text>storing, by the traffic management entity, the address information of the first terminal apparatus.</claim-text></claim-text></claim>
<claim id="c-en-0017" num="0017">
<claim-text>The method according to claim 16, wherein after the storing, by the traffic management entity, the address information of the first terminal apparatus, the method further comprises:<br/>
sending, by the traffic management entity, the address information of the first terminal apparatus to an SMF that<!-- EPO <DP n="35"> --> manages a second terminal apparatus, wherein the first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system.</claim-text></claim>
<claim id="c-en-0018" num="0018">
<claim-text>The method according to claim 17, wherein before the sending, by the traffic management entity, the address information of the first terminal apparatus to an SMF that manages a second terminal apparatus, the method further comprises:<br/>
receiving, by the traffic management entity, a second message from the SMF that manages the second terminal apparatus, wherein the second message is used to subscribe to the address information of the first terminal apparatus.</claim-text></claim>
<claim id="c-en-0019" num="0019">
<claim-text>The method according to claim 18, wherein the second message comprises an identifier of the first terminal apparatus.</claim-text></claim>
<claim id="c-en-0020" num="0020">
<claim-text>The method according to claim 16, wherein the second message comprises an SMF that manages the first terminal apparatus.</claim-text></claim>
<claim id="c-en-0021" num="0021">
<claim-text>The method according to claim 20, wherein after the storing, by the traffic management entity, the address information of the first terminal apparatus, the method further comprises:<br/>
sending, by the traffic management entity, address information of a second terminal apparatus to the SMF that manages the first terminal apparatus, wherein the first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system, and the address information of the second terminal apparatus is used to indicate an address of the second terminal apparatus and/or an address of a user plane function UPF corresponding to the second terminal apparatus.</claim-text></claim>
<claim id="c-en-0022" num="0022">
<claim-text>The method according to claim 21, wherein before the sending, by the traffic management entity, address information of a second terminal apparatus to the SMF that manages the first terminal apparatus, the method further comprises:<br/>
receiving, by the traffic management entity, a third message from the SMF that manages the first terminal apparatus, wherein the third message is used to subscribe to the address information of the second terminal apparatus.</claim-text></claim>
<claim id="c-en-0023" num="0023">
<claim-text>The method according to claim 22, wherein the third message comprises an identifier of the second terminal apparatus.</claim-text></claim>
<claim id="c-en-0024" num="0024">
<claim-text>The method according to claim 20, further comprising:
<claim-text>receiving, by the traffic management entity, an identifier of a policy control function PCF and/or address information of the PCF from the SMF that manages the first terminal apparatus; and</claim-text>
<claim-text>after the storing, by the traffic management entity, the address information of the first terminal apparatus, the method further comprises:<!-- EPO <DP n="36"> -->
<claim-text>sending, by the traffic management entity, address information of a second terminal apparatus to the PCF, wherein</claim-text>
<claim-text>the address information of the second terminal apparatus is used to indicate an address of the second terminal apparatus and/or an address of a UPF corresponding to the second terminal apparatus, and the first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system.</claim-text></claim-text></claim-text></claim>
<claim id="c-en-0025" num="0025">
<claim-text>The method according to claim 24, wherein before the sending, by the traffic management entity, address information of a second terminal apparatus to the PCF, the method further comprises:<br/>
receiving, by the traffic management entity, a fourth message from the SMF that manages the first terminal apparatus, wherein the fourth message is used to subscribe to the address information of the second terminal apparatus.</claim-text></claim>
<claim id="c-en-0026" num="0026">
<claim-text>The method according to claim 25, wherein the fourth message comprises an identifier of the second terminal apparatus.</claim-text></claim>
<claim id="c-en-0027" num="0027">
<claim-text>The method according to claim 1, wherein the second management network element comprises a PCF; and after the storing, by the traffic management entity, the address information of the first terminal apparatus, the method further comprises:<br/>
sending, by the traffic management entity, address information of a second terminal apparatus to the PCF, wherein the address information of the second terminal apparatus is used to indicate an address of the second terminal apparatus and/or an address of a UPF corresponding to the second terminal apparatus, and the first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system.</claim-text></claim>
<claim id="c-en-0028" num="0028">
<claim-text>The method according to claim 27, wherein before the sending, by the traffic management entity, address information of a second terminal apparatus to the PCF, the method further comprises:<br/>
receiving, by the traffic management entity, a fifth message from the PCF, wherein the fifth message is used to subscribe to the address information of the second terminal apparatus.</claim-text></claim>
<claim id="c-en-0029" num="0029">
<claim-text>The method according to claim 28, wherein the fifth message comprises an identifier of the second terminal apparatus.</claim-text></claim>
<claim id="c-en-0030" num="0030">
<claim-text>A communication method, comprising:
<claim-text>receiving, by a policy control function PCF, address information of a first terminal apparatus from a traffic management entity;</claim-text>
<claim-text>determining, by the PCF, a session management policy of a first session based on the address information of the first terminal apparatus, wherein the first session is used for communication between the first terminal apparatus and a second terminal apparatus, the first terminal apparatus and the second terminal apparatus belong to a same unmanned aerial vehicle communication system, the session management policy of the first session may be used to determine a<!-- EPO <DP n="37"> --> first rule, and the first rule is used to indicate a routing rule from the first terminal apparatus to the second terminal apparatus and/or a data packet filtering rule between the first terminal apparatus and the second terminal apparatus; and</claim-text>
<claim-text>sending, by the PCF, the session management policy of the first session to a session management function SMF that manages the second terminal apparatus.</claim-text></claim-text></claim>
<claim id="c-en-0031" num="0031">
<claim-text>The method according to claim 30, wherein before the receiving, by a policy control function PCF, address information of a first terminal apparatus from a traffic management entity, the method further comprises:
<claim-text>receiving, by the PCF, address information of the second terminal apparatus from the session management function SMF that manages the second terminal apparatus; and</claim-text>
<claim-text>sending, by the PCF, the address information of the second terminal apparatus to the traffic management entity.</claim-text></claim-text></claim>
<claim id="c-en-0032" num="0032">
<claim-text>The method according to claim 30, wherein before the receiving, by a policy control function PCF, address information of a first terminal apparatus from a traffic management entity, the method further comprises:<br/>
sending, by the PCF, a first message to the traffic management entity, wherein the first message is used to subscribe to the address information of the first terminal apparatus.</claim-text></claim>
<claim id="c-en-0033" num="0033">
<claim-text>The method according to claim 32, wherein the first message comprises an identifier of the first terminal apparatus.</claim-text></claim>
<claim id="c-en-0034" num="0034">
<claim-text>A communication apparatus, comprising a transceiver, a memory, and a processor, wherein
<claim-text>the transceiver is used by the apparatus to perform communication;</claim-text>
<claim-text>the memory is configured to store a computer program; and</claim-text>
<claim-text>the processor is configured to invoke the computer program from the memory and run the computer program, so that the apparatus performs the method according to any one of claims 1 to 33.</claim-text></claim-text></claim>
<claim id="c-en-0035" num="0035">
<claim-text>A computer-readable storage medium, comprising instructions, wherein when the instructions are run on a computer, the computer is enabled to perform the method according to any one of claims 1 to 33.</claim-text></claim>
<claim id="c-en-0036" num="0036">
<claim-text>A computer program product comprising instructions, wherein when the computer program product runs on a computer, the computer is enabled to perform the method according to any one of claims 1 to 33.</claim-text></claim>
<claim id="c-en-0037" num="0037">
<claim-text>A chip, wherein the chip is coupled to a transceiver, and the chip is configured to perform the method according to any one of claims 1 to 33.</claim-text></claim>
</claims>
<drawings id="draw" lang="en"><!-- EPO <DP n="38"> -->
<figure id="f0001" num="1,2"><img id="if0001" file="imgf0001.tif" wi="165" he="218" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="39"> -->
<figure id="f0002" num="3"><img id="if0002" file="imgf0002.tif" wi="159" he="129" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="40"> -->
<figure id="f0003" num="4A"><img id="if0003" file="imgf0003.tif" wi="165" he="209" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="41"> -->
<figure id="f0004" num="4B"><img id="if0004" file="imgf0004.tif" wi="165" he="173" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="42"> -->
<figure id="f0005" num="5A"><img id="if0005" file="imgf0005.tif" wi="165" he="216" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="43"> -->
<figure id="f0006" num="5B"><img id="if0006" file="imgf0006.tif" wi="165" he="213" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="44"> -->
<figure id="f0007" num="6A"><img id="if0007" file="imgf0007.tif" wi="165" he="216" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="45"> -->
<figure id="f0008" num="6B"><img id="if0008" file="imgf0008.tif" wi="165" he="194" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="46"> -->
<figure id="f0009" num="7A"><img id="if0009" file="imgf0009.tif" wi="160" he="220" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="47"> -->
<figure id="f0010" num="7B"><img id="if0010" file="imgf0010.tif" wi="156" he="175" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="48"> -->
<figure id="f0011" num="8,9"><img id="if0011" file="imgf0011.tif" wi="86" he="209" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="49"> -->
<figure id="f0012" num="10,11"><img id="if0012" file="imgf0012.tif" wi="86" he="209" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="50"> -->
<figure id="f0013" num="12"><img id="if0013" file="imgf0013.tif" wi="132" he="112" img-content="drawing" img-format="tif"/></figure>
</drawings>
<search-report-data id="srep" lang="en" srep-office="EP" date-produced=""><doc-page id="srep0001" file="srep0001.tif" wi="161" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="161" he="233" type="tif"/><doc-page id="srep0003" file="srep0003.tif" wi="161" he="233" type="tif"/></search-report-data>
<ep-reference-list id="ref-list">
<heading id="ref-h0001"><b>REFERENCES CITED IN THE DESCRIPTION</b></heading>
<p id="ref-p0001" num=""><i>This list of references cited by the applicant is for the reader's convenience only. It does not form part of the European patent document. Even though great care has been taken in compiling the references, errors or omissions cannot be excluded and the EPO disclaims all liability in this regard.</i></p>
<heading id="ref-h0002"><b>Patent documents cited in the description</b></heading>
<p id="ref-p0002" num="">
<ul id="ref-ul0001" list-style="bullet">
<li><patcit id="ref-pcit0001" dnum="CN201811611661" dnum-type="L"><document-id><country>CN</country><doc-number>201811611661</doc-number><date>20181227</date></document-id></patcit><crossref idref="pcit0001">[0001]</crossref></li>
</ul></p>
</ep-reference-list>
</ep-patent-document>
