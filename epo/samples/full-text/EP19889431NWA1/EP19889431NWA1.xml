<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE ep-patent-document PUBLIC "-//EPO//EP PATENT DOCUMENT 1.5.1//EN" "ep-patent-document-v1-5-1.dtd">
<!-- This XML data has been generated under the supervision of the European Patent Office -->
<ep-patent-document id="EP19889431A1" file="EP19889431NWA1.xml" lang="en" country="EP" doc-number="3890258" kind="A1" date-publ="20211006" status="n" dtd-version="ep-patent-document-v1-5-1">
<SDOBI lang="en"><B000><eptags><B001EP>ATBECHDEDKESFRGBGRITLILUNLSEMCPTIESILTLVFIROMKCYALTRBGCZEEHUPLSKBAHRIS..MTNORSMESMMAKHTNMD..........</B001EP><B005EP>J</B005EP><B007EP>BDM Ver 2.0.12 (4th of August) -  1100000/0</B007EP></eptags></B000><B100><B110>3890258</B110><B120><B121>EUROPEAN PATENT APPLICATION</B121><B121EP>published in accordance with Art. 153(4) EPC</B121EP></B120><B130>A1</B130><B140><date>20211006</date></B140><B190>EP</B190></B100><B200><B210>19889431.3</B210><B220><date>20191126</date></B220><B240><B241><date>20210615</date></B241></B240><B250>zh</B250><B251EP>en</B251EP><B260>en</B260></B200><B300><B310>201811422473</B310><B320><date>20181127</date></B320><B330><ctry>CN</ctry></B330></B300><B400><B405><date>20211006</date><bnum>202140</bnum></B405><B430><date>20211006</date><bnum>202140</bnum></B430></B400><B500><B510EP><classification-ipcr sequence="1"><text>H04L  12/933       20130101AFI20200605BHEP        </text></classification-ipcr></B510EP><B540><B541>de</B541><B542>NETZWERKEINRICHTUNG UND UMWANDLUNGSVORRICHTUNG</B542><B541>en</B541><B542>NETWORK APPARATUS, AND CONVERSION DEVICE</B542><B541>fr</B541><B542>APPAREIL DE RÉSEAU ET DISPOSITIF DE CONVERSION</B542></B540><B590><B598>1</B598></B590></B500><B700><B710><B711><snm>New H3C Technologies Co., Ltd.</snm><iid>101816284</iid><irf>EP135004-EH</irf><adr><str>466 Changhe Road 
Binjiang District</str><city>Hangzhou, Zhejiang 310052</city><ctry>CN</ctry></adr></B711></B710><B720><B721><snm>LI, Yuewu</snm><adr><str>Room 640, Floor 6, Block A, Tower 1
LSH Center
8 Guangshun South Street
Chaoyang District</str><city>Beijing 100102</city><ctry>CN</ctry></adr></B721></B720><B740><B741><snm>Grünecker Patent- und Rechtsanwälte 
PartG mbB</snm><iid>100060488</iid><adr><str>Leopoldstraße 4</str><city>80802 München</city><ctry>DE</ctry></adr></B741></B740></B700><B800><B840><ctry>AL</ctry><ctry>AT</ctry><ctry>BE</ctry><ctry>BG</ctry><ctry>CH</ctry><ctry>CY</ctry><ctry>CZ</ctry><ctry>DE</ctry><ctry>DK</ctry><ctry>EE</ctry><ctry>ES</ctry><ctry>FI</ctry><ctry>FR</ctry><ctry>GB</ctry><ctry>GR</ctry><ctry>HR</ctry><ctry>HU</ctry><ctry>IE</ctry><ctry>IS</ctry><ctry>IT</ctry><ctry>LI</ctry><ctry>LT</ctry><ctry>LU</ctry><ctry>LV</ctry><ctry>MC</ctry><ctry>MK</ctry><ctry>MT</ctry><ctry>NL</ctry><ctry>NO</ctry><ctry>PL</ctry><ctry>PT</ctry><ctry>RO</ctry><ctry>RS</ctry><ctry>SE</ctry><ctry>SI</ctry><ctry>SK</ctry><ctry>SM</ctry><ctry>TR</ctry></B840><B844EP><B845EP><ctry>BA</ctry></B845EP><B845EP><ctry>ME</ctry></B845EP></B844EP><B848EP><B849EP><ctry>KH</ctry></B849EP><B849EP><ctry>MA</ctry></B849EP><B849EP><ctry>MD</ctry></B849EP><B849EP><ctry>TN</ctry></B849EP></B848EP><B860><B861><dnum><anum>CN2019120843</anum></dnum><date>20191126</date></B861><B862>zh</B862></B860><B870><B871><dnum><pnum>WO2020108467</pnum></dnum><date>20200604</date><bnum>202023</bnum></B871></B870></B800></SDOBI>
<abstract id="abst" lang="en">
<p id="pa01" num="0001">A network device includes a switch chip and a CPU, wherein the switch chip at least includes a CPU interface, and the CPU at least includes a media access controller and a Buffer. The network device further includes a conversion apparatus. The conversion apparatus receives a first packet uploaded by the switch chip to the CPU through the CPU interface, obtains a second packet by migrating a private information header in an Ethernet header of the first packet to a specified position of the first packet, calculates a Cyclic Redundancy Check, CRC, code of the second packet, obtains a third packet by replacing a CRC code already carried in the second packet with the calculated CRC code, and sends the third packet to the Buffer on the CPU for buffering, wherein the specified position is a position other than the Ethernet header in the first packet.<img id="iaf01" file="imgaf001.tif" wi="78" he="119" img-content="drawing" img-format="tif"/></p>
</abstract>
<description id="desc" lang="en"><!-- EPO <DP n="1"> -->
<heading id="h0001"><b>BACKGROUND</b></heading>
<p id="p0001" num="0001">Generally, a network device includes a switch chip and a Central Processing Unit (CPU). When sending a packet to the CPU, the switch chip firstly adds a private information header in an Ethernet header of the packet according to a private protocol, and then sends the packet carrying the private information header to the CPU, so that the CPU obtains packet characteristics from the private information header of the packet. Information related to the packet characteristics may include a Virtual Local Area Network (VLAN) to which the packet belongs, Quality of Service (QoS) of the packet, interface information of a peripheral interface receiving the packet, and the like.</p>
<p id="p0002" num="0002">Since different switch chips may adopt different private protocols, the CPU cannot normally identify the packets due to the private information headers carried in the Ethernet header of the packets after receiving the packets, thereby affecting diversion of the packets by the CPU.</p>
<heading id="h0002"><b>BRIEF DESCRIPTION OF THE DRAWINGS</b></heading>
<p id="p0003" num="0003">The accompanying drawings, which are incorporated in and constitute a part of the present specification, illustrate examples consistent with the present disclosure and serve to explain the principles of the present disclosure together with the specification.
<ul id="ul0001" list-style="none" compact="compact">
<li><figref idref="f0001">FIG. 1</figref> is a schematic diagram illustrating a structure of a network device according to an example of the present disclosure.</li>
<li><figref idref="f0001">FIG. 2</figref> is a schematic diagram illustrating a private information header located at a specified position according to an example of the present disclosure.</li>
<li><figref idref="f0002">FIG. 3</figref> is a schematic diagram illustrating a structure of a network device according to a first example of the present disclosure.</li>
<li><figref idref="f0002">FIG. 4</figref> is a schematic diagram illustrating a format of a packet carrying a private information header according to an example of the present disclosure.</li>
<li><figref idref="f0003">FIG. 5</figref> is a schematic diagram illustrating a structure of a network device according to a second example of the present disclosure.</li>
<li><figref idref="f0004">FIG. 6</figref> is a schematic diagram illustrating a structure of a network device according to a third example of the present disclosure.<!-- EPO <DP n="2"> --></li>
<li><figref idref="f0005">FIG. 7</figref> is a schematic diagram illustrating a structure of a network device according to a fourth example of the present disclosure.</li>
<li><figref idref="f0006">FIG. 8</figref> is a schematic diagram illustrating a structure of a conversion apparatus according to an example of the present disclosure.</li>
<li><figref idref="f0006">FIG. 9</figref> is a schematic diagram illustrating a structure of another conversion apparatus according to an example of the present disclosure.</li>
</ul></p>
<heading id="h0003"><b>DETAILED DESCRIPTION OF THE EMBODIMENTS</b></heading>
<p id="p0004" num="0004">To understand the objects, technical solutions and advantages of the present disclosure more clearly, the present disclosure will be described in detail below in combination with drawings and specified examples.</p>
<p id="p0005" num="0005"><figref idref="f0001">FIG. 1</figref> is a schematic diagram illustrating a structure of a network device according to an example of the present disclosure. As shown in <figref idref="f0001">FIG 1</figref>, the network device may include a switch chip 101, a CPU 102 and a conversion apparatus 103. The conversion apparatus 103 herein may be implemented by software or hardware. When the conversion apparatus 103 is implemented by software, the conversion apparatus 103 may be applied to an apparatus including a processor and a storage medium. The functions of the conversion apparatus 103 may be implemented by reading machine executable codes stored in the storage medium through the processor. When the conversion apparatus 103 is implemented by hardware, the conversion apparatus 103 may be, for example, a Field Programmable Gate Array (FPGA) chip. The implementation of the conversion apparatus 103 is not limited specifically herein.</p>
<p id="p0006" num="0006">As shown in <figref idref="f0001">FIG. 1</figref>, the switch chip 101 has a CPU interface 101_1. The switch chip 101 may upload a packet to the CPU 102 and receive a packet from the CPU 102 through the interface. The CPU 102 at least includes a Media Access Controller (MAC) 102_1 and a buffer 102_2.</p>
<p id="p0007" num="0007">In <figref idref="f0001">FIG. 1</figref>, the conversion apparatus 103 receives a first packet that is sent by the switch chip 101 through the CPU interface 101_1 and is to be uploaded to the CPU 102, obtains a second packet by migrating a private information header in an Ethernet header of the first packet to a specified position of the first packet, calculates a Cyclic Redundancy Check (CRC) code of the second packet, obtains a third packet by replacing a CRC code already carried in the second packet with the calculated CRC code, and sends the third packet to the buffer on the CPU for buffering. It is to be noted that the above first to third packets are named only for distinguishing convenience rather than for limitation.</p>
<p id="p0008" num="0008">In an application, a packet is usually identified by analyzing an Ethernet header of<!-- EPO <DP n="3"> --> the packet. The Ethernet header may include a data link layer header (also referred to as a layer-2 header), an IP header (also referred to as a layer-3 header) and a TCP/UDP header (also referred to as a layer-4 header). Based on this, the above specified position may be a position other than the Ethernet header in this example.</p>
<p id="p0009" num="0009">In an example, the above specified position may be, for example, the last N idle bytes in an Ethernet Payload of the packet without affecting original contents of the packet, where N refers to the number of bytes occupied by the private information header. <figref idref="f0001">FIG. 2</figref> exemplifies a schematic diagram of a private information header located at a specified position according to an example of the present disclosure.</p>
<p id="p0010" num="0010">Thus, descriptions of the structure of the network device shown in <figref idref="f0001">FIG. 1</figref> are completed.</p>
<p id="p0011" num="0011">It can be seen from the structure of the network device shown in <figref idref="f0001">FIG. 1</figref> that, in an example of the present disclosure, the conversion apparatus 103 migrates the private information header originally carried in the Ethernet header of the packet to the position other than the Ethernet header in the packet. In this case, even if the packet carries the private information header, identification of the packets by the CPU is not affected. Further, normal diversion of the packets by the CPU is also not affected.</p>
<p id="p0012" num="0012">The structure of the network device according to the examples of the present disclosure is described below with four specific examples.</p>
<heading id="h0004">Example 1</heading>
<p id="p0013" num="0013"><figref idref="f0002">FIG. 3</figref> is a schematic diagram illustrating a structure of a network device according to an example of the present disclosure. As shown in <figref idref="f0002">FIG. 3</figref>, the network device may include a switch chip 301, a CPU 302 and a conversion apparatus 303. As an example, the network device includes one switch chip.</p>
<p id="p0014" num="0014">As shown in <figref idref="f0002">FIG. 3</figref>, the switch chip 301 may include a CPU interface 301_1 and a peripheral interface 301_2. The number of the peripheral interfaces 301_2 herein is greater than or equal to 1. The peripheral interface is configured to receive a packet outside the switch chip 301 and send a packet to the outside of the switch chip 301.</p>
<p id="p0015" num="0015">As shown in <figref idref="f0002">FIG. 3</figref>, the CPU 302 at least includes a media access controller 302_1, a buffer 302_2, a memory 302_3, a CPU core 302_4 and a diversion module 302_5. The number of the CPU cores 302_4 is greater than or equal to 1.</p>
<p id="p0016" num="0016">In this example, as shown in <figref idref="f0002">FIG. 3</figref>, the conversion apparatus 303 is connected between the CPU interface 301_1 and the media access controller 302_1. One interface Port 303_1 of the conversion apparatus 303 is connected with the CPU interface 301_1, and the other interface Port 303_2 is connected with the media access controller 302_1.<!-- EPO <DP n="4"> --></p>
<p id="p0017" num="0017">Based on the above structure, how the packet is sent from the switch chip 301 to the CPU 302 is described below.</p>
<p id="p0018" num="0018">As shown in <figref idref="f0002">FIG. 3</figref>, the switch chip 301 receives a packet through the peripheral interface Port 301_2. For convenience of description, the packet herein may be denoted as a packet 31.</p>
<p id="p0019" num="0019">When determining that the packet 31 is to be uploaded to the CPU 302, the switch chip 301 may add a private information header in an Ethernet header of the packet 31 in a preset manner in which the private information header is added. As shown in <figref idref="f0002">FIG. 4</figref>, the private information header may be added after a destination MAC address and a source MAC address. The private information header herein includes the following packet characteristic information: a VLAN to which the packet 31 belongs, QoS of the packet 31, interface information Port 301_2, and the like. For convenience of description, the packet 31 added with the private information header herein is denoted as a packet 32.</p>
<p id="p0020" num="0020">The switch chip 301 sends the packet 32 through CPU interface 301_1.</p>
<p id="p0021" num="0021">The interface Port 303_1 of the conversion apparatus 303 is connected with the CPU interface 301_1. When the switch chip 301 sends the packet 32 through the CPU interface 301_1, the conversion apparatus 303 receives the packet 32 through the interface Port 303_1.</p>
<p id="p0022" num="0022">The conversion apparatus 303 receives the packet 32 through the interface Port 303_1, identifies a private information header from an Ethernet header of the packet 32 in a locally-recorded manner in which the private information header is identified, and then processes the packet 32 as follows: migrating the identified private information header from the Ethernet header to a specified position of the packet 32 and re-calculating a CRC code of the packet 32 after the private information header is migrated, and updating a CRC code already carried in the packet 32 with the re-calculated CRC code. The manner in which the private information header is identified herein corresponds to the manner in which the switch chip 301 adds the private information header. The manner in which the private information header is identified may be pre-configured in the conversion apparatus 303, or may be identified by the conversion apparatus 303 according to a chip identifier of the switch chip 301.</p>
<p id="p0023" num="0023">In this example, the specified position being the last N idle bytes in the Payload of the packet 32 is taken as an example, where N refers to the number of bytes occupied by the private information header.</p>
<p id="p0024" num="0024">For convenience of description, the packet 32 which has been processed by the conversion apparatus 303 is denoted as a packet 33.</p>
<p id="p0025" num="0025">The conversion apparatus 303 sends the packet 33 through the interface Port 303_2.<!-- EPO <DP n="5"> --></p>
<p id="p0026" num="0026">The interface Port 303_2 of the conversion apparatus 303 is connected with the media access controller 302_1 of the CPU 302. Thus, after the conversion apparatus 303 sends the packet 33 through the interface Port 303_2, the media access controller 302_1 of the CPU 302 receives the packet 33.</p>
<p id="p0027" num="0027">After receiving the packet 33, the media access controller 302_1 processes the packet 33. The media access controller 302_1 may process the packet 33 according to a standard Ethernet MAC definition, the process mainly including packetizing the packets 33 according to the standard Ethernet MAC definition and the like, which is not limited specifically herein. For convenience of description, the processed packet 33 herein is denoted as a packet 34.</p>
<p id="p0028" num="0028">The media access controller 302_1 buffers the packet 34 to the buffer 302_2.</p>
<p id="p0029" num="0029">Thus, the private information header in the packet 34 buffered in the buffer 302_2 is at the end of the Payload of the packet 34.</p>
<p id="p0030" num="0030">In this example, when it is required to obtain packet characteristic information in the private information header in the packet 34, the CPU core 302_4 may read instruction codes from the memory 302_3, and obtain the packet characteristic information in the private information header in the packet 34 by running the instruction codes. The memory 302_3 pre-stores the above instruction codes. As described above, the packet characteristic information herein mainly includes a VLAN to which the packet 31 belongs, QoS of the packet 31, interface information Port301_2, and the like.</p>
<p id="p0031" num="0031">After obtaining the packet characteristic information, the CPU core 302_4 may set a packet control strategy and the like based on the obtained packet characteristic information. In this example, an operation performed after the packet characteristic information is obtained is not limited specifically.</p>
<p id="p0032" num="0032">In this example, when it is required to divert the packets 34, the diversion module 302_5 may obtain the packets 34 from the buffer 302_2. The private information header of the packet 34 is at the end of the Payload (the last N idle bytes in the Payload) of the packet 34, which does not affect the identification and diversion of the packets 34 by the diversion module 302_5. Therefore, the diversion module 302_5 may normally divert the packets 34 in an existing diversion manner to allocate the packets 34 to a corresponding packet queue. Specifically, the diversion module 302_5 may divert the packets 34 as follows. The diversion module 302_5 may determine a priority of the packet 34 according to the information in the Ethernet header of the packet 34 and place the packet 34 in a packet queue corresponding to the priority. In this example, different packet queues may be scheduled by a same CPU core, or may be scheduled by different CPU cores, which is not limited specifically herein.</p>
<p id="p0033" num="0033">As can be seen, in this example, the conversion apparatus 303 migrates the private<!-- EPO <DP n="6"> --> information header originally carried in the Ethernet header of the packet to the specified position that is other than the Ethernet header in the packet and does not affect packet identification. In this case, even if the packet carries the private information header, identification and normal diversion of the packets by the CPU (specifically. the diversion module 302_5) will not be affected since the private information header is located at a position that is in the packet and does not affect packet identification.</p>
<p id="p0034" num="0034">Thus, descriptions of the first example are completed.</p>
<heading id="h0005">Example 2</heading>
<p id="p0035" num="0035"><figref idref="f0003">FIG. 5</figref> is a schematic diagram illustrating a structure of a network device according to the second example of the present disclosure. As shown in <figref idref="f0003">FIG. 5</figref>, the network device may include a switch chip 501, a CPU 502 and a conversion apparatus 503. As an example, the network device includes one switch chip.</p>
<p id="p0036" num="0036">As shown in <figref idref="f0003">FIG. 5</figref>, the switch chip 501 may include a CPU interface 501_1 and a peripheral interface 501_2.</p>
<p id="p0037" num="0037">The CPU 502 at least includes a media access controller 502_1, a buffer 502_2, a memory 502_3, a CPU core 502_4 and a diversion module 502_5.</p>
<p id="p0038" num="0038">In this example, the CPU interface 501_1 of the switch chip 501 is connected with the media access controller 502_1 of the CPU 502.</p>
<p id="p0039" num="0039">In this example, the conversion apparatus 503 is connected between the media access controller 502_1 and the buffer 502_2.</p>
<p id="p0040" num="0040">Based on the above structure, how a packet is sent from the switch chip 501 to the CPU 502 is described below.</p>
<p id="p0041" num="0041">As shown in <figref idref="f0003">FIG. 5</figref>, the switch chip 501 receives a packet through the peripheral interface 501_2. For convenience of description, the packet herein may be denoted as a packet 51.</p>
<p id="p0042" num="0042">When determining that the packet 51 is to be uploaded to the CPU 502, the switch chip 501 adds a private information header in an Ethernet header of the packet 51 in a processing manner similar to that of the above switch chip 301. The added private information header is as shown in <figref idref="f0002">FIG. 4</figref>. For convenience of description, the packet 51 added with the private information header herein is denoted as a packet 52.</p>
<p id="p0043" num="0043">The switch chip 501 sends the packet 52 through the CPU interface 501_1.</p>
<p id="p0044" num="0044">The CPU interface 501_1 of the switch chip 501 is connected with the media access controller 502_1 of the CPU 502. When the switch chip 501 sends the packet 52 through the CPU interface 501_1, the media access controller 502_1 of the CPU 502 receives the packet 52.<!-- EPO <DP n="7"> --></p>
<p id="p0045" num="0045">After receiving the packet 52, the media access controller 502_1 processes the packet 52. The manner in which the media access controller 502_1 processes the packet 52 herein is similar to the manner in which the media access controller 302_1 processes the packet in the first example. For convenience of description, the processed packet 52 herein is denoted as a packet 53.</p>
<p id="p0046" num="0046">The media access controller 502_1 sends the packet 53 to the buffer 502_2.</p>
<p id="p0047" num="0047">The conversion apparatus 503 is connected between the media access controller 502_1 and the buffer 502_2. When the media access controller 502_1 sends the packet 53 to the buffer 502_2, the conversion apparatus 503 located between the media access controller 502_1 and the buffer 502_2 will receive the packet 53 earlier than the buffer 502_2.</p>
<p id="p0048" num="0048">When receiving the packet 53, the conversion apparatus 503 identifies the private information header from the Ethernet header of the packet 53 in a locally recorded manner in which the private information header is identified, and then processes the packet 53 as follows: migrating the identified private information header from the Ethernet header to a specified position of the packet 53 and re-calculating a CRC code of the packet 53 after the private information header is migrated, and updating a CRC code already carried in the packet 53 with the re-calculated CRC code. In this example, the specified position being the last N idle bytes in the Payload of the packet 53 is taken as an example, where N refers to the number of bytes occupied by the private information header.</p>
<p id="p0049" num="0049">For convenience of description, the packet 53 which has been processed by the conversion apparatus 503 is denoted as a packet 54.</p>
<p id="p0050" num="0050">The conversion apparatus 503 buffers the packet 54 to the buffer 502_2. Thus, the private information header in the packet 54 buffered in the buffer 502_2 is at the end of the Payload of the packet 54.</p>
<p id="p0051" num="0051">In this example, when it is required to obtain packet characteristic information in the private information header in the packet 54, the CPU core 502_4 obtains the packet characteristic information in the private information header in the packet 54 by performing the same operation as performed by the CPU core 302_4.</p>
<p id="p0052" num="0052">In this example, when it is required to divert the packets 54, the diversion module 502_5 diverts the packets 54 by performing the same operation as performed by the diversion module 302_5.</p>
<p id="p0053" num="0053">It can be seen that, in this example, the conversion apparatus 503 migrates the private information header originally carried in the Ethernet header of the packet to the position that is other than the Ethernet header in the packet and does not affect packet identification. In this case, even if the packet carries the private information header, since the private information<!-- EPO <DP n="8"> --> header is at a position in the packet that does not affect packet identification, the identification and normal diversion of the packets by the CPU (specifically, the diversion module 302_5) are not affected.</p>
<p id="p0054" num="0054">Thus, descriptions of the second example are completed.</p>
<heading id="h0006">Example 3</heading>
<p id="p0055" num="0055"><figref idref="f0004">FIG. 6</figref> is a schematic diagram illustrating a structure of a network device according to the third example of the present disclosure. As shown in <figref idref="f0004">FIG. 6</figref>, the network device may include a switch chip 601 and a CPU 602. As an example, the network device includes one switch chip.</p>
<p id="p0056" num="0056">In the third example, a structure of the switch chip 601 is similar to structures of the switch chip 301 and the switch chip 501, which is not described herein.</p>
<p id="p0057" num="0057">In the third example, the CPU 602 at least includes a module 600, a buffer 602_1, a memory 602_2, a CPU core 602_3 and a diversion module 602_4. The module 600 includes a media access controller 600_1 and a conversion apparatus 600_2.</p>
<p id="p0058" num="0058">In the third example, the media access controller 600_1 and the conversion apparatus 600_2 may be configured in the module 600 according to the following principle 1. The principle 1 requires the conversion apparatus 600_2 to receive a packet from the switch chip 601 earlier than the media access controller 600_1.</p>
<p id="p0059" num="0059">Based on this, when receiving the packet from the switch chip 601, the conversion apparatus 600_2 may process the packet in the manner in which the conversion apparatus processes the packet in the first example. Finally, the private information header in the packet buffered in the buffer 602_1 is located at the specified position (for example, at the end of the Payload) of the packet.</p>
<p id="p0060" num="0060">In the third example, the CPU core 602_3 and the diversion module 602_4 may process the packet in the manner in which the CPU core and the diversion module process the packet in the first or second example respectively.</p>
<p id="p0061" num="0061">Thus, descriptions of the third example are completed.</p>
<p id="p0062" num="0062">It is to be noted that, in this example, the media access controller 600_1 and the conversion apparatus 600_2 may also be configured in the module 600 according to the following principle 2. The principle 2 requires the media access controller 600_1 to receive the packet from the conversion chip 601 earlier than the conversion apparatus 600_2. In this case, when receiving the packet from the switch chip 601, the conversion apparatus 600_2 may process the packet in the manner in which the conversion apparatus processes the packet in the second example. Finally, the private information header in the packet buffered in the buffer 602_1 is located at the specified position (for example, at the end of the Payload) of the<!-- EPO <DP n="9"> --> packet.</p>
<p id="p0063" num="0063">In the above first to third examples, the network device includes one switch chip. However, when the network device includes M switch chips and M is greater than 1, the processing manner of the network device is similar to the case that the network device includes one switch chip, which will be described below with a fourth example.</p>
<heading id="h0007">Example 4</heading>
<p id="p0064" num="0064">In the fourth example, the network device includes two switch chips. <figref idref="f0005">FIG. 7</figref> is a schematic diagram illustrating a structure of a network device according to the fourth example of the present disclosure. In the structural diagram of the network device shown in <figref idref="f0005">FIG 7</figref>, the network device may include a switch chip 701a, a switch chip 701b, a CPU 702 and a conversion apparatus 703.</p>
<p id="p0065" num="0065">In the fourth example, the structures of the switch chip 701a and the switch chip 701b are similar, and both the switch chip 701a and the switch chip 701b include a CPU interface and a peripheral interface. A CPU interface on the switch chip 701a is denoted as a CPU interface 701_a1, and a CPU interface on the switch chip 701b is denoted as a CPU interface 701_b1.</p>
<p id="p0066" num="0066">As shown in <figref idref="f0005">FIG. 7</figref>, the CPU 702 at least includes a media access controller 702_1, a buffer 702_2, a memory 702_3, a CPU core 702_4 and a diversion module 702_5.</p>
<p id="p0067" num="0067">In the fourth example, the conversion apparatus 703 is connected between the switch chip and the CPU. As shown in <figref idref="f0005">FIG. 7</figref>, the CPU interface 701_a1 of the switch chip 701a is connected with an interface (denoted as Port 703_1) at one end of the conversion apparatus 703, and an interface (denoted as Port 703 2) at the other end of the conversion apparatus 703 is connected with the media access controller 702_1 of the CPU 702. The CPU interface 701_b1 of the switch chip 701b is connected with an interface (denoted as Port 703_3) at one end of the conversion apparatus 703, and an interface (denoted as Port 703_4) at the other end of the conversion apparatus 703 is connected with the media access controller 702_1 of the CPU 702.</p>
<p id="p0068" num="0068">As shown in <figref idref="f0005">FIG. 7</figref>, when receiving a packet from the switch chip 701a through the interface Port 703_1, the conversion apparatus 703 identifies a private information header from an Ethernet header of the packet in a locally recorded manner corresponding to the interface Port 703_1 in which the private information header is identified, and then processes the packet in the manner in which the conversion apparatus processes the packet in the first example. Finally, the private information header of the packet that is from the switch chip 701a and buffered in the buffer 702_2 on the CPU 702 is located at the specified position (a position that is other than the Ethernet header and does not affect packet identification, for<!-- EPO <DP n="10"> --> example, a position at the end of the Payload) of the packet. The conversion apparatus 703 processes the packets received from the switch chip 701b through the interface Port703_2 in a similar manner.</p>
<p id="p0069" num="0069">It can be seen that, in the fourth example, no matter how many switch chips are included in the network device, the conversion apparatus 203 will finally migrate, in a unified way, the private information header of the packet from each switch chip to the specified position in the packet that is other than the Ethernet header and does not affect packet identification. In this case, even if the packet carries the private information header, the identification and normal diversion of the packets by the CPU (specifically, the diversion module 302_5) are not affected since the private information header is located at the position that is in the packet and does not affect packet identification.</p>
<p id="p0070" num="0070">Thus, descriptions of the fourth example are completed.</p>
<p id="p0071" num="0071">It is to be noted that the conversion apparatus 703 is connected between the switch chip and the CPU in the fourth example. The position of the conversion apparatus may also be as shown in the example 2 or 3 and thus will not be limited herein.</p>
<p id="p0072" num="0072">The present disclosure is described as above. A conversion apparatus according to the present disclosure is described below.</p>
<p id="p0073" num="0073"><figref idref="f0006">FIG. 8</figref> is a schematic diagram illustrating a structure of a conversion apparatus according to an example of the present disclosure. The conversion apparatus (denoted as 800) shown in <figref idref="f0006">FIG 8</figref> may be applied to a network device. The network device herein may include a switch chip 801 and a CPU 802. As shown in <figref idref="f0006">FIG. 8</figref>, the conversion apparatus 800 is connected between the switch chip 801 and the CPU 802.</p>
<p id="p0074" num="0074">As shown in <figref idref="f0006">FIG. 8</figref>, the conversion apparatus 800 may include:
<ul id="ul0002" list-style="none" compact="compact">
<li>a first receiving unit 800_1, configured to receive a first packet, where the first packet is a packet uploaded by the switch chip 801 to the CPU 802; and</li>
<li>a first processing unit 800_2, configured to obtain a second packet by migrating a private information header in an Ethernet header of the first packet to a specified position of the first packet, calculate a Cyclic Redundancy Check (CRC) code of the second packet, obtain a third packet by replacing a CRC code carried in the second packet with the calculated CRC code, and send the third packet to the CPU, where the specified position is a position other than the Ethernet header in the first packet.</li>
</ul></p>
<p id="p0075" num="0075">In an example, the first processing unit 800_2 migrates the private information header in the Ethernet header of the first packet to the specified position of the first packet, including:
<ul id="ul0003" list-style="none" compact="compact">
<li>identifying the private information header from the Ethernet header of the first packet in<!-- EPO <DP n="11"> --> a locally recorded manner in which the private information header is identified; and</li>
<li>migrating the private information header from the Ethernet header of the first packet to the specified position of the first packet.</li>
<li>In an example, the specified position is the last N bytes in Ethernet Payload of the packet, and the N refers to the number of bytes occupied by the private information header.</li>
</ul></p>
<p id="p0076" num="0076">Thus, descriptions of the structural diagram of the conversion apparatus shown in <figref idref="f0006">FIG. 8</figref> are completed.</p>
<p id="p0077" num="0077"><figref idref="f0006">FIG. 9</figref> is a schematic diagram illustrating a structure of another conversion apparatus according to an example of the present disclosure. The conversion apparatus (denoted as 900) shown in <figref idref="f0006">FIG 9</figref> may be applied to a network device. The network device herein may include a switch chip 901 and a CPU 902. The switch chip 901 at least includes a CPU interface 901_1, and the CPU 902 at least includes a media access controller 902_1 and a buffer 902_2.</p>
<p id="p0078" num="0078">As shown in <figref idref="f0006">FIG. 9</figref>, the conversion apparatus 900 is connected between the media access controller 902_1 and the buffer 902_2.</p>
<p id="p0079" num="0079">As shown in <figref idref="f0006">FIG. 9</figref>, the conversion apparatus 900 may include:
<ul id="ul0004" list-style="none" compact="compact">
<li>a second receiving unit 900_1, configured to receive a first packet, where the first packet is a packet that is uploaded by the switch chip 901 to the CPU 902 through the CPU interface 901_1 and processed through the media access controller 902_1; and</li>
<li>a second processing unit 900_2, configured to obtain a second packet by migrating a private information header in an Ethernet header of the first packet to a specified position of the first packet, calculate a Cyclic Redundancy Check (CRC) code of the second packet, obtain a third packet by replacing a CRC code carried in the second packet with the calculated CRC code, and send the third packet to the buffer for buffering, where the specified position is a position other than the Ethernet header.</li>
</ul></p>
<p id="p0080" num="0080">In an example, the second processing unit 900_2 migrates the private information header in the Ethernet header of the first packet to the specified position of the first packet, including:
<ul id="ul0005" list-style="none" compact="compact">
<li>identifying the private information header from the Ethernet header of the first packet in a locally recorded manner in which the private information header is identified; and</li>
<li>migrating the private information header from the Ethernet header of the first packet to the specified position of the first packet.</li>
</ul></p>
<p id="p0081" num="0081">In an example, the specified position is the last N bytes in the Ethernet Payload of the packet, and the N refers to the number of bytes occupied by the private information header.</p>
<p id="p0082" num="0082">Thus, descriptions of the structural diagram of the conversion apparatus shown in <figref idref="f0006">FIG. 9</figref> are completed.<!-- EPO <DP n="12"> --></p>
<p id="p0083" num="0083">The foregoing descriptions are only preferred examples of the present disclosure but not intended to limit the present disclosure. Any modifications, equivalent substitutions, improvements and the like made within the spirit and principles of the present disclosure shall be encompassed in the scope of protection of the present disclosure.</p>
</description>
<claims id="claims01" lang="en"><!-- EPO <DP n="13"> -->
<claim id="c-en-0001" num="0001">
<claim-text>A network device, comprising:
<claim-text>a switch chip and</claim-text>
<claim-text>a Central Processing Unit, CPU,</claim-text>
<claim-text>wherein the switch chip at least comprises a CPU interface, and the CPU at least comprises a media access controller and a Buffer; and</claim-text>
<claim-text><b>characterized in that</b> the network device further comprises a conversion apparatus,</claim-text>
<claim-text>wherein the conversion apparatus is configured to:
<claim-text>receive a first packet uploaded by the switch chip to the CPU through the CPU interface,</claim-text>
<claim-text>obtain a second packet by migrating a private information header in an Ethernet header of the first packet to a specified position of the first packet,</claim-text>
<claim-text>calculate a Cyclic Redundancy Check, CRC, code of the second packet,</claim-text>
<claim-text>obtain a third packet by replacing a CRC code already carried in the second packet with the calculated CRC code, and</claim-text>
<claim-text>send the third packet to the Buffer on the CPU for buffering,</claim-text>
<claim-text>wherein the specified position is a position other than the Ethernet header in the first packet.</claim-text></claim-text></claim-text></claim>
<claim id="c-en-0002" num="0002">
<claim-text>The device according to claim 1, wherein the conversion apparatus is connected between the CPU interface and the media access controller;<br/>
wherein sending the third packet to the Buffer on the CPU for buffering comprises:<br/>
sending the third packet to the media access controller, so that the media access controller processes the third packet and stores the processed third packet in the Buffer.</claim-text></claim>
<claim id="c-en-0003" num="0003">
<claim-text>The device according to claim 1, wherein the conversion apparatus is connected between the media access controller and the Buffer;<br/>
the first packet is a packet that is uploaded by the switch chip to the CPU through the CPU interface and processed by the media access controller.</claim-text></claim>
<claim id="c-en-0004" num="0004">
<claim-text>The device according to any one of claims 1-3, wherein the conversion apparatus and the media access controller are integrated in a same module.</claim-text></claim>
<claim id="c-en-0005" num="0005">
<claim-text>The device according to claim 1, wherein the conversion apparatus migrates the private<!-- EPO <DP n="14"> --> information header in the Ethernet header of the first packet to the specified position of the first packet, comprising:
<claim-text>identifying the private information header from the Ethernet header of the first packet in a locally recorded manner in which the private information header is identified; and</claim-text>
<claim-text>migrating the private information header from the Ethernet header of the first packet to the specified position of the first packet.</claim-text></claim-text></claim>
<claim id="c-en-0006" num="0006">
<claim-text>The device according to claim 5, wherein the manner in which the private information header is identified is pre-configured in the conversion apparatus; or<br/>
the manner in which the private information header is identified is determined by the conversion apparatus according to a chip identifier of the switch chip.</claim-text></claim>
<claim id="c-en-0007" num="0007">
<claim-text>The device according to claim 1, wherein the specified position is the last N bytes in an Ethernet Payload of the packet; and<br/>
N refers to the number of bytes occupied by the private information header.</claim-text></claim>
<claim id="c-en-0008" num="0008">
<claim-text>The device according to any one of claims 1-7, wherein the CPU further comprises a memory and a CPU core;
<claim-text>the memory is configured to store instruction codes, and</claim-text>
<claim-text>the CPU core is configured to read and run the instruction codes from the memory when obtaining information in the private information header, so as to obtain the information in the private information header from the specified position of the third packet.</claim-text></claim-text></claim>
<claim id="c-en-0009" num="0009">
<claim-text>A conversion apparatus, <b>characterized in that</b> the conversion apparatus is applied to a network device which comprises a switch chip and a CPU,
<claim-text>the conversion apparatus is connected between the switch chip and the CPU, and</claim-text>
<claim-text>the conversion apparatus is configured to:
<claim-text>receive a first packet, wherein the first packet is a packet uploaded by the switch chip to the CPU; and</claim-text>
<claim-text>obtain a second packet by migrating a private information header in an Ethernet header of the first packet to a specified position of the first packet,</claim-text>
<claim-text>calculate a Cyclic Redundancy Check, CRC, code of the second packet,</claim-text>
<claim-text>obtain a third packet by replacing a CRC code already carried in the second packet with the calculated CRC code, and<!-- EPO <DP n="15"> --></claim-text>
<claim-text>send the third packet to the CPU,</claim-text>
<claim-text>wherein the specified position is a position other than the Ethernet header in the first packet.</claim-text></claim-text></claim-text></claim>
<claim id="c-en-0010" num="0010">
<claim-text>The apparatus according to claim 9, wherein, migrating the private information header in the Ethernet header of the first packet to the specified position of the first packet comprises:
<claim-text>identifying the private information header from the Ethernet header of the first packet in a locally recorded manner in which the private information header is identified; and</claim-text>
<claim-text>migrating the private information header from the Ethernet header of the first packet to the specified position of the first packet.</claim-text></claim-text></claim>
<claim id="c-en-0011" num="0011">
<claim-text>A conversion apparatus, <b>characterized in that</b> the conversion apparatus is applied to a network device which comprises a switch chip and a CPU,
<claim-text>the switch chip at least comprises a CPU interface, and</claim-text>
<claim-text>the CPU at least comprises a media access controller and a Buffer;</claim-text>
<claim-text>the conversion apparatus is connected between the media access controller and the Buffer; and</claim-text>
<claim-text>the conversion apparatus is configured to:
<claim-text>receive a first packet, wherein the first packet is a packet that is uploaded by the switch chip to the CPU through the CPU interface and processed by the media access controller; and</claim-text>
<claim-text>obtain a second packet by migrating a private information header in an Ethernet header of the first packet to a specified position of the first packet,</claim-text>
<claim-text>calculate a Cyclic Redundancy Check, CRC, code of the second packet,</claim-text>
<claim-text>obtain a third packet by replacing a CRC code already carried in the second packet with the calculated CRC code, and</claim-text>
<claim-text>send the third packet to the Buffer for buffering,</claim-text>
<claim-text>wherein the specified position is a position other than the Ethernet header in the first packet.</claim-text></claim-text></claim-text></claim>
<claim id="c-en-0012" num="0012">
<claim-text>The apparatus according to claim 11, wherein, migrating the private information header in the Ethernet header of the first packet to the specified position of the first packet comprises:
<claim-text>identifying the private information header from the Ethernet header of the first packet in a<!-- EPO <DP n="16"> --> locally recorded manner in which the private information header is identified; and</claim-text>
<claim-text>migrating the private information header from the Ethernet header of the first packet to the specified position of the first packet.</claim-text></claim-text></claim>
</claims>
<drawings id="draw" lang="en"><!-- EPO <DP n="17"> -->
<figure id="f0001" num="1,2"><img id="if0001" file="imgf0001.tif" wi="157" he="181" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="18"> -->
<figure id="f0002" num="3,4"><img id="if0002" file="imgf0002.tif" wi="155" he="204" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="19"> -->
<figure id="f0003" num="5"><img id="if0003" file="imgf0003.tif" wi="132" he="156" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="20"> -->
<figure id="f0004" num="6"><img id="if0004" file="imgf0004.tif" wi="132" he="145" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="21"> -->
<figure id="f0005" num="7"><img id="if0005" file="imgf0005.tif" wi="151" he="155" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="22"> -->
<figure id="f0006" num="8,9"><img id="if0006" file="imgf0006.tif" wi="72" he="233" img-content="drawing" img-format="tif"/></figure>
</drawings>
<search-report-data id="srep" lang="en" srep-office="EP" date-produced=""><doc-page id="srep0001" file="srep0001.tif" wi="156" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="156" he="233" type="tif"/></search-report-data>
</ep-patent-document>
