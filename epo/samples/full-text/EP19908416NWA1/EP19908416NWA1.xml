<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE ep-patent-document PUBLIC "-//EPO//EP PATENT DOCUMENT 1.5.1//EN" "ep-patent-document-v1-5-1.dtd">
<!-- This XML data has been generated under the supervision of the European Patent Office -->
<ep-patent-document id="EP19908416A1" file="EP19908416NWA1.xml" lang="en" country="EP" doc-number="3890262" kind="A1" date-publ="20211006" status="n" dtd-version="ep-patent-document-v1-5-1">
<SDOBI lang="en"><B000><eptags><B001EP>ATBECHDEDKESFRGBGRITLILUNLSEMCPTIESILTLVFIROMKCYALTRBGCZEEHUPLSKBAHRIS..MTNORSMESMMAKHTNMD..........</B001EP><B005EP>J</B005EP><B007EP>BDM Ver 2.0.12 (4th of August) -  1100000/0</B007EP></eptags></B000><B100><B110>3890262</B110><B120><B121>EUROPEAN PATENT APPLICATION</B121><B121EP>published in accordance with Art. 153(4) EPC</B121EP></B120><B130>A1</B130><B140><date>20211006</date></B140><B190>EP</B190></B100><B200><B210>19908416.1</B210><B220><date>20190107</date></B220><B240><B241><date>20210628</date></B241></B240><B250>zh</B250><B251EP>en</B251EP><B260>en</B260></B200><B400><B405><date>20211006</date><bnum>202140</bnum></B405><B430><date>20211006</date><bnum>202140</bnum></B430></B400><B500><B510EP><classification-ipcr sequence="1"><text>H04L  29/06        20060101AFI20200717BHEP        </text></classification-ipcr><classification-ipcr sequence="2"><text>H04L  12/70        20130101ALI20200717BHEP        </text></classification-ipcr></B510EP><B520EP><classifications-cpc><classification-cpc sequence="1"><text>H04L  29/06        20130101 LI20200807BCEP        </text></classification-cpc></classifications-cpc></B520EP><B540><B541>de</B541><B542>ROUTING-VERTEILUNGSVERFAHREN, -VORRICHTUNG UND -SYSTEM</B542><B541>en</B541><B542>ROUTING DISTRIBUTING METHOD, DEVICE AND SYSTEM</B542><B541>fr</B541><B542>PROCÉDÉ, DISPOSITIF ET SYSTÈME DE DISTRIBUTION DE ROUTAGE</B542></B540><B590><B598>2</B598></B590></B500><B700><B710><B711><snm>Huawei Technologies Co., Ltd.</snm><iid>101903059</iid><irf>SAH12658EP</irf><adr><str>Huawei Administration Building, 
Bantian, Longgang District</str><city>Shenzhen Guangdong 518129</city><ctry>CN</ctry></adr></B711></B710><B720><B721><snm>ZHAO, Jingjing</snm><adr><str>Huawei Administration Building, Bantian, Longgang 
District</str><city>Shenzhen, Guangdong 518129</city><ctry>CN</ctry></adr></B721></B720><B740><B741><snm>Gill Jennings &amp; Every LLP</snm><iid>101574570</iid><adr><str>The Broadgate Tower 
20 Primrose Street</str><city>London EC2A 2ES</city><ctry>GB</ctry></adr></B741></B740></B700><B800><B840><ctry>AL</ctry><ctry>AT</ctry><ctry>BE</ctry><ctry>BG</ctry><ctry>CH</ctry><ctry>CY</ctry><ctry>CZ</ctry><ctry>DE</ctry><ctry>DK</ctry><ctry>EE</ctry><ctry>ES</ctry><ctry>FI</ctry><ctry>FR</ctry><ctry>GB</ctry><ctry>GR</ctry><ctry>HR</ctry><ctry>HU</ctry><ctry>IE</ctry><ctry>IS</ctry><ctry>IT</ctry><ctry>LI</ctry><ctry>LT</ctry><ctry>LU</ctry><ctry>LV</ctry><ctry>MC</ctry><ctry>MK</ctry><ctry>MT</ctry><ctry>NL</ctry><ctry>NO</ctry><ctry>PL</ctry><ctry>PT</ctry><ctry>RO</ctry><ctry>RS</ctry><ctry>SE</ctry><ctry>SI</ctry><ctry>SK</ctry><ctry>SM</ctry><ctry>TR</ctry></B840><B844EP><B845EP><ctry>BA</ctry></B845EP><B845EP><ctry>ME</ctry></B845EP></B844EP><B848EP><B849EP><ctry>KH</ctry></B849EP><B849EP><ctry>MA</ctry></B849EP><B849EP><ctry>MD</ctry></B849EP><B849EP><ctry>TN</ctry></B849EP></B848EP><B860><B861><dnum><anum>CN2019070691</anum></dnum><date>20190107</date></B861><B862>zh</B862></B860><B870><B871><dnum><pnum>WO2020142875</pnum></dnum><date>20200716</date><bnum>202029</bnum></B871></B870></B800></SDOBI>
<abstract id="abst" lang="en">
<p id="pa01" num="0001">This application provides a route advertisement method, applied to a network in which a cross-domain end-to-end tunnel carries a service. The cross-domain end-to-end tunnel crosses at least two interior gateway protocol IGP network domains, and the at least two IGP network domains include a first network device, a second network device, and a third network device. The method includes: receiving, by the first network device, border gateway protocol BGP service routing information from the second network device, where the BGP service routing information includes a destination address and a next-hop address to the destination address; skipping, by the first network device, performing route recursion on the next-hop address; and advertising, by the first network device, the BGP service routing information to the third network device. This facilitates service creation.<img id="iaf01" file="imgaf001.tif" wi="78" he="108" img-content="drawing" img-format="tif"/></p>
</abstract>
<description id="desc" lang="en"><!-- EPO <DP n="1"> -->
<heading id="h0001"><b>TECHNICAL FIELD</b></heading>
<p id="p0001" num="0001">This application relates to the communications field, and in particular, to a route advertisement method, a device, and a system.</p>
<heading id="h0002"><b>BACKGROUND</b></heading>
<p id="p0002" num="0002">With the continuous evolution of network technologies, it is possible to build an end-to-end tunnel across a plurality of network domains. For example, in a software-defined networking (Software Defined Networking, SDN) architecture based on an idea of control and forwarding separation, a centralized control and management device (for example, an SDN controller) may collect and manage network topologies of a plurality of interior gateway protocol (English: Interior Gateway Protocol, IGP) network domains in a centralized manner, and compute an end-to-end tunnel across a plurality of IGP network domains. Various services may be carried on the end-to-end tunnel. For example, a virtual private network (Virtual Private Network, VPN) service may be carried on an end-to-end segment routing-traffic engineering (Segment Routing-Traffic Engineering, SR-TE) tunnel. For another example, a service that supports the internet protocol version 6 (English: Internet Protocol version 6, IPv6) may be carried on an end-to-end tunnel that supports the internet protocol version 4 (English: Internet Protocol version 4, IPv4), to implement an IPv6 network over an IPv4 network (that is, IPv6 over IPv4).</p>
<p id="p0003" num="0003">However, in a scenario in which a service is carried on the end-to-end tunnel, when service routing information (for example, VPN routing information or IPv6 routing information) is advertised according to the border gateway protocol (Border Gateway Protocol, BGP), a problem that a service cannot be created exists.</p>
<heading id="h0003"><b>SUMMARY</b></heading>
<p id="p0004" num="0004">Embodiments of the present invention provide a route advertisement method, a device, and a system, to resolve a problem that a service cannot be created when BGP service routing information is advertised in a scenario in which a service is carried on a cross-domain end-to-end tunnel.</p>
<p id="p0005" num="0005">According to a first aspect, an embodiment of this application provides a route advertisement method. The method is applied to a network in which a cross-domain end-to-end tunnel carries a service, the cross-domain<!-- EPO <DP n="2"> --> end-to-end tunnel crosses at least two interior gateway protocol IGP network domains, and the at least two IGP network domains include a first network device, a second network device, and a third network device. According to the method, the first network device receives border gateway protocol BGP service routing information from the second network device, where the BGP service routing information includes a destination address and a next-hop address to the destination address; the first network device does not perform route recursion on the next-hop address before advertising the BGP service routing information to the third network device; and the first network device sends the BGP service routing information to the third network device.</p>
<p id="p0006" num="0006">After receiving the BGP service routing information from an upstream network device, a non-border network device (the first network device) in the cross-domain network does not perform route recursion on the next-hop address before continuing to advertise the BGP service routing information to a downstream network device. This facilitates service creation.</p>
<p id="p0007" num="0007">In a possible design, before the first network device receives BGP service routing information from the second network device, the method further includes: the first network device obtains first policy information, where the first policy information indicates the first network device not to perform route recursion.</p>
<p id="p0008" num="0008">A function (or a capability) of enabling (or activating), based on a user requirement, the network device not to perform route recursion is provided by using the first policy information. This helps manage or use a network on demand, and improve flexibility of network management.</p>
<p id="p0009" num="0009">In a possible design, that the first network device does not perform route recursion on the next-hop address includes: the first network device does not perform route recursion on the next-hop address according to the indication of the first policy information.</p>
<p id="p0010" num="0010">The network device determines, according to the indication of the first policy information, not to perform route recursion. This helps manage a network on demand, and improve flexibility of network management.</p>
<p id="p0011" num="0011">In a possible design, the first policy information further includes specified address information, the specified address information indicates an address set, and correspondingly, the first policy information indicates the first network device not to perform route recursion on the BGP service routing information whose destination address is in the address set.</p>
<p id="p0012" num="0012">The first policy information includes the specified address information, so that route recursion may not be performed on a BGP route within a specific address range, thereby enriching technique implementation means and improving flexibility of use.</p>
<p id="p0013" num="0013">In a possible design, that the first network device does not perform route recursion on the next-hop address includes: when the first network device determines that the destination address is in the address set, the first<!-- EPO <DP n="3"> --> network device does not perform route recursion on the next-hop address according to the indication of the first policy information.</p>
<p id="p0014" num="0014">The network device determines, according to the indication of the first policy information, not to perform route recursion on the next-hop address that satisfies a requirement. This helps manage a network on demand, and improve flexibility of network management.</p>
<p id="p0015" num="0015">In a possible design, that the first network device obtains the first policy information includes at least one of the following manners: the first network device obtains the first policy information according to a command line configuration; the first network device receives a first message from a control and management device, where the first message includes the first policy information; and the first network device runs algorithm software to automatically generate the first policy information.</p>
<p id="p0016" num="0016">A plurality of manners of obtaining the first policy information are provided, so that technique implementation means are enriched, and usability is improved.</p>
<p id="p0017" num="0017">In a possible design, the method further includes: when advertising the BGP service routing information to the third network device, the first network device does not change the next-hop address in the BGP service routing information.</p>
<p id="p0018" num="0018">The next-hop address in the BGP service routing information is not changed, so that service creation reliability is improved.</p>
<p id="p0019" num="0019">In a possible design, before the first network device advertises the BGP service routing information to the third network device, the method further includes: the first network device obtains second policy information, where the second policy information indicates the first network device not to change the next-hop address in the BGP service routing information when the first network device advertises the BGP service routing information to the third network device.</p>
<p id="p0020" num="0020">A function (or a capability) of enabling (or activating), based on a user requirement, the network device not to change the next-hop address in the BGP service routing information is provided by using the second policy information. This helps manage or use a network on demand, and improve flexibility of network management.</p>
<p id="p0021" num="0021">In a possible design, that the first network device does not change the next-hop address in the BGP service routing information when advertising the BGP service routing information to the third network device includes: when the first network device advertises the BGP service routing information to the third network device, the first network device does not change the next-hop address in the BGP service routing information according to the second policy information.</p>
<p id="p0022" num="0022">The network device determines, according to the indication of the second policy information, not to<!-- EPO <DP n="4"> --> change the next-hop address in the BGP service routing information. This helps manage a network on demand, and improve flexibility of network management.</p>
<p id="p0023" num="0023">In a possible design, that the first network device obtains the second policy information includes at least one of the following manners: the first network device obtains the second policy information according to a command line configuration; the first network device receives a second message from a control and management device, where the second message includes the second policy information; and the first network device runs algorithm software to automatically generate the second policy information.</p>
<p id="p0024" num="0024">A plurality of manners of obtaining the second policy information are provided, so that technique implementation means are enriched, and usability is improved.</p>
<p id="p0025" num="0025">In a possible design, the BGP service routing information includes BGP VPN routing information, BGP IPv6 routing information, or IPv4 routing information.</p>
<p id="p0026" num="0026">By using BGP routing information to carry VPN routing information, IPv6 routing information, or IPv4 routing information, a VPN service, an IPv4 over IPv6 service, or an IPv6 over IPv4 service can be carried on the cross-domain end-to-end tunnel.</p>
<p id="p0027" num="0027">According to a second aspect, an embodiment of this application provides a route advertisement method, applied to a network in which a cross-domain end-to-end tunnel carries a service. The cross-domain end-to-end tunnel crosses at least two interior gateway protocol IGP network domains, and the at least two IGP network domains include a first network device, a second network device, and a third network device. According to the method, a control and management device sends a first message to the first network device, where the first message includes first policy information, and the first policy information indicates the first network device not to perform route recursion.</p>
<p id="p0028" num="0028">A function (or a capability) of enabling (or activating), based on a user requirement, the network device not to perform route recursion is provided by using the first policy information. This helps manage or use a network on demand, and improve flexibility of network management.</p>
<p id="p0029" num="0029">In a possible design, the first policy information further includes specified address information, the specified address information indicates an address set, and correspondingly, the first policy information indicates the first network device not to perform route recursion on BGP service routing information whose destination address is in the address set.</p>
<p id="p0030" num="0030">The network device determines, according to the indication of the first policy information, not to perform route recursion on a next-hop address that satisfies a requirement. This helps manage a network on demand, and improve flexibility of network management.</p>
<p id="p0031" num="0031">In a possible design, the control and management device sends a second message to the first network<!-- EPO <DP n="5"> --> device, where the second message includes second policy information, and the second policy information indicates the first network device not to change the next-hop address in the BGP service routing information when the first network device advertises the BGP service routing information to the third network device.</p>
<p id="p0032" num="0032">A function (or a capability) of enabling (or activating), based on a user requirement, the network device not to change the next-hop address in the BGP service routing information is provided by using the second policy information. This helps manage or use a network on demand, and improve flexibility of network management.</p>
<p id="p0033" num="0033">In a possible design, the BGP service routing information includes BGP VPN routing information, BGP IPv6 routing information, or IPv4 routing information.</p>
<p id="p0034" num="0034">By using BGP routing information to carry VPN routing information, IPv6 routing information, or IPv4 routing information, a VPN service, an IPv4 over IPv6 service, or an IPv6 over IPv4 service can be carried on the cross-domain end-to-end tunnel.</p>
<p id="p0035" num="0035">According to a third aspect, an embodiment of this application provides a network device, used as a first network device. The first network device includes a memory and a processor connected to the memory. The processor is configured to execute a computer-readable instruction in the memory, to perform the method in any one of the first aspect or the possible implementations of the first aspect.</p>
<p id="p0036" num="0036">According to a fourth aspect, the present invention provides a computer-readable medium, including an instruction. When the instruction is run on a computer, the computer is enabled to perform the method in any one of the first aspect or the possible implementations of the first aspect.</p>
<p id="p0037" num="0037">According to a fifth aspect, an embodiment of this application provides a control and management device. The control and management device includes a memory and a processor connected to the memory. The processor is configured to execute a computer-readable instruction in the memory, to perform the method in any one of the second aspect or the possible implementations of the second aspect.</p>
<p id="p0038" num="0038">According to a sixth aspect, the present invention provides a computer-readable medium, including an instruction. When the instruction is run on a computer, the computer is enabled to perform the method in any one of the second aspect or the possible implementations of the second aspect.</p>
<p id="p0039" num="0039">According to a seventh aspect, the present invention provides a system. The system includes the first network device according to the third aspect or the fourth aspect and the control and management device according to the fifth aspect or the sixth aspect.<!-- EPO <DP n="6"> --></p>
<heading id="h0004"><b>BRIEF DESCRIPTION OF DRAWINGS</b></heading>
<p id="p0040" num="0040">To describe the technical solutions in the embodiments of this application or in the prior art more clearly, the following briefly introduces the accompanying drawings for describing the embodiments or the prior art. It is clear that the accompanying drawings in the following description show merely some embodiments recorded in this application, and a person of ordinary skill in the art may still derive other drawings from these accompanying drawings.
<ul id="ul0001" list-style="none" compact="compact">
<li><figref idref="f0001">FIG. 1</figref> is a schematic diagram of an application scenario in which an end-to-end tunnel carries a service according to an embodiment of this application;</li>
<li><figref idref="f0002">FIG. 2</figref> is an interaction flowchart of a route advertisement method according to an embodiment of this application;</li>
<li><figref idref="f0003">FIG. 3a</figref> is a schematic diagram of an application scenario in which an end-to-end tunnel carries a VPN service according to an embodiment of this application;</li>
<li><figref idref="f0004">FIG. 3b</figref> is a schematic diagram of another application scenario in which an end-to-end tunnel carries a VPN service according to an embodiment of this application;</li>
<li><figref idref="f0005">FIG. 3c</figref> is a schematic diagram of an application scenario in which an end-to-end tunnel carries an IPv6 service according to an embodiment of this application;</li>
<li><figref idref="f0006">FIG. 4</figref> is a schematic diagram of a network device 400 according to an embodiment of this application;</li>
<li><figref idref="f0006">FIG. 5</figref> is a schematic diagram of a control and management device 500 according to an embodiment of this application; and</li>
<li><figref idref="f0007">FIG. 6</figref> is a schematic diagram of a system 600 according to an embodiment of this application.</li>
</ul></p>
<heading id="h0005"><b>DESCRIPTION OF EMBODIMENTS</b></heading>
<p id="p0041" num="0041">In order to enable a person skilled in the art to better understand the solutions in the present invention, the following describes the embodiments of the present invention in more detail with reference to accompanying drawings and implementations. It is clear that the described embodiments are some rather than all of the embodiments of the present invention. All other embodiments obtained by a person of ordinary skill in the art based on the embodiments of the present invention without creative efforts shall fall within the protection scope of the present invention.</p>
<p id="p0042" num="0042">Before the technical solutions of the embodiments of the present invention are described, an application scenario of the embodiments of the present invention is first illustrated. The present invention is applied to a network in which a cross-domain end-to-end tunnel carries a service. The cross-domain end-to-end tunnel is a tunnel that<!-- EPO <DP n="7"> --> crosses at least two IGP network domains. The cross-domain end-to-end tunnel is a complete tunnel instead of a segmented tunnel formed by splicing a plurality of tunnels in separate network domains (a tunnel in a single network domain is a tunnel that crosses only one network domain). The cross-domain end-to-end tunnel is a tunnel including two end nodes and at least one intermediate node, and a node may also be referred to as a network device. The cross-domain end-to-end tunnel may be a bidirectional tunnel between the two end nodes, or may be a bidirectional tunnel including two unidirectional tunnels in opposite directions. For example, a unidirectional tunnel 1 from an end node A to an end node B and a unidirectional tunnel 2 from the end node B to the end node A form a bidirectional tunnel between the end node A and the end node B. The IGP network domain is a network on which routing information is exchanged according to IGP, and is also referred to as an IGP domain. A network including the at least two IGP network domains is also referred to as a cross-domain network. Usually, one autonomous system (Autonomous System, AS) is one IGP network domain. However, sometimes, one AS has a relatively large scale, and because performance of a network device is insufficient to support route calculation in such a large-scale network, or to facilitate maintenance and management, an operator divides the AS into a plurality of IGP network domains, to adapt to the performance of the network device or satisfy a management requirement.</p>
<p id="p0043" num="0043">It should be noted that the cross-domain end-to-end tunnel may be in a form of an SR-TE tunnel, a segment routing-best effort (Segment Routing-Best Effort, SR-BE) tunnel, a resource reservation protocol-traffic engineering (Resource Reservation Protocol-Traffic Engineering, RSVP-TE) tunnel, a multi-protocol label switching (Multi-Protocol Label Switching, MPLS) label switched path (Label Switched Path, LSP) tunnel, a generic routing encapsulation (Generic Routing Encapsulation, GRE) tunnel, an IPv4 tunnel (for example, in an IPv6 over IPv4 scenario), an IPv6 tunnel (for example, in an IPv4 over IPv6 scenario), or the like. Only an example is provided herein, and this is not limited. In addition, the end-to-end tunnel may be established by using a centralized control and management device, or may be established in another manner.</p>
<p id="p0044" num="0044">The cross-domain network includes a plurality of network devices. The network device is a device that performs a routing and forwarding function, and may be a device such as a router, a switch, or a forwarder. The router, the switch, or the forwarder may be a physical device, or may be a virtual device (such as a virtual server, a virtual router, a virtual switch, or a virtual forwarder) implemented based on a virtualization technology. In the cross-domain network, a network device connected to a device in a service network (for example, a service network 1 and a service network 2 shown in <figref idref="f0001">FIG. 1</figref> in the following) is also referred to as a border network device, and a network device not connected to a device in the service network is also referred to as a non-border network device.</p>
<p id="p0045" num="0045"><figref idref="f0001">FIG. 1</figref> is a schematic diagram of an application scenario in which a cross-domain end-to-end tunnel carries a service. The schematic diagram includes three IGP network domains: an IGP domain 1, an IGP domain 2,<!-- EPO <DP n="8"> --> and an IGP domain 3. The IGP domain 1 includes a network device 1 and a network device 2, the IGP domain 2 includes the network device 2 and a network device 3, and the IGP domain 3 includes the network device 3 and a network device 4. The network device 2 is connected to the IGP domain 1 and the IGP domain 2, and the network device 3 is connected to the IGP domain 2 and the IGP domain 3. A control and management device performs centralized control, and establishes an end-to-end tunnel crossing the three IGP domains between the network device 1 and the network device 4. A service between a service network 1 and a service network 2 may be carried on the end-to-end tunnel. The end-to-end tunnel is also referred to as a public network tunnel or an outer tunnel. BGP peers are respectively established between the network device 1 and the network device 2, between the network device 2 and the network device 3, and between the network device 3 and the network device 4, and BGP service routing information is advertised between the BGP peers through a BGP update (English: Update) message, to implement service creation. In a direction in which the network device 1 advertises a BGP service route to the network device 4, a previous node is referred to as an upstream node of a following node, and the following node is referred to as a downstream node of the previous node. For example, the network device 2 is a downstream node of the network device 1, and the network device 1 is an upstream node of the network device 2. The BGP service routing information includes a destination address and a next-hop address. For example, the destination address may be carried in a multiprotocol reachable NLRI (Multiprotocol Reachable NLRI, namely, MP _REACH_NLRI) attribute defined by BGP, and the next-hop address may be carried in a NEXT HOP (English: NEXT_HOP) attribute defined by BGP. For details about the MP_REACH_NLRI attribute and the NEXT_HOP attribute, refer to the request for comments (Request For Comments, RFC) 4271 released by the internet engineering task force (Internet Engineering Task Force, IETF). Content of this document and parts related to this aspect seem to be copied as a whole, and are incorporated by reference (incorporated by reference) into this specification. For a description of a contradiction or conflict that the document has with this application, a description of this application shall prevail. In this specification, for brevity, details are not described herein. The service may be a VPN service, an IPv6 service, or the like. If the service is the VPN service, the service network 1 and the service network 2 are two site (English: Site) networks of a VPN, and the service routing information is VPN routing information. In this case, the destination address is a private network address of the VPN, for example, may be a VPN-IPv4 address, a VPN-IPv6 address, or a media access control (Media Access Control, MAC) address in an Ethernet VPN (Ethernet VPN, EVPN). If the service is the IPv6 service, the service network 1 and the service network 2 are IPv6 networks, and the service routing information is IPv6 routing information. In this way, an IPv6 over IPv4 network is implemented. When the service routing information is the IPv6 routing information, the destination address is an IPv6 address. It should be noted that, if the destination address is an IP address (including an IPv4 address and an IPv6 address), the destination address is also referred to as an IP address<!-- EPO <DP n="9"> --> prefix or an IP prefix.</p>
<p id="p0046" num="0046">The embodiments of the present invention provide a method: In an application scenario in which a cross-domain end-to-end tunnel carries a service, after receiving BGP service routing information (including a destination address and a next-hop address to the destination address) from an upstream network device, before continuing to advertise the BGP service routing information to a downstream network device, a non-border network device in a cross-domain network does not perform route recursion on the next-hop address and does not change the next-hop address.</p>
<p id="p0047" num="0047">It should be noted that, route recursion refers to recursive route lookup (English: recursive route lookup), and is specifically an operation of performing recursive route lookup for an internet protocol (Internet Protocol, IP) address in a NEXT_HOP attribute. Recursive route lookup includes recursive IP lookup and recursive tunnel lookup. When a network device receives BGP routing information, if an IP address in a NEXT HOP attribute is a next-hop address that is not directly to the network device, recursive route lookup needs to be performed on IP addresses in the NEXT_HOP attribute to determine a direct (English: immediate or direct) next-hop address (that is, recursive IP lookup) or tunnel identifier (that is, recursive tunnel lookup), so as to determine whether a route to the IP address in the NEXT_HOP attribute is reachable.</p>
<p id="p0048" num="0048">The method in the embodiments of the present invention helps normally create a service in the network scenario in which a cross-domain end-to-end tunnel carries a service, thereby avoiding a problem that if route recursion fails when a network device performs route recursion on a next-hop address before the network device advertises BGP service routing information, advertisement (that is, distribution) of the BGP service routing information is terminated, and consequently, a service cannot be normally created.</p>
<p id="p0049" num="0049">The foregoing describes the application scenario of the embodiments of the present invention, and the following further describes the embodiments of the present invention in detail based on the application scenario in <figref idref="f0001">FIG. 1</figref>. The following first network device is a network device not connected to a device in a service network, that is, a non-border network device, in at least two IGP network domains in which a cross-domain end-to-end tunnel is located. For example, the first network device may be the network device 2 or the network device 3 in <figref idref="f0001">FIG. 1</figref>, a route reflector (Route Reflector, RR) 1 or an RR 2 in the following <figref idref="f0003">FIG. 3a</figref>, an autonomous system border router (Autonomous System Border Router, ASBR) 1, an ASBR 2, an ASBR 3, an ASBR 4, an ASBR 5, an ASBR 6, an ASBR 7, or an ASBR 8 in the following <figref idref="f0004">FIG. 3b</figref>, or a router 2, a router 3, or a router 4 in the following <figref idref="f0005">FIG. 3c</figref>.</p>
<p id="p0050" num="0050"><figref idref="f0002">FIG. 2</figref> is a schematic flowchart of a route advertisement method according to an embodiment of the present invention. The method includes the following content.</p>
<p id="p0051" num="0051">301. A control and management device generates a first message, where the first message includes first<!-- EPO <DP n="10"> --> policy information, and the first policy information indicates the first network device not to perform route recursion.</p>
<p id="p0052" num="0052">302. The control and management device sends the first message to the first network device.</p>
<p id="p0053" num="0053">303. The first network device receives the first message. The first network device obtains the first policy information from the first message and stores the first policy information.</p>
<p id="p0054" num="0054"><figref idref="f0001">FIG. 1</figref> is used as an example. A network device 1 receives BGP service routing information sent by a network device 5, where the BGP service routing information includes a destination address (for example, an IP address 50.1.1.1/32 in a service network 1) and a next-hop address (for example, an IP address of the network device 5). The network device 1 updates the next-hop address to an IP address of the network device 1 (for example, the IP address of the network device 1 is 10.1.1.1/32), and continues to send the BGP service routing information to a network device 2, a network device 3, and a network device 4 in sequence. When the first network device is the network device 2, a third network device is the network device 3, and the first policy information indicates the network device 2 not to perform route recursion on the next-hop address. Likewise, when the first network device is the network device 3, the third network device is the network device 4, and the first policy information indicates the network device 3 not to perform route recursion on the next-hop address.</p>
<p id="p0055" num="0055">A function (or a capability) of enabling (or activating), based on a user requirement, the network device not to perform route recursion is provided by using the first policy information. This helps manage or use a network on demand, and improve flexibility of network management.</p>
<p id="p0056" num="0056">In a specific implementation, the first policy information further includes specified address information, the specified address information indicates an address set, and correspondingly, the first policy information indicates the first network device not to perform route recursion on a next-hop address in BGP service routing information whose destination address is in the address set.</p>
<p id="p0057" num="0057"><figref idref="f0001">FIG. 1</figref> is used as an example. The destination address in the BGP service routing information is 50.1.1.1/32, and the next-hop address is the IP address of the network device 1, for example, 10.1.1.1/32. If the address set is {50.1.1.1/32, 60.1.1.1/32...}, the destination address is in the address set. Therefore, when the first network device is the network device 2, and the third network device is the network device 3, the first policy information indicates the network device 2 not to perform route recursion on the next-hop address in the BGP service routing information. Likewise, when the first network device is the network device 3, and the third network device is the network device 4, the first policy information indicates the network device 3 not to perform route recursion on the next-hop address in the BGP service routing information.</p>
<p id="p0058" num="0058">The first policy information includes the specified address information, so that route recursion may not be performed on a BGP route within a specific address range, thereby enriching technique implementation means and<!-- EPO <DP n="11"> --> improving flexibility of use.</p>
<p id="p0059" num="0059">304. The control and management device generates a second message, where the second message includes second policy information, and the second policy information indicates the first network device not to change the next-hop address in the BGP service routing information when the first network device advertises the BGP service routing information to the third network device.</p>
<p id="p0060" num="0060">305. The control and management device sends the second message to the first network device.</p>
<p id="p0061" num="0061">306. The first network device receives the second message. The first network device obtains the second policy information from the second message and stores the second policy information.</p>
<p id="p0062" num="0062"><figref idref="f0001">FIG. 1</figref> is used as an example. When the first network device is the network device 2, the third network device is the network device 3, and the second policy information indicates the network device 2 not to change the next-hop address in the BGP service routing information when the network device 2 advertises the BGP service routing information to the network device 3.</p>
<p id="p0063" num="0063">In a specific implementation, the second policy information further includes specified address information, the specified address information indicates an address set, and correspondingly, the second policy information indicates the first network device not to change the next-hop address in the BGP service routing information whose destination address is in the address set. It should be noted that the specified address information included in the second policy information may be the same as or different from the specified address information included in the first policy information. This is not limited herein.</p>
<p id="p0064" num="0064"><figref idref="f0001">FIG. 1</figref> is used as an example. The destination address in the BGP service routing information is 50.1.1.1/32, and the next-hop address is the IP address of the network device 1, for example, 10.1.1.1/32. If the address set is {50.1.1.1/32, 60.1.1.1/32...}, the destination address is in the address set. Therefore, when the first network device is the network device 2, and the third network device is the network device 3, the second policy information indicates the network device 2 not to change the next-hop address in the BGP service routing information.</p>
<p id="p0065" num="0065">The second policy information includes the specified address information, so that the next-hop address in the BGP service routing information may not be changed for a BGP route within a specific address range, thereby enriching technique implementation means and improving flexibility of use.</p>
<p id="p0066" num="0066">It should be noted that the control and management device generates the first message and/or the second message and sends the first message and/or the second message to the first network device based on a user requirement. A user is a network operator, administrator, or user. The user requirement may be a requirement for using a network, managing a network, or the like. The user requirement may be manually configured and input on the control and management device, or may be automatically obtained by the control and management device after the control and<!-- EPO <DP n="12"> --> management device receives a requirement message from another application server (for example, a third-party application server). Alternatively, another manner may be used. This is not limited in this specification.</p>
<p id="p0067" num="0067">It should be further noted that the first message and the second message are sent by a same control and management device or different control and management devices. The first policy information and the second policy information may be separately carried in two messages, or may be carried in one message.</p>
<p id="p0068" num="0068">It should be further noted that the first message and the second message may be sent according to a management channel protocol, or may be sent according to a control channel protocol. Currently, commonly used management channel protocols may include, for example, the simple network management protocol (SNMP, Simple Network Management Protocol) and the network configuration protocol (Network Configuration Protocol, NETCONF). Currently, commonly used control channel protocols may include, for example, the OpenFlow (OpenFlow) protocol, the path computation element communication protocol (Path Computation Element Communication Protocol, PCEP), the border gateway protocol (Border Gateway Protocol, BGP), and the interface to the routing system (Interface to the Routing System, I2RS) protocol.</p>
<p id="p0069" num="0069">The first message and the second message are sent by a same control and management device or different control and management devices, thereby improving flexibility of solution implementation.</p>
<p id="p0070" num="0070">It should be further noted that, other than obtaining the first policy information and the second policy information by receiving a message from the control and management device, the first network device may alternatively obtain the first policy information and the second policy information in at least one of the following manners:
<ol id="ol0001" compact="compact" ol-style="">
<li>(1) The first network device obtains the first policy information and the second policy information according to a command line configuration. For example, an administrator logs in to the first network device to perform a configuration operation by using a command line.</li>
<li>(2) The first network device runs algorithm software to automatically generate the first policy information and/or the second policy information.</li>
</ol></p>
<p id="p0071" num="0071">A plurality of manners of obtaining the first policy information and the second policy information are provided, so that technique implementation means are enriched, and usability is improved.</p>
<p id="p0072" num="0072">307. A second network device sends the BGP service routing information to the first network device.</p>
<p id="p0073" num="0073">308. The first network device receives the border gateway protocol BGP service routing information from the second network device, where the BGP service routing information includes the destination address and the next-hop address to the destination address.</p>
<p id="p0074" num="0074">309. The first network device determines, according to the first policy information, not to perform route<!-- EPO <DP n="13"> --> recursion on the next-hop address before advertising the BGP service routing information to the third network device.</p>
<p id="p0075" num="0075"><figref idref="f0001">FIG. 1</figref> is used as an example. When the first network device is the network device 2, the second network device is the network device 1, and the third network device is the network device 3, the network device 2 receives the BGP service routing information from the network device 1, and determines, according to the first policy information on the network device 2, not to perform route recursion on the next-hop address (which is the IP address of the network device 1, for example, 10.1.1.1/32). The network device 2 continues to advertise the BGP service routing information to the network device 3. Alternatively, when the first network device is the network device 3, the second network device is the network device 2, and the third network device is the network device 4. After receiving the BGP service routing message from the network device 2, the network device 3 continues to determine, according to the first policy information on the network device 3, not to perform route recursion on the next-hop address (the IP address of the network device 1), and then continues to advertise the BGP service routing information to the network device 4.</p>
<p id="p0076" num="0076">Route recursion is not performed on the next-hop address. This avoids a problem that continuous advertisement or dissemination of the BGP service routing information is terminated due to a route recursion failure, and consequently, a service cannot be created.</p>
<p id="p0077" num="0077">In a specific implementation, when the first policy information further includes the specified address information, and the specified address information indicates the address set, the first network device further needs to determine whether the destination address is a destination address in the address set. When the first network device determines that the destination address is a destination address in the address set, the first network device does not perform route recursion on the next-hop address.</p>
<p id="p0078" num="0078"><figref idref="f0001">FIG. 1</figref> is used as an example. If the destination address in the BGP service routing information is 50.1.1.1/32, and the address set is {50.1.1.1/32, 60.1.1.1/32...}, the destination address is in the address set. The network device 2 receives the BGP service routing information from the network device 1, and determines, according to the first policy information on the network device 2, that the destination address (50.1.1.1/32) is in the address set. Therefore, the network device 2 does not perform route recursion on the next-hop address (the IP address of the network device 1). The network device 2 continues to advertise the BGP service routing message to the network device 3. After receiving the BGP service routing message from the network device 2, the network device 3 continues to determine, according to the first policy information on the network device 3, that the destination address (50.1.1.1/32) is in the address set. Therefore, the network device 3 does not perform route recursion on the next-hop address (the IP address of the network device 1), and then continues to advertise the BGP service routing information to the network device 4. On the contrary, if the destination address is 80.1.1.1/32 and is not in the address set, the network device 2<!-- EPO <DP n="14"> --> or the network device 3 stops advertising the BGP service routing information.</p>
<p id="p0079" num="0079">The first policy information includes the specified address information, so that route recursion may not be performed on a BGP service route within a specific address range, thereby enriching technique implementation means and improving flexibility of use.</p>
<p id="p0080" num="0080">310. The first network device does not change the next-hop address in the BGP service routing information according to the indication of the second policy information when the first network device advertises the BGP service routing information to the third network device.</p>
<p id="p0081" num="0081">311. Send the BGP service routing information to the third network device.</p>
<p id="p0082" num="0082"><figref idref="f0001">FIG. 1</figref> is used as an example. The network device 1 sends a BGP service route to the network device 2, and the next-hop address is the IP address (10.1.1.1/32) of the network device 1. The next-hop address in the BGP service routing information received by the network device 2 from the network device 1 is the IP address of the network device 1. When the network device 2 continues to advertise the BGP service routing information to the network device 3, according to the second policy information on the network device 2, the network device 2 does not change the next-hop address to an IP address of the network device 2 (an address of the network device 2), but still uses the address of the network device 1 as the next-hop address. Likewise, the network device 3 does not change the next-hop address according to the second policy information on the network device 3, but still uses the address of the network device 1 as the next-hop address when continuing to advertise the BGP service routing information to the network device 4. The network device 1 is an end node of the cross-domain end-to-end tunnel, and the network device 4 is the other end node of the cross-domain end-to-end tunnel. When receiving the BGP service routing information, the network device 4 may perform route recursion by using the IP address of the network device 1 that is used as the next-hop address, to check whether the cross-domain end-to-end tunnel is reachable. If the cross-domain end-to-end tunnel is reachable, a service can be successfully created through route recursion. If the cross-domain end-to-end tunnel is faulty and unreachable, a service cannot be created through route recursion.</p>
<p id="p0083" num="0083">The next-hop address in the BGP service routing information is not changed, so that the next-hop address in the BGP service routing information is always an end node of the cross-domain end-to-end tunnel, and when the BGP service routing information reaches a device (border network device) connected to a service network in a cross-domain network, route recursion may be performed to check reachability of the cross-domain end-to-end tunnel. This ensures that a service is created only when the cross-domain end-to-end tunnel is reachable, thereby improving service creation reliability.</p>
<p id="p0084" num="0084">Further, as described in the foregoing 307 to 309, route recursion is not performed on a non-border network device in the cross-domain network, to avoid a problem that when an end node of the cross-domain end-to-end<!-- EPO <DP n="15"> --> tunnel is used as a next hop to perform route recursion, service route advertisement is terminated due to a recursion failure, and consequently, a service cannot be created. For example, if the network device 3 in <figref idref="f0001">FIG. 1</figref> performs IP recursion by using the address of the network device 1 as the next-hop address, a routing entry corresponding to the address of the network device 1 that is a destination address cannot be found. A reason is that the network device 1 is a device in the IGP domain 1, routing of the network device 1 is only in a range of the IGP domain 1 and is only in a routing table of the IGP domain 1, and there is no routing to the network device 1 in the IGP domain 2, that is, there is no routing entry corresponding to the address of the network device 1 in a routing table of the IGP domain 2. When the network device 3 performs tunnel recursion by using the address of the network device 1 as the next-hop address, because the network device 3 is an intermediate node on the cross-domain end-to-end tunnel, recursion to the cross-domain end-to-end tunnel cannot be implemented. To be specific, in a tunnel forwarding table, a tunnel identifier corresponding to the address (the next-hop address) of the network device 1 cannot be found. Therefore, the route recursion performed by the network device 3 cannot succeed.</p>
<p id="p0085" num="0085">To clearer understand specific application scenarios in which a cross-domain end-to-end tunnel carries various services, the following <figref idref="f0003 f0004 f0005">FIG. 3a to FIG. 3c</figref> show specific application scenarios in which a VPN service and an IPv6 service are carried. The following further explains and describes the embodiments of the present invention with reference to specific application scenarios.</p>
<p id="p0086" num="0086"><figref idref="f0003">FIG. 3a</figref> is a schematic diagram of an application scenario in which a cross-domain end-to-end tunnel carries a VPN service. In this scenario, one AS includes three IGP network domains, and a VPN site accesses a network of the AS by using a customer edge (Customer Edge, CE) device (the CE device is referred to as a CE for short below). A control and management device performs centralized control, and establishes an end-to-end tunnel crossing the three IGP network domains between provider edge (Provider Edge, PE) devices (the PE device is referred to as a PE for short below) to carry a VPN service. For example, an SR-TE tunnel (a public network tunnel) is established between a PE 1 and a PE 2, a CE 1 and a CE 2 are respectively located in a site 1 and a site 2 of a VPN 1, and a service of the VPN 1 may be carried between the site 1 and the site 2 by using the SR-TE tunnel. BGP peers are respectively established between the PE 1 and an RR 1, between the RR 1 and an RR 2, and between the RR 2 and the PE 2. VPN routing information of the CE 1 and the CE 2 is advertised and disseminated between the BGP peers of the PE 1, the RR 1, the RR 2, and the PE 2 by using BGP update messages. Therefore, a VPN private tunnel (namely, an inner tunnel) is established over the public network tunnel (namely, an outer tunnel) between the PE 1 and the PE 2, so that VPN 1 service interworking between the site 1 and the site 2 in different regions is implemented.</p>
<p id="p0087" num="0087">A method implemented in the VPN service scenario shown in <figref idref="f0003">FIG. 3a</figref> in the present invention is consistent with that in <figref idref="f0001">FIG. 1</figref>, and a difference lies in that advertised BGP service routing information is specifically<!-- EPO <DP n="16"> --> a private network route in the VPN 1. As non-border network devices in the cross-domain network, the RR 1 and the RR 2 are preset to avoiding performing route recursion or updating a next-hop address. As a border network device in the cross-domain network, the PE 1 needs to update a next hop to the PE 1 when advertising BGP VPN routing information. As a border network device in the cross-domain network, the PE 2 needs to perform route recursion when receiving the BGP VPN routing information, to ensure that a cross-domain end-to-end tunnel, obtained through recursion, from the PE 2 to the PE 1 is reachable. In this way, it can be ensured that the BGP VPN routing information advertised by the PE 1 can be normally disseminated to the PE 2 through the RR 1 and the RR 2, and that the end-to-end tunnel from the PE 2 to the PE 1 is reachable. Then, a VPN 1 service is created. This facilitates reliable creation of the VPN 1 service.</p>
<p id="p0088" num="0088"><figref idref="f0004">FIG. 3b</figref> is a schematic diagram of another application scenario in which a cross-domain end-to-end tunnel carries a VPN service. This scenario is similar to that in <figref idref="f0003">FIG. 3a</figref>. A difference lies in that this scenario includes three ASs, and the ASs are interconnected through ASBRs. Each AS is an IGP network domain, and ASs may also be considered as an IGP network domain. A control and management device performs centralized control, and establishes an end-to-end tunnel crossing the three ASs between PEs to carry a VPN service. For example, an RSVP-TE tunnel (public network tunnel) is established between a PE 1 and a PE 2. A service of a VPN 1 may be carried between a site 1 and a site 2 by using the RSVP-TE tunnel. A CE 1 accesses the PE 1 and a PE 3 in an AS 1, and a CE 2 accesses the PE 2 and a PE 4 in an AS 3. The PE 1 and the PE 3 respectively establish BGP peers with an ASBR 1 and an ASBR 5; the ASBR 1 and the ASBR 5 respectively establish BGP peers with an ASBR 3 and an ASBR 7; the ASBR 3 and the ASBR 7 respectively establish BGP peers with an ASBR 4 and an ASBR 8; and the ASBR 4 and the ASBR 8 respectively establish BGP peers with the PE 2 and the PE 4. VPN routing (also referred to as private network routing) information between the site 1 and the site 2 is carried in a BGP update message, and is advertised and disseminated through the BGP peers in sequence. Therefore, a VPN private tunnel (namely, an inner tunnel) is established over the public network tunnel (namely, an outer tunnel) between the PE 1 and the PE 2, so that VPN 1 service interworking between the site 1 and the site 2 in different regions is implemented. It should be noted that, similar to a case that a CE may access a PE in a dual-homing mode, to ensure reliability, a plurality of cross-domain end-to-end tunnels may be established between each of the PE 1 and the PE 3 and each of the PE 2 and the PE 4. Only one tunnel is used as an example herein, but no limitation is imposed.</p>
<p id="p0089" num="0089">A method implemented in the VPN service scenario shown in <figref idref="f0004">FIG. 3b</figref> in the present invention is consistent with that in <figref idref="f0001">FIG. 1</figref> or <figref idref="f0003">FIG. 3a</figref>, but is applied to a scenario of crossing a plurality of AS domains. For details, refer to the foregoing related parts. For brevity, details are not described again.</p>
<p id="p0090" num="0090"><figref idref="f0005">FIG. 3c</figref> is a schematic diagram of an application scenario in which a cross-domain end-to-end tunnel<!-- EPO <DP n="17"> --> carries an IPv6 service. In this scenario, one AS includes three IGP network domains, and the three IGP network domains are IPv4-based networks. An IPv6 network 1 and an IPv6 network 2 access a network of the AS. A router 5 and a router 6 are respectively located in the IPv6 network 1 and the IPv6 network 2. A control and management device performs centralized control, and establishes an end-to-end IPv4 tunnel crossing the three IGP network domains between a router (Router) 1 and a router 4 to carry an IPv6 service. BGP peers are respectively established between the router 1 and a router 2, between the router 2 and a router 3, and between the router 3 and the router 4. IPv6 routing information of the IPv6 network 1 and the IPv6 network 2 is advertised and disseminated between the BGP peers of the router 1, the router 2, the router 3, and the router 4 by using BGP update messages. In this way, an IPv6 tunnel (namely, an inner tunnel) is established over the IPv4 tunnel (namely, an outer tunnel) between the router 1 and the router 4, so that interworking between the IPv6 network 1 and the IPv6 network 2 is implemented.</p>
<p id="p0091" num="0091">A method implemented in the IPv6 service scenario shown in <figref idref="f0005">FIG. 3c</figref> in the present invention is consistent with that in <figref idref="f0001">FIG. 1</figref>, and a difference lies in that advertised BGP service routing information is specifically an IPv6 address in an IPv6 network, and a tunnel for route recursion is a cross-domain end-to-end IPv4 tunnel. As non-border network devices in the cross-domain network, the router 2 and the router 3 are preset to avoiding performing route recursion or updating a next-hop address. As a border network device in the cross-domain network, the router 1 needs to update a next hop to the router 1 when advertising BGP IPv6 routing information. As a border network device in the cross-domain network, the router 4 needs to perform route recursion when receiving the BGP IPv6 routing information, to ensure that a cross-domain end-to-end tunnel, obtained through recursion, from the router 4 to the router 1 is reachable. This can ensure that the BGP IPv6 routing information advertised by the router 1 can be normally disseminated to the router 4 through the router 2 and the router 3, and that the end-to-end tunnel from the router 4 to the router 1 is reachable. Then, an IPv6 over IPv4 service is created. This facilitates reliable creation of the IPv6 over IPv4 service.</p>
<p id="p0092" num="0092">It should be noted that an IPv6 over IPv4 service scenario is used as an example in <figref idref="f0005">FIG. 3c</figref>. An IPv4 over IPv6 service is similar, and a difference lies in that a cross-domain tunnel is an IPv6 tunnel, and advertised BGP service routing information is IPv4 routing information. For brevity, details are not described again.</p>
<p id="p0093" num="0093"><figref idref="f0006">FIG. 4</figref> is a schematic diagram of a network device according to an embodiment of this application. The network device 400 is used as a first network device, and is used in a network in which a cross-domain end-to-end tunnel carries a service. The cross-domain end-to-end tunnel crosses at least two interior gateway protocol IGP network domains, and the at least two IGP network domains include the first network device, a second network device, and a third network device. The first network device includes a processor 410, a memory 420 coupled to the processor 410, and a transceiver 430. The processor 410 may be a central processing unit (central processing unit, CPU), a<!-- EPO <DP n="18"> --> network processor (network processor, NP), or a combination of a CPU and an NP. The processor may alternatively be an application-specific integrated circuit (application-specific integrated circuit, ASIC), a programmable logic device (programmable logic device, PLD), or a combination thereof. The PLD may be a complex programmable logic device (complex programmable logic device, CPLD), a field-programmable gate array (field-programmable gate array, FPGA), generic array logic (generic array logic, GAL), or any combination thereof. The processor 410 may be one processor, or may include a plurality of processors. The transceiver 430 is configured to receive border gateway protocol BGP service routing information from the second network device, and send the packet to the processor 410, for subsequent operation processing. The BGP service routing information includes a destination address and a next-hop address to the destination address. The memory 420 may include a volatile memory (English: volatile memory), for example, a random access memory (random access memory, RAM). Alternatively, the memory may include a non-volatile memory (English: non-volatile memory), for example, a read-only memory (read-only memory, ROM), a flash memory (English: flash memory), a hard disk drive (hard disk drive, HDD), or a solid-state drive (solid-state drive, SSD). Alternatively, the memory may include a combination of the foregoing types of memories. The memory 420 stores a computer-readable instruction. The computer-readable instruction includes a software module, for example, a route recursion module 422. After executing each software module, the processor 410 may perform a corresponding operation according to an indication of each software module. In this embodiment, an operation performed by a software module is actually an operation performed by the processor 410 according to an indication of the software module. The route recursion module 422 may be configured to perform route recursion on the next-hop address. However, in this embodiment, before advertising the BGP service routing information to the third network device, the processor 410 does not perform route recursion on the next-hop address by using the route recursion module 422. In addition, after executing the computer-readable instruction in the memory 420, the processor 410 may perform, according to an indication of the computer-readable instruction, all operations that can be performed by the first network device, for example, operations performed by the first network device in the embodiments corresponding to <figref idref="f0001">FIG. 1</figref>, <figref idref="f0002">FIG. 2</figref>, <figref idref="f0003">FIG. 3a</figref>, <figref idref="f0004">FIG. 3b</figref>, and <figref idref="f0005">FIG. 3c</figref>.</p>
<p id="p0094" num="0094"><figref idref="f0006">FIG. 5</figref> is a schematic diagram of a control and management device 500 according to an embodiment of this application.</p>
<p id="p0095" num="0095">As shown in <figref idref="f0006">FIG. 5</figref>, the control and management device 500 includes a processor 510, a memory 520 coupled to the processor 510, and a transceiver 530. The control and management device 500 may be the control and management device in <figref idref="f0001">FIG. 1</figref>, <figref idref="f0002">FIG. 2</figref>, and <figref idref="f0003 f0005">FIG. 3a-3c</figref>. The processor 510 may be a central processing unit (central processing unit, CPU), a network processor (network processor, NP), or a combination of a CPU and an NP. The processor may alternatively be an application-specific integrated circuit (application-specific integrated circuit, ASIC),<!-- EPO <DP n="19"> --> a programmable logic device (programmable logic device, PLD), or a combination thereof. The PLD may be a complex programmable logic device (complex programmable logic device, CPLD), a field-programmable gate array (field-programmable gate array, FPGA), generic array logic (generic array logic, GAL), or any combination thereof. The processor 510 may be one processor, or may include a plurality of processors. The memory 520 may include a volatile memory (English: volatile memory), for example, a random access memory (random access memory, RAM). Alternatively, the memory may include a non-volatile memory (English: non-volatile memory), for example, a read-only memory (read-only memory, ROM), a flash memory (English: flash memory), a hard disk drive (hard disk drive, HDD), or a solid-state drive (solid-state drive, SSD). Alternatively, the memory may include a combination of the foregoing types of memories. The memory 520 stores a computer-readable instruction, and the computer-readable instruction includes a plurality of software modules, for example, a first message generation module 522 and a second message generation module 524. After executing each software module, the processor 510 may perform a corresponding operation according to an indication of each software module. In this embodiment, an operation performed by a software module is actually an operation performed by the processor 510 according to an indication of the software module. The first message generation module 522 is configured to generate a first message, where the first message includes first policy information, and the first policy information indicates a first network device not to perform route recursion. The second message generation module 524 is configured to generate a second message, where the second message includes second policy information, and the second policy information indicates the first network device not to change the next-hop address in the BGP service routing information when the first network device advertises the BGP service routing information to the third network device. The transceiver 530 is configured to send the first message and the second message to the first network device. Specifically, when the computer-readable instruction includes the first message generation module 522, the transceiver 530 is configured to send the first message to the first network device. When the computer-readable instruction includes the second message generation module 524, the transceiver 530 is configured to send the second message to the first network device according to an indication of the processor 510. When the computer-readable instruction includes the first message generation module 522 and the second message generation module 524, the transceiver 530 is configured to send the first message and the second message to the first network device according to an indication of the processor 510. In addition, after executing the computer-readable instruction in the memory 520, the processor 510 may perform, according to an indication of the computer-readable instruction, all operations that can be performed by the control and management device, for example, operations performed by the control and management device in the embodiments corresponding to <figref idref="f0001">FIG. 1</figref>, <figref idref="f0002">FIG. 2</figref>, <figref idref="f0003">FIG. 3a</figref>, <figref idref="f0004">FIG. 3b</figref>, and <figref idref="f0005">FIG. 3c</figref>.</p>
<p id="p0096" num="0096"><figref idref="f0007">FIG. 6</figref> is a schematic diagram of a route advertisement system according to an embodiment of the present<!-- EPO <DP n="20"> --> invention. As shown in <figref idref="f0007">FIG. 6</figref>, the system 600 includes a network device 610 and a control and management device 620. The network device 610 is the first network device described in the embodiments corresponding to <figref idref="f0001">FIG. 1</figref>, <figref idref="f0002">FIG. 2</figref>, <figref idref="f0003">FIG. 3a</figref>, <figref idref="f0004">FIG. 3b</figref>, and <figref idref="f0005">FIG. 3c</figref>, and the control and management device 620 is the control and management device described in the embodiments corresponding to <figref idref="f0001">FIG. 1</figref>, <figref idref="f0002">FIG. 2</figref>, <figref idref="f0003">FIG. 3a</figref>, <figref idref="f0004">FIG. 3b</figref>, and <figref idref="f0005">FIG. 3c</figref>. For detailed descriptions of the devices in the system, refer to related parts in the embodiments corresponding to <figref idref="f0001">FIG. 1</figref>, <figref idref="f0002">FIG. 2</figref>, <figref idref="f0003">FIG. 3a</figref>, <figref idref="f0004">FIG. 3b</figref>, and <figref idref="f0005">FIG. 3c</figref>. Details are not described herein again.</p>
<p id="p0097" num="0097">It should be noted that in the embodiments of the present invention, "first" in the first network device, "second" in the second network device, and "third" in the third network device are merely used to distinguish between the three network devices, but do not indicate that there is a sequence relationship, a hierarchy relationship, or another dependency relationship among the three network devices.</p>
<p id="p0098" num="0098">It should be understood that a person skilled in the art can obtain, on a basis of reading this application, combinations of optional features, steps, or methods described in the embodiments of this application without creative efforts, and all of the combinations belong to embodiments disclosed in this application. For simple description or writing, different combinations are not described.</p>
<p id="p0099" num="0099">It should be understood that the term "and/or" in this specification describes only an association relationship for describing associated objects and represents that three relationships may exist. For example, A and/or B may represent the following three cases: Only A exists, both A and B exist, and only B exists. In addition, the character "/" in this specification usually indicates an "or" relationship between the associated objects.</p>
<p id="p0100" num="0100">It should be understood that sequence numbers of the foregoing processes do not mean execution sequences in the embodiments of the present invention. The execution sequences of the processes should be determined based on functions and internal logic of the processes, and should not be construed as any limitation on the implementation processes of the embodiments of the present invention.</p>
<p id="p0101" num="0101">The foregoing descriptions are merely example specific implementations of the present invention, but are not intended to limit the protection scope of the present invention. Any variation or replacement readily figured out by a person skilled in the art within the technical scope disclosed in the present invention shall fall within the protection scope of the present invention.</p>
</description>
<claims id="claims01" lang="en"><!-- EPO <DP n="21"> -->
<claim id="c-en-0001" num="0001">
<claim-text>A route advertisement method, applied to a network in which a cross-domain end-to-end tunnel carries a service, wherein the cross-domain end-to-end tunnel crosses at least two interior gateway protocol IGP network domains, the at least two IGP network domains comprise a first network device, a second network device, and a third network device, and the method comprises:
<claim-text>receiving, by the first network device, border gateway protocol BGP service routing information from the second network device, wherein the BGP service routing information comprises a destination address and a next-hop address to the destination address;</claim-text>
<claim-text>skipping, by the first network device, performing route recursion on the next-hop address before advertising the BGP service routing information to the third network device; and</claim-text>
<claim-text>sending, by the first network device, the BGP service routing information to the third network device.</claim-text></claim-text></claim>
<claim id="c-en-0002" num="0002">
<claim-text>The method according to claim 1, wherein before the receiving, by the first network device, BGP service routing information from the second network device, the method further comprises:<br/>
obtaining, by the first network device, first policy information, wherein the first policy information indicates the first network device not to perform route recursion.</claim-text></claim>
<claim id="c-en-0003" num="0003">
<claim-text>The method according to claim 2, wherein the skipping, by the first network device, performing route recursion on the next-hop address comprises:<br/>
skipping, by the first network device according to the indication of the first policy information, performing route recursion on the next-hop address.</claim-text></claim>
<claim id="c-en-0004" num="0004">
<claim-text>The method according to claim 2, wherein the first policy information further comprises specified address information, the specified address information indicates an address set, and correspondingly, the first policy information indicates the first network device not to perform route recursion on the BGP service routing information whose destination address is in the address set.</claim-text></claim>
<claim id="c-en-0005" num="0005">
<claim-text>The method according to claim 4, wherein the skipping, by the first network device, performing route recursion on the next-hop address comprises:<br/>
skipping, by the first network device according to the indication of the first policy information when the first network device determines that the destination address is in the address set, performing route recursion on the next-hop address.</claim-text></claim>
<claim id="c-en-0006" num="0006">
<claim-text>The method according to any one of claims 2 to 5, wherein the obtaining, by the first network device, first<!-- EPO <DP n="22"> --> policy information comprises at least one of the following manners:
<claim-text>obtaining, by the first network device, the first policy information according to a command line configuration;</claim-text>
<claim-text>receiving, by the first network device, a first message from a control and management device, wherein the first message comprises the first policy information; and</claim-text>
<claim-text>running, by the first network device, algorithm software to automatically generate the first policy information.</claim-text></claim-text></claim>
<claim id="c-en-0007" num="0007">
<claim-text>The method according to any one of claims 1 to 5, further comprising: skipping, by the first network device, changing the next-hop address in the BGP service routing information when advertising the BGP service routing information to the third network device.</claim-text></claim>
<claim id="c-en-0008" num="0008">
<claim-text>The method according to claim 7, wherein before the first network device advertises the BGP service routing information to the third network device, the method further comprises:<br/>
obtaining, by the first network device, second policy information, wherein the second policy information indicates the first network device not to change the next-hop address in the BGP service routing information when the first network device advertises the BGP service routing information to the third network device.</claim-text></claim>
<claim id="c-en-0009" num="0009">
<claim-text>The method according to claim 8, wherein the skipping, by the first network device, changing the next-hop address in the BGP service routing information when advertising the BGP service routing information to the third network device comprises:<br/>
when the first network device advertises the BGP service routing information to the third network device, skipping, by the first network device according to the second policy information, changing the next-hop address in the BGP service routing information.</claim-text></claim>
<claim id="c-en-0010" num="0010">
<claim-text>The method according to claim 8 or 9, wherein the obtaining, by the first network device, second policy information comprises at least one of the following manners:
<claim-text>obtaining, by the first network device, the second policy information according to a command line configuration;</claim-text>
<claim-text>receiving, by the first network device, a second message from a control and management device, wherein the second message comprises the second policy information; and</claim-text>
<claim-text>running, by the first network device, algorithm software to automatically generate the second policy information.</claim-text></claim-text></claim>
<claim id="c-en-0011" num="0011">
<claim-text>A route advertisement method, applied to a network in which a cross-domain end-to-end tunnel carries a service, wherein the cross-domain end-to-end tunnel crosses at least two interior gateway protocol IGP network domains, the at least two IGP network domains comprise a first network device, a second network device, and a third network device, and the method comprises:<br/>
sending, by a control and management device, a first message to the first network device, wherein the first message comprises first policy information, and the first policy information indicates the first network device not to<!-- EPO <DP n="23"> --> perform route recursion.</claim-text></claim>
<claim id="c-en-0012" num="0012">
<claim-text>The method according to claim 11, wherein the first policy information further comprises specified address information, the specified address information indicates an address set, and correspondingly, the first policy information indicates the first network device not to perform route recursion on BGP service routing information whose destination address is in the address set.</claim-text></claim>
<claim id="c-en-0013" num="0013">
<claim-text>The method according to claim 11 or 12, further comprising:<br/>
sending, by the control and management device, a second message to the first network device, wherein the second message comprises second policy information, and the second policy information indicates the first network device not to change a next-hop address in the BGP service routing information when the first network device advertises the BGP service routing information to the third network device.</claim-text></claim>
<claim id="c-en-0014" num="0014">
<claim-text>A network device, used as a first network device, wherein the first network device is used in a network in which a cross-domain end-to-end tunnel carries a service, the cross-domain end-to-end tunnel crosses at least two interior gateway protocol IGP network domains, the at least two IGP network domains comprise the first network device, a second network device, and a third network device, and the first network device comprises:
<claim-text>a memory; and</claim-text>
<claim-text>a processor connected to the memory, wherein the processor is configured to execute a computer-readable instruction in the memory, to perform the following operations:
<claim-text>receiving border gateway protocol BGP service routing information from the second network device, wherein the BGP service routing information comprises a destination address and a next-hop address to the destination address;</claim-text>
<claim-text>skipping performing route recursion on the next-hop address; and</claim-text>
<claim-text>advertising the BGP service routing information to the third network device.</claim-text></claim-text></claim-text></claim>
<claim id="c-en-0015" num="0015">
<claim-text>The first network device according to claim 14, wherein before the processor receives the BGP service routing information from the second network device,<br/>
the processor obtains first policy information, wherein the first policy information indicates the first network device not to perform route recursion.</claim-text></claim>
<claim id="c-en-0016" num="0016">
<claim-text>The first network device according to claim 15, wherein that the processor does not perform route recursion on the next-hop address comprises:<br/>
the processor does not perform route recursion on the next-hop address according to the indication of the first policy information.</claim-text></claim>
<claim id="c-en-0017" num="0017">
<claim-text>The first network device according to claim 15, wherein the first policy information further comprises specified address information, the specified address information indicates an address set, and correspondingly, the<!-- EPO <DP n="24"> --> first policy information indicates the first network device not to perform route recursion on the BGP service routing information whose destination address is in the address set.</claim-text></claim>
<claim id="c-en-0018" num="0018">
<claim-text>The first network device according to claim 17, wherein that the processor does not perform route recursion on the next-hop address comprises:<br/>
the processor does not perform route recursion on the next-hop address according to the indication of the first policy information when the first network device determines that the destination address is in the address set.</claim-text></claim>
<claim id="c-en-0019" num="0019">
<claim-text>The first network device according to any one of claims 15 to 18, wherein that the processor obtains the first policy information comprises at least one of the following manners:
<claim-text>the processor obtains the first policy information according to a command line configuration;</claim-text>
<claim-text>the processor receives a first message from a control and management device, wherein the first message comprises the first policy information; and</claim-text>
<claim-text>the processor runs algorithm software to automatically generate the first policy information.</claim-text></claim-text></claim>
<claim id="c-en-0020" num="0020">
<claim-text>The first network device according to any one of claims 14 to 18, wherein the processor does not change the next-hop address in the BGP service routing information when advertising the BGP service routing information to the third network device.</claim-text></claim>
<claim id="c-en-0021" num="0021">
<claim-text>The first network device according to claim 20, wherein before the processor advertises the BGP service routing information to the third network device,<br/>
the processor obtains second policy information, wherein the second policy information indicates the first network device not to change the next-hop address in the BGP service routing information when the first network device advertises the BGP service routing information to the third network device.</claim-text></claim>
<claim id="c-en-0022" num="0022">
<claim-text>The first network device according to claim 21, wherein that the processor does not change the next-hop address in the BGP service routing information when advertising the BGP service routing information to the third network device comprises:<br/>
when the processor advertises the BGP service routing information to the third network device, the processor does not change the next-hop address in the BGP service routing information according to the second policy information.</claim-text></claim>
<claim id="c-en-0023" num="0023">
<claim-text>The first network device according to claim 21 or 22, wherein that the processor obtains the second policy information comprises at least one of the following manners:
<claim-text>the processor obtains the second policy information according to a command line configuration;</claim-text>
<claim-text>the processor receives a second message from a control and management device, wherein the second message comprises the second policy information; and<!-- EPO <DP n="25"> --></claim-text>
<claim-text>the processor runs algorithm software to automatically generate the second policy information.</claim-text></claim-text></claim>
<claim id="c-en-0024" num="0024">
<claim-text>A control and management device, applied to a network in which a cross-domain end-to-end tunnel carries a service, wherein the cross-domain end-to-end tunnel crosses at least two interior gateway protocol IGP network domains, the at least two IGP network domains comprise a first network device, a second network device, and a third network device, and the control and management device comprises:
<claim-text>a memory; and</claim-text>
<claim-text>a processor connected to the memory, wherein the processor is configured to execute a computer-readable instruction in the memory, to perform the following operation:<br/>
sending a first message to the first network device, wherein the first message comprises first policy information, and the first policy information indicates the first network device not to perform route recursion.</claim-text></claim-text></claim>
<claim id="c-en-0025" num="0025">
<claim-text>The control and management device according to claim 24, wherein the first policy information further comprises specified address information, the specified address information indicates an address set, and correspondingly, the first policy information indicates the first network device not to perform route recursion on BGP service routing information whose destination address is in the address set.</claim-text></claim>
<claim id="c-en-0026" num="0026">
<claim-text>The control and management device according to claim 24 or 25, wherein<br/>
the processor sends a second message to the first network device, wherein the second message comprises second policy information, and the second policy information indicates the first network device not to change the next-hop address in the BGP service routing information when the first network device advertises the BGP service routing information to the third network device.</claim-text></claim>
<claim id="c-en-0027" num="0027">
<claim-text>A computer-readable medium, comprising an instruction, wherein when the instruction is run on a computer, the computer is enabled to perform the method according to any one of claims 1 to 10.</claim-text></claim>
<claim id="c-en-0028" num="0028">
<claim-text>A computer-readable medium, comprising an instruction, wherein when the instruction is run on a computer, the computer is enabled to perform the method according to any one of claims 11 to 13.</claim-text></claim>
<claim id="c-en-0029" num="0029">
<claim-text>A network system, wherein the system comprises the network device according to any one of claims 14 to 23 and the control and management device according to any one of claims 24 to 26.</claim-text></claim>
</claims>
<drawings id="draw" lang="en"><!-- EPO <DP n="26"> -->
<figure id="f0001" num="1"><img id="if0001" file="imgf0001.tif" wi="121" he="227" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="27"> -->
<figure id="f0002" num="2"><img id="if0002" file="imgf0002.tif" wi="165" he="230" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="28"> -->
<figure id="f0003" num="3a"><img id="if0003" file="imgf0003.tif" wi="129" he="207" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="29"> -->
<figure id="f0004" num="3b"><img id="if0004" file="imgf0004.tif" wi="131" he="231" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="30"> -->
<figure id="f0005" num="3c"><img id="if0005" file="imgf0005.tif" wi="133" he="228" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="31"> -->
<figure id="f0006" num="4,5"><img id="if0006" file="imgf0006.tif" wi="162" he="224" img-content="drawing" img-format="tif"/></figure><!-- EPO <DP n="32"> -->
<figure id="f0007" num="6"><img id="if0007" file="imgf0007.tif" wi="109" he="61" img-content="drawing" img-format="tif"/></figure>
</drawings>
<search-report-data id="srep" lang="en" srep-office="EP" date-produced=""><doc-page id="srep0001" file="srep0001.tif" wi="151" he="233" type="tif"/><doc-page id="srep0002" file="srep0002.tif" wi="151" he="233" type="tif"/></search-report-data>
</ep-patent-document>
